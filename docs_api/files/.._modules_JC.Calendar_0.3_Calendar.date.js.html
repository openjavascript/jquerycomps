<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>..\modules\JC.Calendar\0.3\Calendar.date.js - jquery components</title>
    <link rel="stylesheet" href="../assets/css/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/widget.css">
    <link rel="stylesheet" href="../assets/css/tabview.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="../assets/js/yui-min.js"></script>
    <script src="../assets/js/comps1.js"></script>
    <script src="../assets/js/comps2.js"></script>
    <script src="../assets/js/comps3.js"></script>
    <script src="../assets/js/comps4.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..\jc_logo.png" title="jquery components"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Bizs.TaskViewer.html">Bizs.TaskViewer</a></li>
            
                <li><a href="../classes/DEV.JC.AjaxUpload.html">DEV.JC.AjaxUpload</a></li>
            
                <li><a href="../classes/DEV.JC.ImageCutter.html">DEV.JC.ImageCutter</a></li>
            
                <li><a href="../classes/JC.AjaxUpload.html">JC.AjaxUpload</a></li>
            
                <li><a href="../classes/JC.alert.html">JC.alert</a></li>
            
                <li><a href="../classes/JC.AutoChecked.html">JC.AutoChecked</a></li>
            
                <li><a href="../classes/JC.AutoComplete.html">JC.AutoComplete</a></li>
            
                <li><a href="../classes/JC.AutoSelect.html">JC.AutoSelect</a></li>
            
                <li><a href="../classes/JC.BaseMVC.html">JC.BaseMVC</a></li>
            
                <li><a href="../classes/JC.BaseMVC.Model.html">JC.BaseMVC.Model</a></li>
            
                <li><a href="../classes/JC.Calendar.html">JC.Calendar</a></li>
            
                <li><a href="../classes/JC.common.html">JC.common</a></li>
            
                <li><a href="../classes/JC.confirm.html">JC.confirm</a></li>
            
                <li><a href="../classes/JC.DCalendar.html">JC.DCalendar</a></li>
            
                <li><a href="../classes/JC.Dialog.html">JC.Dialog</a></li>
            
                <li><a href="../classes/JC.Dialog.alert.html">JC.Dialog.alert</a></li>
            
                <li><a href="../classes/JC.Dialog.confirm.html">JC.Dialog.confirm</a></li>
            
                <li><a href="../classes/JC.Dialog.mask.html">JC.Dialog.mask</a></li>
            
                <li><a href="../classes/JC.Dialog.msgbox.html">JC.Dialog.msgbox</a></li>
            
                <li><a href="../classes/JC.Drag.html">JC.Drag</a></li>
            
                <li><a href="../classes/JC.f.html">JC.f</a></li>
            
                <li><a href="../classes/JC.Fixed.html">JC.Fixed</a></li>
            
                <li><a href="../classes/JC.Form.html">JC.Form</a></li>
            
                <li><a href="../classes/JC.FormFillUrl.html">JC.FormFillUrl</a></li>
            
                <li><a href="../classes/JC.hideAllPanel.html">JC.hideAllPanel</a></li>
            
                <li><a href="../classes/JC.hideAllPopup.html">JC.hideAllPopup</a></li>
            
                <li><a href="../classes/JC.ImageCutter.html">JC.ImageCutter</a></li>
            
                <li><a href="../classes/JC.Lazyload.html">JC.Lazyload</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.html">JC.LunarCalendar</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.Model.html">JC.LunarCalendar.Model</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.View.html">JC.LunarCalendar.View</a></li>
            
                <li><a href="../classes/JC.msgbox.html">JC.msgbox</a></li>
            
                <li><a href="../classes/JC.NumericStepper.html">JC.NumericStepper</a></li>
            
                <li><a href="../classes/JC.Panel.html">JC.Panel</a></li>
            
                <li><a href="../classes/JC.Panel.Model.html">JC.Panel.Model</a></li>
            
                <li><a href="../classes/JC.Panel.View.html">JC.Panel.View</a></li>
            
                <li><a href="../classes/JC.Placeholder.html">JC.Placeholder</a></li>
            
                <li><a href="../classes/JC.PopTips.html">JC.PopTips</a></li>
            
                <li><a href="../classes/JC.Scrollbar.html">JC.Scrollbar</a></li>
            
                <li><a href="../classes/JC.Slider.html">JC.Slider</a></li>
            
                <li><a href="../classes/JC.Slider.Model.html">JC.Slider.Model</a></li>
            
                <li><a href="../classes/JC.Suggest.html">JC.Suggest</a></li>
            
                <li><a href="../classes/JC.Tab.html">JC.Tab</a></li>
            
                <li><a href="../classes/JC.Tab.Model.html">JC.Tab.Model</a></li>
            
                <li><a href="../classes/JC.Tab.View.html">JC.Tab.View</a></li>
            
                <li><a href="../classes/JC.TableFreeze.html">JC.TableFreeze</a></li>
            
                <li><a href="../classes/JC.TableSort.html">JC.TableSort</a></li>
            
                <li><a href="../classes/JC.Tips.html">JC.Tips</a></li>
            
                <li><a href="../classes/JC.Tips.Model.html">JC.Tips.Model</a></li>
            
                <li><a href="../classes/JC.Tips.View.html">JC.Tips.View</a></li>
            
                <li><a href="../classes/JC.Tree.html">JC.Tree</a></li>
            
                <li><a href="../classes/JC.Tree.Model.html">JC.Tree.Model</a></li>
            
                <li><a href="../classes/JC.Valid.html">JC.Valid</a></li>
            
                <li><a href="../classes/window.Bizs.ActionLogic.html">window.Bizs.ActionLogic</a></li>
            
                <li><a href="../classes/window.Bizs.AutoSelectComplete.html">window.Bizs.AutoSelectComplete</a></li>
            
                <li><a href="../classes/window.Bizs.ChangeLogic.html">window.Bizs.ChangeLogic</a></li>
            
                <li><a href="../classes/window.Bizs.CommonModify.html">window.Bizs.CommonModify</a></li>
            
                <li><a href="../classes/window.Bizs.DisableLogic.html">window.Bizs.DisableLogic</a></li>
            
                <li><a href="../classes/window.Bizs.DMultiDate.html">window.Bizs.DMultiDate</a></li>
            
                <li><a href="../classes/window.Bizs.DropdownTree.html">window.Bizs.DropdownTree</a></li>
            
                <li><a href="../classes/window.Bizs.FormLogic.html">window.Bizs.FormLogic</a></li>
            
                <li><a href="../classes/window.Bizs.KillISPCache.html">window.Bizs.KillISPCache</a></li>
            
                <li><a href="../classes/window.Bizs.MoneyTips.html">window.Bizs.MoneyTips</a></li>
            
                <li><a href="../classes/window.Bizs.MultiAutoComplete.html">window.Bizs.MultiAutoComplete</a></li>
            
                <li><a href="../classes/window.Bizs.MultiDate.html">window.Bizs.MultiDate</a></li>
            
                <li><a href="../classes/window.Bizs.MultiSelect.html">window.Bizs.MultiSelect</a></li>
            
                <li><a href="../classes/window.Bizs.MultiUpload.html">window.Bizs.MultiUpload</a></li>
            
                <li><a href="../classes/window.jQuery.html">window.jQuery</a></li>
            
                <li><a href="../classes/window.requirejs.html">window.requirejs</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ..\modules\JC.Calendar\0.3\Calendar.date.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
;(function(define, _win) { &#x27;use strict&#x27;; define( [ &#x27;JC.common&#x27; ], function(){
//TODO: minvalue, maxvalue 添加默认日期属性识别属性
    /**
     * 日期选择组件
     * &lt;br /&gt;全局访问请使用 JC.Calendar 或 Calendar
     * &lt;br /&gt;DOM 加载完毕后
     * , Calendar会自动初始化页面所有日历组件, input[type=text][datatype=date]标签
     * &lt;br /&gt;Ajax 加载内容后, 如果有日历组件需求的话, 需要手动使用Calendar.init( _selector )
     * &lt;br /&gt;_selector 可以是 新加载的容器, 也可以是新加载的所有input
     * &lt;p&gt;&lt;b&gt;require&lt;/b&gt;: 
     *      &lt;a href=&#x27;window.jQuery.html&#x27;&gt;jQuery&lt;/a&gt;
     *      , &lt;a href=&#x27;JC.common.html&#x27;&gt;JC.common&lt;/a&gt;
     * &lt;/p&gt;
     * &lt;p&gt;&lt;a href=&#x27;https://github.com/openjavascript/jquerycomps&#x27; target=&#x27;_blank&#x27;&gt;JC Project Site&lt;/a&gt;
     * | &lt;a href=&#x27;http://jc2.openjavascript.org/docs_api/classes/JC.Calendar.html&#x27; target=&#x27;_blank&#x27;&gt;API docs&lt;/a&gt;
     * | &lt;a href=&#x27;../../modules/JC.Calendar/0.3/_demo/&#x27; target=&#x27;_blank&#x27;&gt;demo link&lt;/a&gt;&lt;/p&gt;
     * &lt;h2&gt; 可用的html attribute, (input|button):(datatype|multidate)=(date|week|month|season) &lt;/h2&gt; 
     * &lt;dl&gt;
     *      &lt;dt&gt;defaultdate = ISO Date&lt;/dt&gt;
     *      &lt;dd&gt;默认显示日期, 如果 value 为空, 则尝试读取 defaultdate 属性&lt;/dd&gt;
     *
     *      &lt;dt&gt;datatype = string&lt;/dt&gt;
     *      &lt;dd&gt;
     *          声明日历控件的类型:
     *          &lt;br /&gt;&lt;b&gt;date:&lt;/b&gt; 日期日历
     *          &lt;br /&gt;&lt;b&gt;week:&lt;/b&gt; 周日历
     *          &lt;br /&gt;&lt;b&gt;month:&lt;/b&gt; 月日历
     *          &lt;br /&gt;&lt;b&gt;season:&lt;/b&gt; 季日历
     *          &lt;br /&gt;&lt;b&gt;year:&lt;/b&gt; 年日历
     *          &lt;br /&gt;&lt;b&gt;monthday:&lt;/b&gt; 多选日期日历
     *      &lt;/dd&gt;
     *
     *      &lt;dt&gt;multidate = string&lt;/dt&gt;
     *      &lt;dd&gt;
     *          与 datatype 一样, 这个是扩展属性, 避免表单验证带来的逻辑冲突
     *      &lt;/dd&gt;
     *
     *      &lt;dt&gt;calendarshow = function&lt;/dt&gt;
     *      &lt;dd&gt;显示日历时的回调
&lt;pre&gt;function calendarshow( _selector, _ins ){
    var _selector = $(this);
    UXC.log( &#x27;calendarshow&#x27;, _selector.val() );
}
&lt;/pre&gt;&lt;/dd&gt;
     *
     *      &lt;dt&gt;calendarhide = function&lt;/dt&gt;
     *      &lt;dd&gt;隐藏日历时的回调
&lt;pre&gt;function calendarhide( _selector, _ins ){
    var _selector = $(this);
    UXC.log( &#x27;calendarhide&#x27;, _selector.val() );
}&lt;/pre&gt;&lt;/dd&gt;
     *
     *      &lt;dt&gt;calendarlayoutchange = function&lt;/dt&gt;
     *      &lt;dd&gt;用户点击日历控件操作按钮后, 外观产生变化时触发的回调
&lt;pre&gt;function calendarlayoutchange( _selector, _ins ){
    var _selector = $(this);
    JC.log( &#x27;calendarlayoutchange&#x27;, _selector.val() );
}
&lt;/pre&gt;&lt;/dd&gt;
     *
     *      &lt;dt&gt;calendarupdate = function&lt;/dt&gt;
     *      &lt;dd&gt;
     *          赋值后触发的回调
&lt;pre&gt;function calendarupdate( _startDate, _endDate, _ins ){
    var _selector = $(this);
    JC.log( &#x27;calendarupdate&#x27;, _selector.val(), _startDate, _endDate );
}
&lt;/pre&gt;&lt;/dd&gt;
     *
     *      &lt;dt&gt;calendarclear = function&lt;/dt&gt;
     *      &lt;dd&gt;清空日期触发的回调
&lt;pre&gt;function calendarclear( _selector, _ins ){
    var _selector = $(this);
}&lt;/pre&gt;&lt;/dd&gt;
     *
     *      &lt;dt&gt;minvalue = ISO Date&lt;/dt&gt;
     *      &lt;dd&gt;日期的最小时间, YYYY-MM-DD&lt;/dd&gt;
     *
     *      &lt;dt&gt;maxvalue = ISO Date&lt;/dt&gt;
     *      &lt;dd&gt;日期的最大时间, YYYY-MM-DD&lt;/dd&gt;
     *
     *      &lt;dt&gt;currentcanselect = bool, default = true&lt;/dt&gt;
     *      &lt;dd&gt;当前日期是否能选择&lt;/dd&gt;
     *
     *      &lt;dt&gt;multiselect = bool (目前支持 month: default=false, monthday: default = true)&lt;/dt&gt;
     *      &lt;dd&gt;是否为多选日历&lt;/dd&gt;
     *
     *      &lt;dt&gt;calendarupdatemultiselect = function&lt;/dt&gt;
     *      &lt;dd&gt;
     *          多选日历赋值后触发的回调
     *          &lt;dl&gt;
     *              &lt;dt&gt;参数: _data:&lt;/dt&gt;
     *              &lt;dd&gt;
     *                  [{&quot;start&quot;: Date,&quot;end&quot;: Date}[, {&quot;start&quot;: Date,&quot;end&quot;: Date}... ] ]
     *              &lt;/dd&gt;
     *          &lt;/dl&gt;
&lt;pre&gt;function calendarupdatemultiselect( _data, _ins ){
    var _selector = $(this);
    window.JSON &amp;&amp; ( _data = JSON.stringify( _data ) );
    JC.log( &#x27;calendarupdatemultiselect:&#x27;
        , JC.f.printf( &#x27;val:{0}, data:{1}&#x27;, _selector.val(), _data ) );
}&lt;/pre&gt;&lt;/dd&gt;
     *
     *      &lt;dt&gt;dateFormat = string&lt;/dt&gt;
     *      &lt;dd&gt;
     *          自定义日期格式化显示, 使用 JC.f.dateFormat 函数进行格式化
     *          &lt;br /&gt;如果日期去除非数字后不是 8/16 位数字的话, 需要 显式声明 dateParse 属性, 自定义日期解析函数
     *      &lt;/dd&gt;
     *
     *      &lt;dt&gt;fullDateFormat = string&lt;/dt&gt;
     *      &lt;dd&gt;
     *          针对 日期类型: 月/季/年 定义显示格式, default: &quot;{0} 至 {1}&quot;
     *          &lt;br /&gt;{0}代表开始日期, {1}代表结束日期
     *      &lt;/dd&gt;
     *
     *      &lt;dt&gt;dateParse = function &lt;/dt&gt;
     *      &lt;dd&gt;
     *          自定义日期格式函数, 针对日期不能解析为 8 位数字的特殊日期
     *          &lt;br /&gt;例子:
&lt;pre&gt;//
/// 针对月份日期格式化 YY-MM
//
function parseYearMonthDate( _dateStr ){
    _dateStr = $.trim( _dateStr || &#x27;&#x27; );
    var _r = { start: null, end: null };
    if( !_dateStr ) return _r;

    _dateStr = _dateStr.replace( /[^\d]+/g, &#x27;&#x27; );
    var _year = _dateStr.slice( 0, 4 ), _month = parseInt( _dateStr.slice( 4 ), 10 ) - 1;

    _r.start = new Date( _year, _month, 1 );
    return _r;
}
//
/// 针对季度日期格式化 YY-MM ~ YY-MM
//
function parseSeasonDate( _dateStr ){
    _dateStr = $.trim( _dateStr || &#x27;&#x27; );
    var _r = { start: null, end: null };
    if( !_dateStr ) return _r;

    _dateStr = _dateStr.replace( /[^\d]+/g, &#x27;&#x27; );

    _r.start = JC.f.parseISODate( _dateStr.slice( 0, 6 ) + &#x27;01&#x27; );
    _r.end = JC.f.parseISODate( _dateStr.slice( 6 ) + &#x27;01&#x27; );

    return _r;
}
//
/// 针对年份日期格式化 YY
//
function parseYearDate( _dateStr ){
    _dateStr = $.trim( _dateStr || &#x27;&#x27; );
    var _r = { start: null, end: null };
    if( !_dateStr ) return _r;

    _dateStr = _dateStr.replace( /[^\d]+/g, &#x27;&#x27; );
    var _year = _dateStr.slice( 0, 4 );

    _r.start = new Date( _year, 0, 1 );
    return _r;
}&lt;/pre&gt;
     *      &lt;/dd&gt;
     * &lt;/dl&gt;
     * @namespace JC
     * @class Calendar
     * @version dev 0.3, 2013-12-09 添加 年日历, 优化继承代码块
     * @version dev 0.2, 2013-09-01 过程式转单例模式
     * @version dev 0.1, 2013-06-04
     * @author  qiushaowei   &lt;suches@btbtd.org&gt; | 75 team
     */
    window.Calendar = JC.Calendar = Calendar;
    function Calendar( _selector ){
        if( Calendar.getInstance( _selector ) ) return Calendar.getInstance( _selector );
        Calendar.getInstance( _selector, this );

        var _type = Calendar.type( _selector );

        //JC.log( &#x27;Calendar init:&#x27;, _type, new Date().getTime() );

        switch( _type ){
            case &#x27;week&#x27;: 
                {
                    this._model = new Calendar.WeekModel( _selector );
                    this._view = new Calendar.WeekView( this._model );
                    break;
                }
            case &#x27;month&#x27;: 
                {
                    this._model = new Calendar.MonthModel( _selector );
                    this._view = new Calendar.MonthView( this._model );
                    break;
                }
            case &#x27;season&#x27;: 
                {
                    this._model = new Calendar.SeasonModel( _selector );
                    this._view = new Calendar.SeasonView( this._model );
                    break;
                }
            case &#x27;year&#x27;: 
                {
                    this._model = new Calendar.YearModel( _selector );
                    this._view = new Calendar.YearView( this._model );
                    break;
                }
            case &#x27;monthday&#x27;:
                {   
                   
                    this._model = new Calendar.MonthDayModel( _selector );
                    this._view = new Calendar.MonthDayView( this._model );
                    break;
                }
            default:
                {
                    this._model = new Calendar.Model( _selector );
                    this._view = new Calendar.View( this._model );
                    break;
                }
        }

        this._init();
    }
    
    Calendar.prototype = {
        /**
         * 内部初始化函数
         * @method _init
         * @private
         */
        _init:
            function(){
                var _p = this;

                _p._initHanlderEvent();

                $( [ _p._view, _p._model ] ).on(&#x27;BindEvent&#x27;, function( _evt, _evtName, _cb ){
                    _p.on( _evtName, _cb );
                });

                $([ _p._view, _p._model ] ).on(&#x27;TriggerEvent&#x27;, function( _evt, _evtName ){
                    var _data = JC.f.sliceArgs( arguments ).slice(2);
                    _p.trigger( _evtName, _data );
                });

                _p._model.init();
                _p._view.init();

                return _p;
            }    
        /**
         * 初始化相关操作事件
         * @method  _initHanlderEvent
         * @private
         */
        , _initHanlderEvent:
            function(){
                var _p = this;

                _p.on( Calendar.Model.INITED, function( _evt ){
                    _p._model.calendarinited()
                        &amp;&amp; _p._model.calendarinited().call( _p._model.selector(), _p._model.layout(), _p );
                });

                _p.on( Calendar.Model.SHOW, function( _evt ){
                    _p._model.calendarshow()
                        &amp;&amp; _p._model.calendarshow().call( _p._model.selector(), _p._model.selector(), _p );
                });

                _p.on( Calendar.Model.HIDE, function( _evt ){
                    _p._model.calendarhide()
                        &amp;&amp; _p._model.calendarhide().call( _p._model.selector(), _p._model.selector(), _p );
                });

                _p.on( Calendar.Model.UPDATE, function( _evt ){
                    if( !_p._model.selector() ) return;

                    _p._model.selector().blur();
                    _p._model.selector().trigger(&#x27;change&#x27;);

                    var _data = []
                        , _v = _p._model.selector().val().trim()
                        , _startDate, _endDate
                        , _tmp, _item
                        , _tmpStart, _tmpEnd
                        ;

                    if( _v ){
                        _tmp = _v.split( &#x27;,&#x27; );
                        for( var i = 0, j = _tmp.length; i &lt; j; i++ ){

                            if( _p._model.dateParse( _p._model.selector() ) ){
                                var _tmpDataObj = _p._model.dateParse( _p._model.selector() )( _tmp[i] );
                                    _startDate = _tmpDataObj.start;
                                    _endDate = _tmpDataObj.end;
                                    !_endDate &amp;&amp; ( _endDate = _startDate );
                            }else{
                                _item = _tmp[i].replace( /[^\d]/g, &#x27;&#x27; );
                                if( _item.length == 16 ){
                                    _tmpStart = JC.f.parseISODate( _item.slice( 0, 8 ) );
                                    _tmpEnd = JC.f.parseISODate( _item.slice( 8 ) );
                                }else if( _item.length == 8 ){
                                    _tmpStart = JC.f.parseISODate( _item.slice( 0, 8 ) );
                                    _tmpEnd = JC.f.cloneDate( _tmpStart );
                                }
                                if( i === 0 ){
                                    _startDate = JC.f.cloneDate( _tmpStart );
                                    _endDate = JC.f.cloneDate( _tmpEnd );
                                }
                            }
                            _data.push( {&#x27;start&#x27;: _tmpStart, &#x27;end&#x27;: _tmpEnd } );
                        }
                    }

                    _p._model.calendarupdate()
                        &amp;&amp; _p._model.calendarupdate().apply( _p._model.selector(), [ _startDate, _endDate, _p ] );

                    _p._model.multiselect()
                        &amp;&amp; _p._model.calendarupdatemultiselect()
                        &amp;&amp; _p._model.calendarupdatemultiselect().call( _p._model.selector(), _data, _p );
                });

                _p.on( Calendar.Model.CLEAR, function( _evt ){
                    _p._model.calendarclear()
                        &amp;&amp; _p._model.calendarclear().call( _p._model.selector(), _p._model.selector(), _p );
                });

                _p.on( Calendar.Model.CANCEL, function( _evt ){
                    _p._model.calendarcancel()
                        &amp;&amp; _p._model.calendarcancel().call( _p._model.selector(), _p._model.selector(), _p );
                });

                _p.on( Calendar.Model.LAYOUT_CHANGE, function( _evt ){
                    _p._model.calendarlayoutchange()
                        &amp;&amp; _p._model.calendarlayoutchange().call( _p._model.selector(), _p._model.selector(), _p );
                });

                _p.on( Calendar.Model.UPDATE_MULTISELECT, function( _evt ){
                    _p._model.multiselect()
                        &amp;&amp; _p._model.calendarupdatemultiselect()
                        &amp;&amp; _p._model.calendarupdatemultiselect().call( _p._model.selector(), _p._model.selector(), _p );
                });

                return _p;
            }
        /**
         * 显示 Calendar
         * @method  show
         * @return  CalendarInstance
         */
        , show: 
            function(){ 
                Calendar.hide(); 
                Calendar.lastIpt = this._model.selector();
                this._view.show(); 
                this.trigger( Calendar.Model.SHOW );
                return this; 
            }
        /**
         * 隐藏 Calendar
         * @method  hide
         * @return  CalendarInstance
         */
        , hide: function(){ 
            this._view.hide(); 
            this.trigger( Calendar.Model.HIDE );
            this.selector() &amp;&amp; this.selector().blur();
            return this; 
        }
        /**
         * 获取 显示 Calendar 的触发源选择器, 比如 a 标签
         * @method  selector
         * @return  selector
         */ 
        , selector: function(){ return this._model.selector(); }
        /**
         * 获取 Calendar 外观的 选择器
         * @method  layout
         * @return  selector
         */
        , layout: function(){ return this._model.layout(); }
        /**
         * 使用 jquery on 绑定事件
         * @method  {string}    on
         * @param   {string}    _evtName
         * @param   {function}  _cb
         * @return  CalendarInstance
         */
        , on: function( _evtName, _cb ){ $(this).on(_evtName, _cb ); return this;}
        /**
         * 使用 jquery trigger 绑定事件
         * @method  {string}    trigger
         * @param   {string}    _evtName
         * @return  CalendarInstance
         */
        , trigger: function( _evtName, _data ){ $(this).trigger( _evtName, _data ); return this;}
        /**
         * 用户操作日期控件时响应改变
         * @method  updateLayout
         */
        , updateLayout:
            function(){
                this._view.updateLayout();
                return this;
            }
        /**
         * 切换到不同日期控件源时, 更新对应的控件源
         * @method  updateSelector
         * @param   {selector}      _selector
         */
        , updateSelector:
            function( _selector ){
                Calendar.lastIpt = _selector;
                this._model &amp;&amp; this._model.selector( _selector );
                return this;
            }
        /**
         * 用户改变年份时, 更新到对应的年份
         * @method  updateYear
         * @param   {int}   _offset
         */
        , updateYear:
            function( _offset ){
                this._view &amp;&amp; this._view.updateYear( _offset );
                this.trigger( Calendar.Model.LAYOUT_CHANGE );
                return this;
            }
        /**
         * 用户改变月份时, 更新到对应的月份
         * @method  updateMonth
         * @param   {int}   _offset
         */
        , updateMonth:
            function( _offset ){
                this._view &amp;&amp; this._view.updateMonth( _offset );
                this.trigger( Calendar.Model.LAYOUT_CHANGE );
                return this;
            }
        /**
         * 把选中的值赋给控件源
         * &lt;br /&gt;用户点击日期/确定按钮
         * @method  updateSelected
         * @param   {selector}  _userSelectedItem
         */
        , updateSelected:
            function( _userSelectedItem ){
                //JC.log( &#x27;JC.Calendar: updateSelector&#x27;, new Date().getTime() );
                this._view &amp;&amp; this._view.updateSelected( _userSelectedItem );
                return this;
            }
        /**
         * 显示日历外观到对应的控件源 
         * @method  updatePosition
         */
        , updatePosition:
            function(){
                this._view &amp;&amp; this._view.updatePosition();
                return this;
            }
        /**
         * 清除控件源内容
         * @method  clear
         */
        , clear:
            function(){
                var _isEmpty = !this._model.selector().val().trim();
                this._model &amp;&amp; this._model.selector().val(&#x27;&#x27;);
                !_isEmpty &amp;&amp; this.trigger( Calendar.Model.CLEAR );
                return this;
            }
        /**
         * 用户点击取消按钮时隐藏日历外观
         * @method  cancel
         */
        , cancel:
            function(){
                this.trigger( Calendar.Model.CANCEL );
                this._view &amp;&amp; this._view.hide();
                return this;
            }
        /***
         * 返回日历外观是否可见
         * @method  visible
         * @return  bool
         */
        , visible:
            function(){
                var _r, _tmp;
                this._model 
                    &amp;&amp; ( _tmp = this._model.layout() ) 
                    &amp;&amp; ( _r = _tmp.is(&#x27;:visible&#x27;) )
                    ;
                return _r;
            }
        /**
         * 获取控件源的初始日期对象
         * @method  defaultDate
         * @param   {selector}  _selector
         */
        , defaultDate:
            function( _selector ){
                return this._model.defaultDate( _selector );
            }

        , updateFormat: function( _selector ){ this._model.updateFormat( _selector ); }
    }
    /**
     * 获取或设置 Calendar 的实例
     * @method getInstance
     * @param   {selector}      _selector
     * @static
     * @return  {Calendar instance}
     */
    Calendar.getInstance =
        function( _selector, _setter ){
            typeof _selector == &#x27;string&#x27; &amp;&amp; !/&lt;/.test( _selector ) &amp;&amp; ( _selector = $(_selector) );
            if( !(_selector &amp;&amp; _selector.length ) || ( typeof _selector == &#x27;string&#x27; ) ) return;
            var _type = Calendar.type( _selector );
            typeof _setter != &#x27;undefined&#x27; &amp;&amp; ( Calendar._ins[ _type ] = _setter );
            Calendar._ins[ _type ] &amp;&amp; Calendar._ins[ _type ].updateSelector( _selector );
            return Calendar._ins[ _type ];
        };
    /**
     * 保存所有类型的 Calendar 日期实例 
     * &lt;br /&gt;目前有 date, week, month, season 四种类型的实例
     * &lt;br /&gt;每种类型都是单例模式
     * @prototype   _ins
     * @type        object
     * @default     empty
     * @private
     * @static
     */
    Calendar._ins = {};
    /**
     * 获取控件源的实例类型
     * &lt;br /&gt;目前有 date, week, month, season 四种类型的实例
     * @method  type
     * @param   {selector}  _selector
     * @return  string
     * @static
     */
    Calendar.type =
        function( _selector ){
            _selector = $(_selector);
            var _r, _type = $.trim(_selector.attr(&#x27;multidate&#x27;) || &#x27;&#x27;).toLowerCase() 
                || $.trim(_selector.attr(&#x27;datatype&#x27;) || &#x27;&#x27;).toLowerCase();
            switch( _type ){
                case &#x27;week&#x27;: 
                case &#x27;month&#x27;: 
                case &#x27;season&#x27;: 
                case &#x27;year&#x27;: 
                case &#x27;monthday&#x27;: 
                    {
                        _r = _type;
                        break;
                    }
                default: _r = &#x27;date&#x27;; break;
            }
            return _r;
        };
    /** 
     * 判断选择器是否为日历组件的对象
     * @method  isCalendar
     * @static
     * @param   {selector}  _selector
     * return   bool
     */
    Calendar.isCalendar = 
        function( _selector ){
            _selector = $(_selector);
            var _r = 0;

            if( _selector.length ){
                if( _selector.hasClass(&#x27;UXCCalendar_btn&#x27;) ) _r = 1;
                if( _selector.prop(&#x27;nodeName&#x27;) 
                        &amp;&amp; _selector.attr(&#x27;datatype&#x27;)
                        &amp;&amp; ( _selector.prop(&#x27;nodeName&#x27;).toLowerCase()==&#x27;input&#x27; || _selector.prop(&#x27;nodeName&#x27;).toLowerCase()==&#x27;button&#x27; )
                        &amp;&amp; ( _selector.attr(&#x27;datatype&#x27;).toLowerCase()==&#x27;date&#x27; 
                                || _selector.attr(&#x27;datatype&#x27;).toLowerCase()==&#x27;week&#x27; 
                                || _selector.attr(&#x27;datatype&#x27;).toLowerCase()==&#x27;month&#x27; 
                                || _selector.attr(&#x27;datatype&#x27;).toLowerCase()==&#x27;season&#x27; 
                                || _selector.attr(&#x27;datatype&#x27;).toLowerCase()==&#x27;year&#x27; 
                                || _selector.attr(&#x27;datatype&#x27;).toLowerCase()==&#x27;daterange&#x27; 
                                || _selector.attr(&#x27;datatype&#x27;).toLowerCase() == &#x27;monthday&#x27;
                            )) _r = 1;
                if( _selector.prop(&#x27;nodeName&#x27;) 
                        &amp;&amp; _selector.attr(&#x27;multidate&#x27;)
                        &amp;&amp; ( _selector.prop(&#x27;nodeName&#x27;).toLowerCase()==&#x27;input&#x27; 
                            || _selector.prop(&#x27;nodeName&#x27;).toLowerCase()==&#x27;button&#x27; )
                        ) _r = 1;
            }

            return _r;
        };
    /**
     * 请使用 isCalendar, 这个方法是为了向后兼容
     */
    Calendar.isCalendarElement = function( _selector ){ return Calendar.isCalendar( _selector ); };
    /**
     * 弹出日期选择框
     * @method pickDate
     * @static
     * @param   {selector}  _selector 需要显示日期选择框的input[text]   
     * @example
            &lt;dl&gt;
                &lt;dd&gt;
                    &lt;input type=&quot;text&quot; name=&quot;date6&quot; class=&quot;manualPickDate&quot; value=&quot;20110201&quot; /&gt;
                    manual JC.Calendar.pickDate
                &lt;/dd&gt;
                &lt;dd&gt;
                    &lt;input type=&quot;text&quot; name=&quot;date7&quot; class=&quot;manualPickDate&quot; /&gt;
                    manual JC.Calendar.pickDate
                &lt;/dd&gt;
            &lt;/dl&gt;
            &lt;script&gt;
                $(document).delegate(&#x27;input.manualPickDate&#x27;, &#x27;focus&#x27;, function($evt){
                JC.Calendar.pickDate( this );
                });
            &lt;/script&gt;
     */
    Calendar.pickDate =  
        function( _selector ){ 
            _selector = $( _selector );
            if( !(_selector &amp;&amp; _selector.length) ) return;

            var _ins, _isIgnore = _selector.is(&#x27;[ignoreprocess]&#x27;);

            _selector.attr(&#x27;ignoreprocess&#x27;, true);
            _selector.blur();
            !_isIgnore &amp;&amp; _selector.removeAttr(&#x27;ignoreprocess&#x27;);

            _ins = Calendar.getInstance( _selector );
            !_ins &amp;&amp; ( _ins = new Calendar( _selector ) );
            _ins.show();
            return;
        }; 
    /**
     * 设置是否在 DOM 加载完毕后, 自动初始化所有日期控件
     * @property    autoInit
     * @default true
     * @type    {bool}
     * @static
            &lt;script&gt;JC.Calendar.autoInit = true;&lt;/script&gt;
     */
    Calendar.autoInit =  true;
    /**
     * 设置默认显示的年份数, 该数为前后各多少年 默认为前后各10年
     * @property    defaultDateSpan
     * @type        {int}
     * @default     20
     * @static
            &lt;script&gt;JC.Calendar.defaultDateSpan = 20;&lt;/script&gt;
     */
    Calendar.defaultDateSpan = 20;
    /**
     * 最后一个显示日历组件的文本框
     * @property  lastIpt
     * @type    selector
     * @static
     */
    Calendar.lastIpt = null;
    /**
     * 自定义日历组件模板
     * &lt;p&gt;默认模板为_logic.tpl&lt;/p&gt;
     * &lt;p&gt;如果用户显示定义JC.Calendar.tpl的话, 将采用用户的模板&lt;/p&gt;
     * @property    tpl
     * @type    {string}
     * @default empty
     * @static
     */
    Calendar.tpl = &#x27;&#x27;;
    /**
     * 初始化外观后的回调函数
     * @property layoutInitedCallback
     * @type    function
     * @static
     * @default null
     */
    Calendar.layoutInitedCallback = null;
    /**
     * 显示为可见时的回调
     * @property layoutShowCallback
     * @type    function
     * @static
     * @default null
     */
    Calendar.layoutShowCallback = null;
    /**
     * 日历隐藏后的回调函数
     * @property layoutHideCallback
     * @type    function
     * @static
     * @default null
     */
    Calendar.layoutHideCallback = null;
    /**
     * DOM 点击的过滤函数
     * &lt;br /&gt;默认 dom 点击时, 判断事件源不为 input[datatype=date|daterange] 会隐藏 Calendar
     * &lt;br /&gt; 通过该回调可自定义过滤, 返回 false 不执行隐藏操作
     * @property domClickFilter
     * @type    function
     * @static
     * @default null
     */
    Calendar.domClickFilter = null;
    /**
     * 隐藏日历组件
     * @method  hide
     * @static
     * @example
            &lt;script&gt;JC.Calendar.hide();&lt;/script&gt;
     */
    Calendar.hide =
        function(){

            for( var k in Calendar._ins ){
                Calendar._ins[ k] 
                    &amp;&amp; Calendar._ins[ k].visible()
                    &amp;&amp; Calendar._ins[ k].hide()
                    ;
            }
        };
    /**
     * 获取初始日期对象
     * &lt;p style=&quot;bold&quot;&gt;这个方法将要废除, 请使用 instance.defaultDate()&lt;/p&gt;
     * @method  getDate
     * @static
     * @param   {selector}  _selector   显示日历组件的input
     * return   { date: date, minvalue: date|null, maxvalue: date|null, enddate: date|null }
     */
    Calendar.getDate =
        function( _selector ){
            return Calendar.getInstance( _selector ).defaultDate();
        };
    /**
     * 每周的中文对应数字
     * @property    cnWeek
     * @type    string
     * @static
     * @default 日一二三四五六 
     */
    Calendar.cnWeek = &quot;日一二三四五六&quot;;
    /**
     * 100以内的中文对应数字
     * @property    cnUnit
     * @type    string
     * @static
     * @default 十一二三四五六七八九    
     */
    Calendar.cnUnit = &quot;十一二三四五六七八九&quot;;
    /**
     * 转换 100 以内的数字为中文数字
     * @method  getCnNum
     * @static
     * @param   {int}   _num
     * @return  string
     */
    Calendar.getCnNum =
        function ( _num ){
            var _r = Calendar.cnUnit.charAt( _num % 10 );
            _num &gt; 10 &amp;&amp; ( _r = (_num % 10 !== 0 ? Calendar.cnUnit.charAt(0) : &#x27;&#x27;) + _r );
            _num &gt; 19 &amp;&amp; ( _r = Calendar.cnUnit.charAt( Math.floor( _num / 10 ) ) + _r );
            return _r;
        };
    /**
     * 设置日历组件的显示位置
     * @method  position
     * @static
     * @param   {selector}  _ipt    需要显示日历组件的文本框
     */
    Calendar.position =
        function( _ipt ){
            Calendar.getInstance( _ipt )
                &amp;&amp; Calendar.getInstance( _ipt ).updatePosition();
        };
    /**
     * 这个方法后续版本不再使用, 请使用 Calendar.position
     */
    Calendar.setPosition = Calendar.position;
    /**
     * 初始化日历组件的触发按钮
     * @method  _logic.initTrigger
     * @param   {selector}      _selector   
     * @private
     */
    Calendar.initTrigger = 
        function( _selector ){
           _selector.each( function(){
                var _p = $(this)
                    , _nodeName = (_p.prop(&#x27;nodeName&#x27;)||&#x27;&#x27;).toLowerCase()
                    , _tmp, _dt
                    ;

                if( _nodeName != &#x27;input&#x27; &amp;&amp; _nodeName != &#x27;textarea&#x27; ){ 
                    Calendar.initTrigger( _selector.find( &#x27;input[type=text], textarea&#x27; ) ); 
                    return; 
                }
                _dt = $.trim( _p.attr(&#x27;datatype&#x27;) || &#x27;&#x27;).toLowerCase()

                if( !(  
                        _dt == &#x27;date&#x27; 
                        || _dt == &#x27;week&#x27; 
                        || _dt == &#x27;month&#x27; 
                        || _dt == &#x27;season&#x27; 
                        || _dt == &#x27;year&#x27; 
                        || _dt == &#x27;daterange&#x27;
                        || _dt == &#x27;monthday&#x27; 
                        || $.trim( _p.attr(&#x27;multidate&#x27;) || &#x27;&#x27;)
                        ) ) return;

                var _btn = _p.find( &#x27;+ input.UXCCalendar_btn&#x27; );
                if( !_btn.length ){
                    _p.after( _btn = $(&#x27;&lt;input type=&quot;button&quot; class=&quot;UXCCalendar_btn&quot;  /&gt;&#x27;) );
                }

                //Calendar.fixDefaultDate( _p );

                ( _tmp = _p.val().trim() )
                    &amp;&amp; ( _tmp = JC.f.dateDetect( _tmp ) )
                    &amp;&amp; _p.val( JC.f.formatISODate( _tmp ) )
                    ; 

                ( _tmp = ( _p.attr(&#x27;minvalue&#x27;) || &#x27;&#x27; ) )
                    &amp;&amp; ( _tmp = JC.f.dateDetect( _tmp ) )
                    &amp;&amp; _p.attr( &#x27;minvalue&#x27;, JC.f.formatISODate( _tmp ) )
                    ; 

                ( _tmp = ( _p.attr(&#x27;maxvalue&#x27;) || &#x27;&#x27; ) )
                    &amp;&amp; ( _tmp = JC.f.dateDetect( _tmp ) )
                    &amp;&amp; _p.attr( &#x27;maxvalue&#x27;, JC.f.formatISODate( _tmp ) )
                    ; 

                if( _p.is( &#x27;[dateFormat]&#x27; ) || _p.is( &#x27;[fullDateFormat]&#x27; ) ){
                    var _ins = Calendar.getInstance( _selector );
                    !_ins &amp;&amp; ( _ins = new Calendar( _selector ) );
                    _ins.updateSelector( _selector );
                    _ins.updateFormat( _p );
                }

                if( ( _p.attr(&#x27;datatype&#x27;) || &#x27;&#x27; ).toLowerCase() == &#x27;monthday&#x27;
                    || ( _p.attr(&#x27;multidate&#x27;) || &#x27;&#x27; ).toLowerCase() == &#x27;monthday&#x27; ){
                    if( !_p.is(&#x27;[placeholder]&#x27;) ){
                        var _tmpDate = new Date();
                        _p.attr(&#x27;defaultdate&#x27;) &amp;&amp; ( _tmpDate = JC.f.parseISODate( _p.attr(&#x27;defaultdate&#x27;) ) || _tmpDate );
                        _p.val().trim() &amp;&amp; ( _tmpDate = JC.f.parseISODate( _p.val().replace( /[^d]/g, &#x27;&#x27;).slice( 0, 8 ) ) || _tmpDate );
                        _tmpDate &amp;&amp; _p.attr( &#x27;placeholder&#x27;, JC.f.printf( &#x27;{0}年 {1}月&#x27;, _tmpDate.getFullYear(), _tmpDate.getMonth() + 1 ) );
                    }
                }

                _btn.data( Calendar.Model.INPUT, _p );
            });
        };

    Calendar.fixDefaultDate =
        function( _selector ){
            _selector &amp;&amp; ( _selector = $( _selector ) );
            if( !( _selector &amp;&amp; _selector.length ) ) return;
            var _tmp;

            _tmp = _selector.val().trim();
            if( _tmp ){
                _tmp = _tmp
                        .replace( Calendar.Model.REG_REMOVE_NOT_DIGITAL, &#x27;&#x27; )
                        .replace( Calendar.Model.REG_REMOVE_ALL_ZERO, &#x27;&#x27; )
                        ;
                !_tmp &amp;&amp; _selector.val( &#x27;&#x27; );
            }

            _tmp = ( _selector.attr( &#x27;minvalue&#x27;) || &#x27;&#x27; ).trim();
            if( _tmp ){
                _tmp = _tmp
                        .replace( Calendar.Model.REG_REMOVE_NOT_DIGITAL, &#x27;&#x27; )
                        .replace( Calendar.Model.REG_REMOVE_ALL_ZERO, &#x27;&#x27; )
                        ;
                !_tmp &amp;&amp; _selector.removeAttr( &#x27;minvalue&#x27; );
            }

            _tmp = ( _selector.attr( &#x27;maxvalue&#x27;) || &#x27;&#x27; ).trim();
            if( _tmp ){
                _tmp = _tmp
                        .replace( Calendar.Model.REG_REMOVE_NOT_DIGITAL, &#x27;&#x27; )
                        .replace( Calendar.Model.REG_REMOVE_ALL_ZERO, &#x27;&#x27; )
                        ;
                !_tmp &amp;&amp; _selector.removeAttr( &#x27;maxvalue&#x27; );
            }
        };

    Calendar.updateMultiYear =
        function ( _date, _offset ){
            var _day, _max;
            _day = _date.getDate();
            _date.setDate( 1 );
            _date.setFullYear( _date.getFullYear() + _offset );
            _max = JC.f.maxDayOfMonth( _date );
            _day &gt; _max &amp;&amp; ( _day = _max );
            _date.setDate( _day );
            return _date;
        };

    Calendar.updateMultiMonth =
        function ( _date, _offset ){
            var _day, _max;
            _day = _date.getDate();
            _date.setDate( 1 );
            _date.setMonth( _date.getMonth() + _offset );
            _max = JC.f.maxDayOfMonth( _date );
            _day &gt; _max &amp;&amp; ( _day = _max );
            _date.setDate( _day );
            return _date;
        };


    /**
     * 克隆 Calendar 默认 Model, View 的原型属性
     * @method  clone
     * @param   {NewModel}  _model
     * @param   {NewView}   _view
     */
    Calendar.clone =
        function( _model, _view ){
            var _k;
            if( _model )
                for( _k in Model.prototype ) _model.prototype[_k] = Model.prototype[_k];
            if( _view )
                for( _k in View.prototype ) _view.prototype[_k] = View.prototype[_k];
        };
    
    function Model( _selector ){
        this._selector = _selector;
    }

    Calendar.Model = Model;
    Calendar.Model.INPUT = &#x27;CalendarInput&#x27;;

    Calendar.Model.INITED = &#x27;CalendarInited&#x27;;
    Calendar.Model.SHOW = &#x27;CalendarShow&#x27;;
    Calendar.Model.HIDE = &#x27;CalendarHide&#x27;;
    Calendar.Model.UPDATE = &#x27;CalendarUpdate&#x27;;
    Calendar.Model.CLEAR = &#x27;CalendarClear&#x27;;
    Calendar.Model.CANCEL = &#x27;CalendarCancel&#x27;;
    Calendar.Model.LAYOUT_CHANGE = &#x27;CalendarLayoutChange&#x27;;
    Calendar.Model.UPDATE_MULTISELECT = &#x27;CalendarUpdateMultiSelect&#x27;;

    Calendar.Model.REG_REMOVE_ALL_ZERO = /^[0]+$/;
    Calendar.Model.REG_REMOVE_NOT_DIGITAL = /[^\d]+/g;
    
    Model.prototype = {
        init:
            function(){
                return this;
            }

        , selector: 
            function( _setter ){ 
                typeof _setter != &#x27;undefined&#x27; &amp;&amp; ( this._selector = _setter );
                return this._selector; 
            }
        , layout: 
            function(){
                var _r = $(&#x27;#UXCCalendar&#x27;);

                if( !_r.length ){
                    _r = $( Calendar.tpl || this.tpl ).hide();
                    _r.attr(&#x27;id&#x27;, &#x27;UXCCalendar&#x27;).hide().appendTo( document.body );
                    var _month = $( [
                                &#x27;&lt;option value=&quot;0&quot;&gt;一月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;1&quot;&gt;二月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;2&quot;&gt;三月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;3&quot;&gt;四月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;4&quot;&gt;五月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;5&quot;&gt;六月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;6&quot;&gt;七月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;7&quot;&gt;八月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;8&quot;&gt;九月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;9&quot;&gt;十月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;10&quot;&gt;十一月&lt;/option&gt;&#x27;
                                , &#x27;&lt;option value=&quot;11&quot;&gt;十二月&lt;/option&gt;&#x27;
                            ].join(&#x27;&#x27;) ).appendTo( _r.find(&#x27;select.UMonth&#x27; ) );
                 }
                return _r;
            }
        , startYear:
            function( _dateo ){
                var _span = Calendar.defaultDateSpan, _r = _dateo.date.getFullYear();
                this.selector().is(&#x27;[calendardatespan]&#x27;) 
                    &amp;&amp; ( _span = parseInt( this.selector().attr(&#x27;calendardatespan&#x27;), 10 ) );
                return _r - _span;
            }
        , endYear:
            function( _dateo ){
                var _span = Calendar.defaultDateSpan, _r = _dateo.date.getFullYear();
                this.selector().is(&#x27;[calendardatespan]&#x27;) 
                    &amp;&amp; ( _span = parseInt( this.selector().attr(&#x27;calendardatespan&#x27;), 10 ) );
                return _r + _span;
            }
        , currentcanselect:
            function(){
                var _r = true;
                this.selector().is(&#x27;[currentcanselect]&#x27;) 
                    &amp;&amp; ( _r = JC.f.parseBool( this.selector().attr(&#x27;currentcanselect&#x27;) ) );
                return _r;
            }
        , year: 
            function(){
                return parseInt( this.layout().find(&#x27;select.UYear&#x27;).val(), 10 ) || 1;
            }
        , month:
            function(){
                return parseInt( this.layout().find(&#x27;select.UMonth&#x27;).val(), 10 ) || 0;
            }
        , day:
            function(){
                var _tmp, _date = new Date();
                _tmp = this.layout().find(&#x27;td.cur &gt; a[date], td.cur &gt; a[dstart]&#x27;);
                if( _tmp.length ){
                    _date.setTime( _tmp.attr(&#x27;date&#x27;) || _tmp.attr(&#x27;dstart&#x27;) );
                }
                return _date.getDate();
            }
        , defaultDate:
            function(){
                var _p = this, _r = { 
                        date: null
                        , minvalue: null
                        , maxvalue: null
                        , enddate: null 
                        , multidate: null
                    }
                    ;
                _p.selector() &amp;&amp;
                    (
                        _r = _p.multiselect() 
                            ? _p.defaultMultiselectDate( _r ) 
                            : _p.defaultSingleSelectDate( _r )
                    );


                if(  _p.dateParse( _p.selector() ) ){
                    //var _d = _p.dateParse();
                    _p.selector().is(&#x27;[minvalue]&#x27;)
                        &amp;&amp; ( _r.minvalue = ( _p.dateParse( _p.selector() )( _p.selector().attr(&#x27;minvalue&#x27;) ) ).start );

                    _p.selector().is(&#x27;[maxvalue]&#x27;)
                        &amp;&amp; ( _r.maxvalue = ( _p.dateParse( _p.selector() )( _p.selector().attr(&#x27;maxvalue&#x27;) ) ).start );
                }else{
                    _p.selector().is(&#x27;[minvalue]&#x27;)
                        &amp;&amp; ( _r.minvalue = JC.f.parseISODate( _p.selector().attr(&#x27;minvalue&#x27;) ) );

                    _p.selector().is(&#x27;[maxvalue]&#x27;)
                        &amp;&amp; ( _r.maxvalue = JC.f.parseISODate( _p.selector().attr(&#x27;maxvalue&#x27;) ) );
                }

                _r.minvalue &amp;&amp; ( _r.minvalue = JC.f.pureDate( _r.minvalue ) );
                _r.maxvalue &amp;&amp; ( _r.maxvalue = JC.f.pureDate( _r.maxvalue ) );

                return _r;
            }
        , defaultSingleSelectDate:
            function( _r ){
                var _p = this
                    , _selector = _p.selector()
                    , _tmp
                    , _v = _selector.val().trim()
                    ;

                if( !_v ){
                    _r.date = new Date();

                    if( Calendar.lastIpt &amp;&amp; Calendar.lastIpt.is(&#x27;[defaultdate]&#x27;) ){
                        _tmp = JC.f.parseISODate( Calendar.lastIpt.attr(&#x27;defaultdate&#x27;) ) || _tmp;
                    }
                    _tmp &amp;&amp; ( _r.date = JC.f.pureDate( _tmp ) );

                    _r.enddate = JC.f.cloneDate( _r.date );
                    return _r;
                }

                if( _p.dateParse( _p.selector() ) ){
                    var _tmpDataObj = _p.dateParse( _p.selector() )( _p.selector().val().trim() );
                        _r.date = _tmpDataObj.start;
                        _r.enddate = _tmpDataObj.end;
                        !_r.enddate &amp;&amp; ( _r.enddate = _r.date );
                }else{
                    if( _tmp = JC.f.parseISODate( _selector.val() ) ) _r.date = _tmp;
                    else{
                        if( _selector.val() &amp;&amp; (_tmp = _selector.val().replace( /[^\d]/g, &#x27;&#x27; ) ).length == 16 ){
                            _r.date = JC.f.parseISODate( _tmp.slice( 0, 8 ) );
                            _r.enddate = JC.f.parseISODate( _tmp.slice( 8 ) );
                        }else{
                            _tmp = new Date();
                            if( Calendar.lastIpt &amp;&amp; Calendar.lastIpt.is(&#x27;[defaultdate]&#x27;) ){
                                _tmp = JC.f.parseISODate( Calendar.lastIpt.attr(&#x27;defaultdate&#x27;) ) || _tmp;
                            }
                            _r.date = new Date( _tmp.getFullYear(), _tmp.getMonth(), _tmp.getDate() );
                        }
                    }

                }


                return _r;
            }
        , defaultMultiselectDate:
            function( _r ){
                var _p = this
                    , _selector = Calendar.lastIpt
                    , _tmp
                    , _multidatear
                    , _dstart, _dend
                    ;

                    if( _selector.val() ){
                        //JC.log( &#x27;defaultMultiselectDate:&#x27;, _p.selector().val(), &#x27;, &#x27;, _tmp );
                        _tmp = _selector.val().trim().replace(/[^\d,]/g, &#x27;&#x27;).split(&#x27;,&#x27;);
                        _multidatear = [];


                        $.each( _tmp, function( _ix, _item ){

                            if( _p.dateParse( _selector ) ){
                                var _tmpDataObj = _p.dateParse( _selector )( _item );
                                    _dstart = _tmpDataObj.start;
                                    _dend = _tmpDataObj.end;
                                    !_dend &amp;&amp; ( _dend = _dstart );
                                    _multidatear.push( { &#x27;start&#x27;: _dstart, &#x27;end&#x27;: _dend } );
                            }else{

                                if( _item.length == 16 ){
                                    _dstart = JC.f.parseISODate( _item.slice( 0, 8 ) );
                                    _dend = JC.f.parseISODate( _item.slice( 8 ) );

                                    if( !_ix ){
                                        _r.date = JC.f.cloneDate( _dstart );
                                        _r.enddate = JC.f.cloneDate( _dend );
                                    }
                                    _multidatear.push( { &#x27;start&#x27;: _dstart, &#x27;end&#x27;: _dend } );
                                }else if( _item.length == 8 ){
                                    _dstart = JC.f.parseISODate( _item.slice( 0, 8 ) );
                                    _dend = JC.f.cloneDate( _dstart );

                                    if( !_ix ){
                                        _r.date = JC.f.cloneDate( _dstart );
                                        _r.enddate = JC.f.cloneDate( _dend );
                                    }
                                    _multidatear.push( { &#x27;start&#x27;: _dstart, &#x27;end&#x27;: _dend } );
                                }
                            }
                        });

                        _r.multidate = _multidatear;

                    }else{
                        _tmp = new Date();
                        if( Calendar.lastIpt &amp;&amp; Calendar.lastIpt.is(&#x27;[defaultdate]&#x27;) ){
                            _tmp = JC.f.parseISODate( Calendar.lastIpt.attr(&#x27;defaultdate&#x27;) ) || _tmp;
                        }
                        _r.date = new Date( _tmp.getFullYear(), _tmp.getMonth(), _tmp.getDate() );
                        _r.enddate = JC.f.cloneDate( _r.date );
                        _r.enddate.setDate( JC.f.maxDayOfMonth( _r.enddate ) );
                        _r.multidate = [];
                        _r.multidate.push( {&#x27;start&#x27;: JC.f.cloneDate( _r.date ), &#x27;end&#x27;: JC.f.cloneDate( _r.enddate ) } );
                    }
                return _r;
            }
        , layoutDate:
            function(){
                return this.multiselect() ? this.multiLayoutDate() : this.singleLayoutDate();
            }
        , singleLayoutDate:
            function(){
                var _p = this
                    , _dateo = _p.defaultDate()
                    , _day = this.day()
                    , _max;
                _dateo.date.setDate( 1 );
                _dateo.date.setFullYear( this.year() );
                _dateo.date.setMonth( this.month() );
                _max = JC.f.maxDayOfMonth( _dateo.date );
                _day &gt; _max &amp;&amp; ( _day = _max );
                _dateo.date.setDate( _day );
                return _dateo;
            }
        , multiLayoutDate:
            function(){
                //JC.log( &#x27;Calendar.Model multiLayoutDate&#x27;, new Date().getTime() );
                var _p = this
                    , _dateo = _p.defaultDate()
                    , _year = _p.year()
                    , _month = _p.month()
                    , _day = _p.day()
                    , _newDate = new Date( _year, _month, 1 )
                    , _max = JC.f.maxDayOfMonth( _newDate )
                    , _monthSel = _p.layout().find(&#x27;select.UMonth&#x27;)
                    ;

                //JC.log( &#x27;eeeeeeeeeee&#x27;, _month );

                _dateo.multidate = [];

                _p.layout().find(&#x27;td.cur&#x27;).each(function(){
                    var _sp = $(this);
                    var _item = _sp.find(&#x27;&gt; a[dstart]&#x27;), _dstart = new Date(), _dend = new Date();
                    _dstart.setTime( _item.attr(&#x27;dstart&#x27;) );
                    _dend.setTime( _item.attr(&#x27;dend&#x27;) );
                    _dateo.multidate.push( { &#x27;start&#x27;: _dstart, &#x27;end&#x27;: _dend } );
                });

                /*
                _dateo.date.setFullYear( _year );
                _dateo.enddate.setFullYear( _year );
                */
                _dateo.date = new Date( _year, _month, 1 );
                _dateo.date.enddate = new Date( _year, _month, _max );

                if( _monthSel.length ){
                    _dateo.date.setMonth( _month );
                    _dateo.enddate.setMonth( _month );
                }


                $.each( _dateo.multidate, function( _ix, _item ){
                    _item.start.setFullYear( _year );
                    _item.end.setFullYear( _year );
                    if( _monthSel.length ){
                        _item.start.setMonth( _month );
                        _item.end.setMonth( _month );
                    }
                });

                return _dateo;

            }
        , selectedDate:
            function(){
                var _r, _tmp, _item;
                _tmp = this.layout().find(&#x27;td.cur&#x27;);
                _tmp.length 
                    &amp;&amp; !_tmp.hasClass( &#x27;unable&#x27; )
                    &amp;&amp; ( _item = _tmp.find(&#x27;a[date]&#x27;) )
                    &amp;&amp; ( _r = new Date(), _r.setTime( _item.attr(&#x27;date&#x27;) ) )
                    ;
                return _r;
            }
        , multiselectDate:
            function(){
                var _r = [];
                return _r;
            }
        , calendarinited:
            function(){
                var _ipt = this.selector(), _cb = Calendar.layoutInitedCallback, _tmp;
                _ipt &amp;&amp; _ipt.attr(&#x27;calendarinited&#x27;) 
                    &amp;&amp; ( _tmp = window[ _ipt.attr(&#x27;calendarinited&#x27;) ] )
                    &amp;&amp; ( _cb = _tmp );
                return _cb;
            }
        , calendarshow:
            function(){
                var _ipt = this.selector(), _cb = Calendar.layoutShowCallback, _tmp;
                _ipt &amp;&amp; _ipt.attr(&#x27;calendarshow&#x27;) 
                    &amp;&amp; ( _tmp = window[ _ipt.attr(&#x27;calendarshow&#x27;) ] )
                    &amp;&amp; ( _cb = _tmp );
                return _cb;
            }
        , calendarhide:
            function(){
                var _ipt = this.selector(), _cb = Calendar.layoutHideCallback, _tmp;
                _ipt &amp;&amp; _ipt.attr(&#x27;calendarhide&#x27;) 
                    &amp;&amp; ( _tmp = window[ _ipt.attr(&#x27;calendarhide&#x27;) ] )
                    &amp;&amp; ( _cb = _tmp );
                return _cb;
            }
        , calendarupdate:
            function( _data ){
                var _ipt = this.selector(), _cb, _tmp;
                _ipt &amp;&amp; _ipt.attr(&#x27;calendarupdate&#x27;) 
                    &amp;&amp; ( _tmp = window[ _ipt.attr(&#x27;calendarupdate&#x27;) ] )
                    &amp;&amp; ( _cb = _tmp );
                return _cb;
            }
        , calendarclear:
            function(){
                var _ipt = this.selector(), _cb, _tmp;
                _ipt &amp;&amp; _ipt.attr(&#x27;calendarclear&#x27;) 
                    &amp;&amp; ( _tmp = window[ _ipt.attr(&#x27;calendarclear&#x27;) ] )
                    &amp;&amp; ( _cb = _tmp );
                return _cb;
            }
        , calendarcancel:
            function(){
                var _ipt = this.selector(), _cb, _tmp;
                _ipt &amp;&amp; _ipt.attr(&#x27;calendarcancel&#x27;) 
                    &amp;&amp; ( _tmp = window[ _ipt.attr(&#x27;calendarcancel&#x27;) ] )
                    &amp;&amp; ( _cb = _tmp );
                return _cb;
            }
        , calendarlayoutchange:
            function(){
                var _ipt = this.selector(), _cb, _tmp;
                _ipt &amp;&amp; _ipt.attr(&#x27;calendarlayoutchange&#x27;) 
                    &amp;&amp; ( _tmp = window[ _ipt.attr(&#x27;calendarlayoutchange&#x27;) ] )
                    &amp;&amp; ( _cb = _tmp );
                return _cb;
            }
        , multiselect:
            function(){
                var _r;
                this.selector().is(&#x27;[multiselect]&#x27;)
                    &amp;&amp; ( _r = JC.f.parseBool( this.selector().attr(&#x27;multiselect&#x27;) ) );
                return _r;
            }
        , calendarupdatemultiselect:
            function( _data ){
                var _ipt = this.selector(), _cb, _tmp;
                _ipt &amp;&amp; _ipt.attr(&#x27;calendarupdatemultiselect&#x27;) 
                    &amp;&amp; ( _tmp = window[ _ipt.attr(&#x27;calendarupdatemultiselect&#x27;) ] )
                    &amp;&amp; ( _cb = _tmp );
                return _cb;
            }
        
        , updateFormat:
            function( _selector ){
                _selector &amp;&amp; ( _selector = $( _selector ) );
                if( !( _selector &amp;&amp; _selector.length ) ) return;
                var _p = this
                    , _type = ( _selector.attr(&#x27;datetype&#x27;) || _selector.attr(&#x27;multidate&#x27;) || &#x27;&#x27; ).toLowerCase().trim() 
                    , _v = _selector.val().trim()
                    , _dp = _p.dateParse( _selector )
                    , _dstart, _dend
                    , _do
                    ;
                if( !_v ) return;

                if( _type == &#x27;date&#x27; &amp;&amp; !_selector.attr( &#x27;fullDateFormat&#x27; ) ){
                    _selector.attr( &#x27;fullDateFormat&#x27;, &#x27;{0}&#x27; );
                }

                if( _dp ){
                    switch( _type ){
                        case &#x27;date&#x27;: 
                            {
                                break;
                            }
                        case &#x27;week&#x27;:
                        case &#x27;month&#x27;:
                        case &#x27;season&#x27;:
                        case &#x27;year&#x27;:
                            {
                                _do = _dp( _v );
                                _selector.val( _p.fullFormat( _p.dateFormat( _do.start, _selector )
                                                                , _p.dateFormat( _do.end, _selector )
                                                                , _selector 
                                            ) );

                                break;
                            }
                    }
                }else{
                    switch( _type ){
                        case &#x27;date&#x27;: 
                            {
                                _dstart = JC.f.parseISODate( _v );
                                _selector.val( _p.dateFormat( _dstart, _selector ) || _v );
                                break;
                            }
                    }
                }
            }

        , dateFormat:
            function( _date, _selector ){
                _selector = _selector || this.selector();
                var _r = &#x27;&#x27;, _format = _selector.attr( &#x27;dateFormat&#x27; ) || &#x27;YY-MM-DD&#x27;;
                _date &amp;&amp; ( _r = JC.f.dateFormat( _date, _format ) );
                return _r;
            }

        , fullFormat:
            function( _date, _endDate, _selector ){
                _selector = _selector || this.selector();
                var _r = &#x27;&#x27;, _fullFormat = _selector.attr( &#x27;fullDateFormat&#x27; ) || &#x27;{0} 至 {1}&#x27;;
                if( _date &amp;&amp; _endDate ){
                    _r = JC.f.printf( _fullFormat, this.dateFormat( _date, _selector ), this.dateFormat( _endDate, _selector ) );
                }else if( _date ){
                    _r = JC.f.printf( _fullFormat, this.dateFormat( _date, _selector ) );
                }else if( _endDate ){
                    _r = JC.f.printf( _fullFormat, this.dateFormat( _endDate, _selector ) );
                }
                return _r;
            }

        , dateParse:
            function( _selector ){
                var _r;

                _selector
                    &amp;&amp; _selector.attr( &#x27;dateParse&#x27; )
                    &amp;&amp; ( _r = window[ _selector.attr( &#x27;dateParse&#x27; ) ] )
                    ;

                return _r;
            }

        , tpl:
            [
            &#x27;&lt;div id=&quot;UXCCalendar&quot; class=&quot;UXCCalendar&quot;&gt;&#x27;
            ,&#x27;    &lt;div class=&quot;UHeader&quot;&gt;&#x27;
            ,&#x27;        &lt;select class=&quot;UYear&quot;&gt;&lt;/select&gt;&#x27;
            ,&#x27;        &lt;img class=&quot;UImg yearctl&quot; align=&quot;absMiddle&quot; usemap=&quot;#UXCCalendar_Year&quot; /&gt;&#x27;
            ,&#x27;        &lt;map name=&quot;UXCCalendar_Year&quot;&gt;&lt;area shape=&quot;rect&quot; coords=&quot;0,0,13,8&quot; href=&quot;#&quot; action=&quot;up&quot;&gt;&lt;area shape=&quot;rect&quot; coords=&quot;0,10,13,17&quot; href=&quot;#&quot; action=&quot;down&quot;&gt;&lt;/map&gt;&#x27;
            ,&#x27;        &lt;select class=&quot;UMonth&quot;&gt;&lt;/select&gt;&#x27;
            ,&#x27;        &lt;img class=&quot;UImg monthctl&quot; align=&quot;absMiddle&quot; usemap=&quot;#UXCCalendar_Month&quot;  /&gt;&#x27;
            ,&#x27;        &lt;map name=&quot;UXCCalendar_Month&quot;&gt;&lt;area shape=&quot;rect&quot; coords=&quot;0,0,13,8&quot; href=&quot;#&quot; action=&quot;up&quot;&gt;&lt;area shape=&quot;rect&quot; coords=&quot;0,10,13,17&quot; href=&quot;#&quot; action=&quot;down&quot;&gt;&lt;/map&gt;&#x27;
            ,&#x27;    &lt;/div&gt;&#x27;
            ,&#x27;    &lt;table class=&quot;UTable&quot;&gt;&#x27;
            ,&#x27;        &lt;thead&gt;&#x27;
            ,&#x27;            &lt;tr&gt;&#x27;
            ,&#x27;                &lt;th&gt;一&lt;/th&gt;&#x27;
            ,&#x27;                &lt;th&gt;二&lt;/th&gt;&#x27;
            ,&#x27;                &lt;th&gt;三&lt;/th&gt;&#x27;
            ,&#x27;                &lt;th&gt;四&lt;/th&gt;&#x27;
            ,&#x27;                &lt;th&gt;五&lt;/th&gt;&#x27;
            ,&#x27;                &lt;th&gt;六&lt;/th&gt;&#x27;
            ,&#x27;                &lt;th&gt;日&lt;/th&gt;&#x27;
            ,&#x27;            &lt;/tr&gt;&#x27;
            ,&#x27;        &lt;/thead&gt;&#x27;
            ,&#x27;   &lt;/table&gt;&#x27;
            ,&#x27;   &lt;table class=&quot;UTable UTableBorder&quot;&gt;&#x27;
            ,&#x27;        &lt;tbody&gt;&#x27;
            ,&#x27;           &lt;!--&lt;tr&gt;&#x27;
            ,&#x27;                &lt;td class=&quot;cur&quot;&gt;&lt;a href=&quot;#&quot;&gt;2&lt;/a&gt;&lt;/td&gt;&#x27;
            ,&#x27;                &lt;td class=&quot;unable&quot;&gt;&lt;a href=&quot;#&quot;&gt;2&lt;/a&gt;&lt;/td&gt;&#x27;
            ,&#x27;                &lt;td class=&quot;weekend cur&quot;&gt;&lt;a href=&quot;#&quot;&gt;6&lt;/a&gt;&lt;/td&gt;&#x27;
            ,&#x27;                &lt;td class=&quot;weekend hover&quot;&gt;&lt;a href=&quot;#&quot;&gt;13&lt;/a&gt;&lt;/td&gt;&#x27;
            ,&#x27;                &lt;td class=&quot;weekend other&quot;&gt;&lt;a href=&quot;#&quot;&gt;41&lt;/a&gt;&lt;/td&gt;&#x27;
            ,&#x27;                &lt;td class=&quot;weekend other&quot;&gt;&lt;a href=&quot;#&quot;&gt;42&lt;/a&gt;&lt;/td&gt;&#x27;
            ,&#x27;            &lt;/tr&gt;--&gt;&#x27;
            ,&#x27;        &lt;/tbody&gt;&#x27;
            ,&#x27;    &lt;/table&gt;&#x27;
            ,&#x27;    &lt;div class=&quot;UFooter&quot;&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UConfirm&quot;&gt;确定&lt;/button&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UClear&quot;&gt;清空&lt;/button&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UCancel&quot;&gt;取消&lt;/button&gt;&#x27;
            ,&#x27;    &lt;/div&gt;&#x27;
            ,&#x27;&lt;/div&gt;&#x27;
            ].join(&#x27;&#x27;)
    };
    
    function View( _model ){
        this._model = _model;
    }
    Calendar.View = View;
    
    View.prototype = {
        init:
            function() {
                return this;
            }

        , hide:
            function(){
                this._model.layout().hide();
            }

        , show:
            function(){
                var _dateo = this._model.defaultDate();
                //JC.log( &#x27;Calendar.View: show&#x27;, new Date().getTime(), JC.f.formatISODate( _dateo.date ) );

                this._buildLayout( _dateo );
                this._buildDone();
            }
        , updateLayout:
            function( _dateo ){
                typeof _dateo == &#x27;undefined&#x27; &amp;&amp; ( _dateo = this._model.layoutDate() );
                /*
                JC.log( 
                        JC.f.formatISODate( _dateo.date ) 
                        , JC.f.formatISODate( _dateo.minvalue) 
                        , JC.f.formatISODate( _dateo.maxvalue) 
                        );
                */

                if( _dateo.minvalue || _dateo.maxvalue ){
                    if( _dateo.minvalue &amp;&amp; _dateo.date.getTime() &lt; _dateo.minvalue.getTime() ){
                        _dateo.date = JC.f.cloneDate( _dateo.minvalue );
                    }
                    if( _dateo.maxvalue &amp;&amp; _dateo.date.getTime() &gt; _dateo.maxvalue.getTime() ){
                        _dateo.date = JC.f.cloneDate( _dateo.maxvalue );
                    }
                }

                this._buildLayout( _dateo );
                this._buildDone();
            }
        , updateYear:
            function( _offset ){
                if( typeof _offset == &#x27;undefined&#x27; || _offset == 0 ) return;

                var _dateo = this._model.layoutDate(), _date;
                if( _dateo.minvalue || _dateo.maxvalue ){
                    var _fixYear;
                    _date = JC.f.cloneDate( _dateo.date );
                    _date.setFullYear( _date.getFullYear() + _offset );
                    if( _dateo.minvalue ){
                        if( _date.getFullYear() &lt; _dateo.minvalue.getFullYear() ){
                            _date = JC.f.cloneDate( _dateo.minvalue );
                            _offset = 0;
                            _fixYear = true;
                        }else if( new Date( _date.getFullYear(), _date.getMonth(), 1 ).getTime() &lt;
                            new Date( _dateo.minvalue.getFullYear(), _dateo.minvalue.getMonth(), 1 ).getTime() ){
                            _offset = 0;
                            _date = JC.f.cloneDate( _dateo.minvalue );
                            _fixYear = true;
                        }
                    }
                    if( _dateo.maxvalue ){
                        if( _date.getFullYear() &gt; _dateo.maxvalue.getFullYear() ){
                            _offset = 0;
                            _date = JC.f.cloneDate( _dateo.maxvalue );
                            _fixYear = true;
                        }else if( new Date( _date.getFullYear(), _date.getMonth(), 1 ).getTime() &gt;
                            new Date( _dateo.maxvalue.getFullYear(), _dateo.maxvalue.getMonth(), 1 ).getTime() ){
                            _offset = 0;
                            _date = JC.f.cloneDate( _dateo.maxvalue );
                            _fixYear = true;
                        }
                    }
                    if( !_fixYear ) _date = null;
                    else {
                    }
                }

                this._model.multiselect() 
                    ? this.updateMultiYear( _offset, _date )
                    : this.updateSingleYear( _offset, _date )
                    ;
            }
        , updateSingleYear:
            function( _offset, _date ){
                var _dateo = this._model.layoutDate();

                if( _date ){
                    _dateo.date = _date;
                }else{
                    var _day = _dateo.date.getDate(), _max;
                    _dateo.date.setDate( 1 );
                    _dateo.date.setFullYear( _dateo.date.getFullYear() + _offset );
                    _max = JC.f.maxDayOfMonth( _dateo.date );
                    _day &gt; _max &amp;&amp; ( _day = _max );
                    _dateo.date.setDate( _day );
                }
                this._buildLayout( _dateo );
                this._buildDone();
            }
        , updateMultiYear:
            function( _offset, _date ){
                var _dateo = this._model.layoutDate();
                _dateo.date = _date || _dateo.date;
                var _day, _max;

                JC.Calendar.updateMultiYear( _dateo.date, _offset );
                JC.Calendar.updateMultiYear( _dateo.enddate, _offset );

                if( _dateo.multidate ){
                    $.each( _dateo.multidate, function( _ix, _item ){
                        JC.Calendar.updateMultiYear( _item.start, _offset );
                        JC.Calendar.updateMultiYear( _item.end, _offset );
                    });
                }
                this._buildLayout( _dateo );
                this._buildDone();
            }
        , updateMonth:
            function( _offset ){
                if( typeof _offset == &#x27;undefined&#x27; || _offset == 0 ) return;

                var _dateo = this._model.layoutDate(), _date;
                if( _dateo.minvalue || _dateo.maxvalue ){
                    _date = JC.f.cloneDate( _dateo.date );
                    _date.setDate( 1 );
                    _date.setMonth( _date.getMonth() + _offset );
                    var _minvalue = _dateo.minvalue ? JC.f.cloneDate( _dateo.minvalue ) : null
                        , _maxvalue = _dateo.maxvalue ? JC.f.cloneDate( _dateo.maxvalue ) : null
                        , _fixDate
                        ;
                    _minvalue &amp;&amp; _minvalue.setDate( 1 );
                    _maxvalue &amp;&amp; _maxvalue.setDate( 1 );
                    if( _minvalue ){
                        if( _date.getTime() &lt; _minvalue.getTime() ) {
                            _offset = 0;
                            _date = JC.f.cloneDate( _dateo.minvalue );
                            _fixDate = true;
                        }
                        if( new Date( _date.getFullYear(), _date.getMonth(), 1 ).getTime() &lt;
                            new Date( _dateo.minvalue.getFullYear(), _dateo.minvalue.getMonth(), 1 ).getTime() ){
                            _offset = 0;
                            _date = JC.f.cloneDate( _dateo.minvalue );
                            _fixDate = true;
                        }

                    }
                    if( _maxvalue ){
                        if( _date.getTime() &gt; _maxvalue.getTime() ) {
                            _offset = 0;
                            _date = JC.f.cloneDate( _dateo.maxvalue );
                            _fixDate = true;
                        }
                        if( new Date( _date.getFullYear(), _date.getMonth(), 1 ).getTime() &gt;
                            new Date( _dateo.maxvalue.getFullYear(), _dateo.maxvalue.getMonth(), 1 ).getTime() ){
                            _offset = 0;
                            _date = JC.f.cloneDate( _dateo.maxvalue );
                            _fixDate = true;
                        }
                    }
                    if( !_fixDate ) {
                        _date = null;
                    }else{
                        var _md = JC.f.maxDayOfMonth( _date ), _newD = _dateo.date.getDate();
                        _newD &gt; _md &amp;&amp; ( _newD = _md );
                        _date.setDate( _newD );
                    }
                }

                this._model.multiselect() 
                    ? this.updateMultiMonth( _offset, _date )
                    : this.updateSingleMonth( _offset, _date )
                    ;
            }
        , updateMultiMonth:
            function( _offset, _date ){
                var _dateo = this._model.layoutDate(), _day, _max;
                if( _date ){
                    _dateo.date = _date;
                    _offset = 0;
                }else{
                    JC.Calendar.updateMultiMonth( _dateo.date, _offset );
                    JC.Calendar.updateMultiMonth( _dateo.enddate, _offset );

                    if( _dateo.multidate ){
                        $.each( _dateo.multidate, function( _ix, _item ){
                            JC.Calendar.updateMultiMonth( _item.start, _offset );
                            JC.Calendar.updateMultiMonth( _item.end, _offset );
                        });
                    }
                }

                this._buildLayout( _dateo );
                this._buildDone();
            }
        , updateSingleMonth:
            function( _offset, _date ){
                var _dateo = this._model.layoutDate()

                if( _date ){
                    _dateo.date = _date;
                }else{
                    var _day = _dateo.date.getDate(), _max;

                    _dateo.date.setDate( 1 );
                    _dateo.date.setMonth( _dateo.date.getMonth() + _offset );
                    _max = JC.f.maxDayOfMonth( _dateo.date );
                    _day &gt; _max &amp;&amp; ( _day = _max );
                    _dateo.date.setDate( _day );
                }
                this._buildLayout( _dateo );
                this._buildDone();
            }
        , updateSelected:
            function( _userSelectedItem ){
                var _p = this, _date, _tmp;
                if( !_userSelectedItem ){
                    _date = this._model.selectedDate(); 
                }else{
                    _userSelectedItem = $( _userSelectedItem );
                    _tmp = JC.f.getJqParent( _userSelectedItem, &#x27;td&#x27; );
                    if( _tmp &amp;&amp; _tmp.hasClass(&#x27;unable&#x27;) ) return;
                    _date = new Date();
                    _date.setTime( _userSelectedItem.attr(&#x27;date&#x27;) );
                }
                if( !_date ) return;

                _p._model.selector().val( _p._model.dateFormat( _date ) );

                $(_p).trigger( &#x27;TriggerEvent&#x27;, [ JC.Calendar.Model.UPDATE, &#x27;date&#x27;, _date, _date ] );
                Calendar.hide();
            }
        , updatePosition:
            function(){
                var _p = this, _ipt = _p._model.selector(), _layout = _p._model.layout();
                if( !( _ipt &amp;&amp; _layout &amp;&amp; _ipt.length &amp;&amp; _layout.length ) ) return;
                _layout.css( {&#x27;left&#x27;: &#x27;-9999px&#x27;, &#x27;top&#x27;: &#x27;-9999px&#x27;, &#x27;z-index&#x27;: ZINDEX_COUNT++ } ).show();
                var _lw = _layout.width(), _lh = _layout.height()
                    , _iw = _ipt.width(), _ih = _ipt.height(), _ioset = _ipt.offset()
                    , _x, _y, _winw = $(window).width(), _winh = $(window).height()
                    , _scrleft = $(document).scrollLeft()
                    , _scrtop = $(document).scrollTop()
                    ;

                _x = _ioset.left; _y = _ioset.top + _ih + 5;

                if( ( _y + _lh - _scrtop ) &gt; _winh ){
                    _y = _ioset.top - _lh - 3;
                    _y &lt; _scrtop &amp;&amp; ( _y = _scrtop );
                }

                if( ( _x + _lw -_scrleft ) &gt; _winw ){
                    _x = _winw - _lw + _scrleft - 5;
                }
                _x &lt; _scrleft &amp;&amp; ( _x = _scrleft + 0 );

                _layout.css( {left: _x+&#x27;px&#x27;, top: _y+&#x27;px&#x27;} );

                /*
                JC.log( _lw, _lh, _iw, _ih, _ioset.left, _ioset.top, _winw, _winh );
                JC.log( _scrtop, _x, _y );
                */
            }
        , _buildDone:
            function(){
                this.updatePosition();
                //this._model.selector().blur();
                $(this).trigger( &#x27;TriggerEvent&#x27;, [ Calendar.Model.INITED ] );
            }
        , _buildLayout:
            function( _dateo ){
                this._model.layout();
                
                //JC.log( &#x27;_buildBody: \n&#x27;, JSON.stringify( _dateo ) );

                if( !( _dateo &amp;&amp; _dateo.date ) ) return;

                this._buildHeader( _dateo );
                this._buildBody( _dateo );
                this._buildFooter( _dateo );
            }
        , _buildHeader:
            function( _dateo ){
                var _p = this
                    , _layout = _p._model.layout()
                    , _ls = []
                    , _tmp
                    , _selected = _dateo.date.getFullYear()
                    , _selectedMonth = _dateo.date.getMonth()
                    , _startYear = _p._model.startYear( _dateo )
                    , _endYear = _p._model.endYear( _dateo )
                    , _curYear = _dateo.date.getFullYear()
                    , _curDateMonth = new Date( _dateo.date.getFullYear(), _dateo.date.getMonth(), 1 )
                    , _minYear = _dateo.minvalue ? _dateo.minvalue.getFullYear() : 0
                    , _maxYear = _dateo.maxvalue ? _dateo.maxvalue.getFullYear() : 0
                    , _minMonthDate = _dateo.minvalue ? new Date( _dateo.minvalue.getFullYear(), _dateo.minvalue.getMonth(), 1 ) : 0
                    , _maxMonthDate = _dateo.maxvalue ? new Date( _dateo.maxvalue.getFullYear(), _dateo.maxvalue.getMonth(), 1 ) : 0
                    , i, j, _mname, _tdate, _addDateYear 
                    , _addCurYear
                    ;
                for( i = _startYear; i &lt;= _endYear; i++ ){

                    if( _maxYear &amp;&amp; _curYear &gt; _maxYear ){
                        _addCurYear = true;
                    }
                    if( _maxYear &amp;&amp; i &gt; _maxYear ) break;

                    if( _minYear &amp;&amp; i &lt; _minYear ) continue;
                    if( _minYear &amp;&amp; _curYear &lt; _minYear ) {
                        _addCurYear = true;
                    }

                    _ls.push( JC.f.printf( &#x27;&lt;option value=&quot;{0}&quot;{1}&gt;{0}&lt;/option&gt;&#x27;, i, i === _selected ? &#x27; selected&#x27; : &#x27;&#x27; ) );
                }

                if( _addCurYear ){
                    _ls.unshift( JC.f.printf( &#x27;&lt;option value=&quot;{0}&quot;{1}&gt;{0}&lt;/option&gt;&#x27;, _curYear, &#x27; selected&#x27; ) );
                }
                $( _ls.join(&#x27;&#x27;) ).appendTo( _layout.find(&#x27;select.UYear&#x27;).html(&#x27;&#x27;) );

                _ls = [];
                for( i = 0; i &lt; 12; i++ ){
                    _mname = Calendar.getCnNum( i + 1 );
                    _tdate = new Date( _curYear, i, 1 );

                    /*
                    JC.log( _dateo.date.getFullYear(), i
                            , JC.f.formatISODate( _tdate )
                            , JC.f.formatISODate( _minMonthDate )
                            , JC.f.formatISODate( _maxMonthDate ) 
                            );
                    */

                    if( _maxMonthDate &amp;&amp; _tdate.getTime() &gt; _maxMonthDate.getTime() ) break;
                    if( _minMonthDate &amp;&amp; _tdate.getTime() &lt; _minMonthDate.getTime() ){
                        /*
                        JC.log(
                            &#x27;xxxxxxxx&#x27;
                            , JC.f.formatISODate( _dateo.date )
                            , JC.f.formatISODate( _tdate )
                            , i
                            );
                        */
                        continue;
                    }

                    _ls.push( JC.f.printf( &#x27;&lt;option value=&quot;{0}&quot;{1}&gt;{2}月&lt;/option&gt;&#x27;
                                , i
                                , i === _selectedMonth ? &#x27; selected&#x27; : &#x27;&#x27;
                                , _mname 
                                ) 
                            );
                }
                if( !_ls.length ){
                    _mname = Calendar.getCnNum( _dateo.date.getMonth() + 1 );

                    _ls.push( JC.f.printf( &#x27;&lt;option value=&quot;{0}&quot;{1}&gt;{2}月&lt;/option&gt;&#x27;
                                , _dateo.date.getMonth()
                                , &#x27; selected&#x27;
                                , _mname 
                                ) 
                            );
                }
                $( _ls.join(&#x27;&#x27;) ).appendTo( _layout.find( &#x27;select.UMonth&#x27; ).html( &#x27;&#x27; ) );
                //$( _layout.find(&#x27;select.UMonth&#x27;).val( _dateo.date.getMonth() ) );
            }
        , _buildBody:
            function( _dateo ){
                var _p = this, _layout = _p._model.layout();
                var _maxday = JC.f.maxDayOfMonth( _dateo.date ), _weekday = _dateo.date.getDay() || 7
                    , _sumday = _weekday + _maxday, _row = 6, _ls = [], _premaxday, _prebegin
                    , _tmp, i, _class;

                var _beginDate = new Date( _dateo.date.getFullYear(), _dateo.date.getMonth(), 1 );
                var _beginWeekday = _beginDate.getDay() || 7;
                if( _beginWeekday &lt; 2 ){
                    _beginDate.setDate( -( _beginWeekday - 1 + 6 ) );
                }else{
                    _beginDate.setDate( -( _beginWeekday - 2 ) );
                }
                var today = new Date();

                if( _dateo.maxvalue &amp;&amp; !_p._model.currentcanselect() ){
                    _dateo.maxvalue.setDate( _dateo.maxvalue.getDate() - 1 );
                }

                _ls.push(&#x27;&lt;tr&gt;&#x27;);
                for( i = 1; i &lt;= 42; i++ ){
                    _class = [];
                    if( _beginDate.getDay() === 0 || _beginDate.getDay() == 6 ) _class.push(&#x27;weekend&#x27;);
                    if( !JC.f.isSameMonth( _dateo.date, _beginDate ) ) _class.push( &#x27;other&#x27; );
                    if( _dateo.minvalue &amp;&amp; _beginDate.getTime() &lt; _dateo.minvalue.getTime() ) 
                        _class.push( &#x27;unable&#x27; );
                    if( _dateo.maxvalue &amp;&amp; _beginDate.getTime() &gt; _dateo.maxvalue.getTime() ) 
                        _class.push( &#x27;unable&#x27; );

                    if( JC.f.isSameDay( _beginDate, today ) ) _class.push( &#x27;today&#x27; );
                    if( JC.f.isSameDay( _dateo.date, _beginDate ) ) _class.push( &#x27;cur&#x27; );

                    _ls.push( &#x27;&lt;td class=&quot;&#x27;, _class.join(&#x27; &#x27;),&#x27;&quot;&gt;&#x27;
                            ,&#x27;&lt;a href=&quot;javascript:&quot; date=&quot;&#x27;, _beginDate.getTime(),&#x27;&quot; title=&quot;&#x27;+JC.f.formatISODate(_beginDate)+&#x27;&quot; &gt;&#x27;
                            , _beginDate.getDate(), &#x27;&lt;/a&gt;&lt;/td&gt;&#x27; );
                    _beginDate.setDate( _beginDate.getDate() + 1 );
                    if( i % 7 === 0 &amp;&amp; i != 42 ) _ls.push( &#x27;&lt;/tr&gt;&lt;tr&gt;&#x27; );
                }
                _ls.push(&#x27;&lt;/tr&gt;&#x27;);
                _layout.find(&#x27;table.UTableBorder tbody&#x27; ).html( $( _ls.join(&#x27;&#x27;) ) );
            }
        , _buildFooter:
            function( _dateo ){
            }
    };
    /**
     * 捕获用户更改年份 
     * &lt;p&gt;监听 年份下拉框&lt;/p&gt;
     * @event year change
     * @private
     */
    $(document).delegate( &#x27;body &gt; div.UXCCalendar select.UYear, body &gt; div.UXCCalendar select.UMonth&#x27;, &#x27;change&#x27;, function( $evt ){
        Calendar.getInstance( Calendar.lastIpt )
            &amp;&amp; Calendar.getInstance( Calendar.lastIpt ).updateLayout();
    });
    /**
     * 捕获用户更改年份 
     * &lt;p&gt;监听 下一年按钮&lt;/p&gt;
     * @event next year
     * @private
     */
    $(document).delegate( &#x27;body &gt; div.UXCCalendar button.UNextYear&#x27;, &#x27;click&#x27;, function( $evt ){
        Calendar.getInstance( Calendar.lastIpt )
            &amp;&amp; Calendar.getInstance( Calendar.lastIpt ).updateYear( 1 );
    });
    /**
     * 捕获用户更改年份 
     * &lt;p&gt;监听 上一年按钮&lt;/p&gt;
     * @event previous year
     * @private
     */
    $(document).delegate( &#x27;body &gt; div.UXCCalendar button.UPreYear&#x27;, &#x27;click&#x27;, function( $evt ){
        Calendar.getInstance( Calendar.lastIpt )
            &amp;&amp; Calendar.getInstance( Calendar.lastIpt ).updateYear( -1 );
    });
    /**
     * 增加或者减少一年
     * &lt;p&gt;监听 年份map&lt;/p&gt;
     * @event   year map click
     * @private
     */
    $(document).delegate( &quot;map[name=UXCCalendar_Year] area&quot; , &#x27;click&#x27;, function( $evt ){
        $evt.preventDefault();
        var _p = $(this), _ins = Calendar.getInstance( Calendar.lastIpt );
        _p.attr(&quot;action&quot;) &amp;&amp; _ins
            &amp;&amp; ( _p.attr(&quot;action&quot;).toLowerCase() == &#x27;up&#x27; &amp;&amp; _ins.updateYear( 1 )
                , _p.attr(&quot;action&quot;).toLowerCase() == &#x27;down&#x27; &amp;&amp; _ins.updateYear( -1 )
               );
    });
    /**
     * 增加或者减少一个月
     * &lt;p&gt;监听 月份map&lt;/p&gt;
     * @event   month map click
     * @private
     */
    $(document).delegate( &quot;map[name=UXCCalendar_Month] area&quot; , &#x27;click&#x27;, function( $evt ){
        $evt.preventDefault();
        var _p = $(this), _ins = Calendar.getInstance( Calendar.lastIpt );
        _p.attr(&quot;action&quot;) &amp;&amp; _ins
            &amp;&amp; ( _p.attr(&quot;action&quot;).toLowerCase() == &#x27;up&#x27; &amp;&amp; _ins.updateMonth( 1 )
                , _p.attr(&quot;action&quot;).toLowerCase() == &#x27;down&#x27; &amp;&amp; _ins.updateMonth( -1 )
               );
    });
    /**
     * 捕获用户更改月份 
     * &lt;p&gt;监听 下一月按钮&lt;/p&gt;
     * @event next year
     * @private
     */
    $(document).delegate( &#x27;body &gt; div.UXCCalendar button.UNextMonth&#x27;, &#x27;click&#x27;, function( $evt ){
        Calendar.getInstance( Calendar.lastIpt )
            &amp;&amp; Calendar.getInstance( Calendar.lastIpt ).updateMonth( 1 );
    });
    /**
     * 捕获用户更改月份
     * &lt;p&gt;监听 上一月按钮&lt;/p&gt;
     * @event previous year
     * @private
     */
    $(document).delegate( &#x27;body &gt; div.UXCCalendar button.UPreMonth&#x27;, &#x27;click&#x27;, function( $evt ){
        Calendar.getInstance( Calendar.lastIpt )
            &amp;&amp; Calendar.getInstance( Calendar.lastIpt ).updateMonth( -1 );
    });

    /**
     * 日期点击事件
     * @event date click
     * @private
     */
    $(document).delegate( &#x27;div.UXCCalendar table a[date], div.UXCCalendar table a[dstart]&#x27;, &#x27;click&#x27;, function( $evt ){
        $evt.preventDefault();
        Calendar.getInstance( Calendar.lastIpt )
            &amp;&amp; Calendar.getInstance( Calendar.lastIpt ).updateSelected( $( this ) );
        /*
        Calendar._triggerUpdate( [ &#x27;date&#x27;, _d, _d ] );
        */
    });
    /**
     * 选择当前日期
     * &lt;p&gt;监听确定按钮&lt;/p&gt;
     * @event   confirm click
     * @private
     */
    $(document).delegate( &#x27;body &gt; div.UXCCalendar button.UConfirm&#x27;, &#x27;click&#x27;, function( $evt ){
        Calendar.getInstance( Calendar.lastIpt )
            &amp;&amp; Calendar.getInstance( Calendar.lastIpt ).updateSelected();
    });
    /**
     * 清除文本框内容
     * &lt;p&gt;监听 清空按钮&lt;/p&gt;
     * @event   clear click
     * @private
     */
    $(document).delegate( &#x27;body &gt; div.UXCCalendar button.UClear&#x27;, &#x27;click&#x27;, function( $evt ){
        Calendar.getInstance( Calendar.lastIpt )
            &amp;&amp; Calendar.getInstance( Calendar.lastIpt ).clear();
    });
    /**
     * 取消日历组件, 相当于隐藏
     * &lt;p&gt;监听 取消按钮&lt;/p&gt;
     * @event cancel click
     * @private
     */
    $(document).delegate( &#x27;body &gt; div.UXCCalendar button.UCancel&#x27;, &#x27;click&#x27;, function( $evt ){
        Calendar.getInstance( Calendar.lastIpt )
            &amp;&amp; Calendar.getInstance( Calendar.lastIpt ).cancel();
    });
    /**
     * 日历组件按钮点击事件
     * @event calendar button click
     * @private
     */
    $(document).delegate( &#x27;input.UXCCalendar_btn&#x27;, &#x27;click&#x27;, function($evt){
        var _p = $(this), _tmp;
        if( !_p.data( Calendar.Model.INPUT ) ){
            _tmp = _p.prev( &#x27;input[type=text], textarea&#x27; );
            _tmp.length &amp;&amp; _p.data( Calendar.Model.INPUT, _tmp );
        }
        _p.data( Calendar.Model.INPUT ) 
            &amp;&amp; !_p.data( Calendar.Model.INPUT ).is(&#x27;[disabled]&#x27;)
            &amp;&amp; Calendar.pickDate( _p.data( Calendar.Model.INPUT ) );
    });
    /**
     * 日历组件点击事件, 阻止冒泡, 防止被 document click事件隐藏
     * @event UXCCalendar click
     * @private
     */
    $(document).delegate( &#x27;body &gt; div.UXCCalendar&#x27;, &#x27;click&#x27;, function( $evt ){
        $evt.stopPropagation();
    });

    /**
     * DOM 加载完毕后, 初始化日历组件相关事件
     * @event   dom ready
     * @private
     */
    $(document).ready( function($evt){
        /**
         * 延迟200毫秒初始化页面的所有日历控件
         * 之所以要延迟是可以让用户自己设置是否需要自动初始化
         */
        JC.f.safeTimeout( function( $evt ){
            if( !Calendar.autoInit ) return;
            Calendar.initTrigger( $(document) );
        }, null, &#x27;CalendarInitTrigger&#x27;, 200 );
        /**
         * 监听窗口滚动和改变大小, 实时变更日历组件显示位置
         * @event  window scroll, window resize
         * @private
         */
        $(window).on(&#x27;scroll resize&#x27;, function($evt){
            var _ins = Calendar.getInstance( Calendar.lastIpt );
                _ins &amp;&amp; _ins.visible() &amp;&amp; _ins.updatePosition();
        });
        /**
         * dom 点击时, 检查事件源是否为日历组件对象, 如果不是则会隐藏日历组件
         * @event dom click
         * @private
         */
        $(document).on(&#x27;click&#x27;, function($evt){
            var _src = $evt.target || $evt.srcElement;

            if( Calendar.domClickFilter ) if( Calendar.domClickFilter( $(_src) ) === false ) return;

            if( Calendar.isCalendar($evt.target||$evt.targetElement) ) return;

            if( _src &amp;&amp; ( _src.nodeName.toLowerCase() != &#x27;input&#x27;
                    &amp;&amp; _src.nodeName.toLowerCase() != &#x27;button&#x27; 
                    &amp;&amp; _src.nodeName.toLowerCase() != &#x27;textarea&#x27; 
                    ) ){
                Calendar.hide(); return;
            }

            JC.f.safeTimeout( function(){
                if( Calendar.lastIpt &amp;&amp; Calendar.lastIpt.length &amp;&amp; _src == Calendar.lastIpt[0] ) return;
                Calendar.hide();
            }, null, &#x27;CalendarClickHide&#x27;, 100 );
        });
    });
    $(document).delegate( [ &#x27;input[datatype=date]&#x27;, &#x27;input[datatype=daterange]&#x27;
                            , &#x27;input[multidate=date]&#x27;, &#x27;input[multidate=daterange]&#x27; ].join(), &#x27;focus&#x27; 
    , function($evt){
            Calendar.pickDate( this );
    });
    $(document).delegate( [ &#x27;button[datatype=date]&#x27;, &#x27;button[datatype=daterange]&#x27;
                            , &#x27;button[multidate=date]&#x27;, &#x27;button[multidate=daterange]&#x27; ].join(), &#x27;click&#x27; , function($evt){
            Calendar.pickDate( this );
    });
    $(document).delegate( [ &#x27;textarea[datatype=date]&#x27;, &#x27;textarea[datatype=daterange]&#x27;
                            , &#x27;textarea[multidate=date]&#x27;, &#x27;textarea[multidate=daterange]&#x27; ].join(), &#x27;click&#x27; , function($evt){
            Calendar.pickDate( this );
    });

    return JC.Calendar;
});}( typeof define === &#x27;function&#x27; &amp;&amp; define.amd ? define : 
        function ( _name, _require, _cb) { 
            typeof _name == &#x27;function&#x27; &amp;&amp; ( _cb = _name );
            typeof _require == &#x27;function&#x27; &amp;&amp; ( _cb = _require ); 
            _cb &amp;&amp; _cb(); 
        }
        , window
    )
);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
