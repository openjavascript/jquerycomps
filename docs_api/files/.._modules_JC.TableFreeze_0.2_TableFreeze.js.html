<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../modules/JC.TableFreeze/0.2/TableFreeze.js - open jquery components library</title>
    <link rel="stylesheet" href="../assets/css/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/widget.css">
    <link rel="stylesheet" href="../assets/css/tabview.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="../assets/js/yui-min.js"></script>
    <script src="../assets/js/comps1.js"></script>
    <script src="../assets/js/comps2.js"></script>
    <script src="../assets/js/comps3.js"></script>
    <script src="../assets/js/comps4.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../jc_logo.png" title="open jquery components library"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/JC.AjaxTree.html">JC.AjaxTree</a></li>
            
                <li><a href="../classes/JC.AjaxUpload.html">JC.AjaxUpload</a></li>
            
                <li><a href="../classes/JC.alert.html">JC.alert</a></li>
            
                <li><a href="../classes/JC.AutoChecked.html">JC.AutoChecked</a></li>
            
                <li><a href="../classes/JC.AutoComplete.html">JC.AutoComplete</a></li>
            
                <li><a href="../classes/JC.AutoSelect.html">JC.AutoSelect</a></li>
            
                <li><a href="../classes/JC.Calendar.html">JC.Calendar</a></li>
            
                <li><a href="../classes/JC.common.html">JC.common</a></li>
            
                <li><a href="../classes/JC.confirm.html">JC.confirm</a></li>
            
                <li><a href="../classes/JC.Cover.html">JC.Cover</a></li>
            
                <li><a href="../classes/JC.DCalendar.html">JC.DCalendar</a></li>
            
                <li><a href="../classes/JC.Dialog.html">JC.Dialog</a></li>
            
                <li><a href="../classes/JC.Dialog.alert.html">JC.Dialog.alert</a></li>
            
                <li><a href="../classes/JC.Dialog.confirm.html">JC.Dialog.confirm</a></li>
            
                <li><a href="../classes/JC.Dialog.mask.html">JC.Dialog.mask</a></li>
            
                <li><a href="../classes/JC.Dialog.msgbox.html">JC.Dialog.msgbox</a></li>
            
                <li><a href="../classes/JC.Drag.html">JC.Drag</a></li>
            
                <li><a href="../classes/JC.DragSelect.html">JC.DragSelect</a></li>
            
                <li><a href="../classes/JC.f.html">JC.f</a></li>
            
                <li><a href="../classes/JC.FChart.html">JC.FChart</a></li>
            
                <li><a href="../classes/JC.Fixed.html">JC.Fixed</a></li>
            
                <li><a href="../classes/JC.FlowChart.html">JC.FlowChart</a></li>
            
                <li><a href="../classes/JC.FormFillUrl.html">JC.FormFillUrl</a></li>
            
                <li><a href="../classes/JC.FrameUtil.html">JC.FrameUtil</a></li>
            
                <li><a href="../classes/JC.hideAllPanel.html">JC.hideAllPanel</a></li>
            
                <li><a href="../classes/JC.hideAllPopup.html">JC.hideAllPopup</a></li>
            
                <li><a href="../classes/JC.ImageCutter.html">JC.ImageCutter</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.html">JC.LunarCalendar</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.Model.html">JC.LunarCalendar.Model</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.View.html">JC.LunarCalendar.View</a></li>
            
                <li><a href="../classes/JC.msgbox.html">JC.msgbox</a></li>
            
                <li><a href="../classes/JC.NumericStepper.html">JC.NumericStepper</a></li>
            
                <li><a href="../classes/JC.Paginator.html">JC.Paginator</a></li>
            
                <li><a href="../classes/JC.Panel.html">JC.Panel</a></li>
            
                <li><a href="../classes/JC.Panel.Model.html">JC.Panel.Model</a></li>
            
                <li><a href="../classes/JC.Panel.View.html">JC.Panel.View</a></li>
            
                <li><a href="../classes/JC.Placeholder.html">JC.Placeholder</a></li>
            
                <li><a href="../classes/JC.PopTips.html">JC.PopTips</a></li>
            
                <li><a href="../classes/JC.Rate.html">JC.Rate</a></li>
            
                <li><a href="../classes/JC.Scrollbar.html">JC.Scrollbar</a></li>
            
                <li><a href="../classes/JC.ServerSort.html">JC.ServerSort</a></li>
            
                <li><a href="../classes/JC.Slider.html">JC.Slider</a></li>
            
                <li><a href="../classes/JC.Slider.Model.html">JC.Slider.Model</a></li>
            
                <li><a href="../classes/JC.StepControl.html">JC.StepControl</a></li>
            
                <li><a href="../classes/JC.Suggest.html">JC.Suggest</a></li>
            
                <li><a href="../classes/JC.Tab.html">JC.Tab</a></li>
            
                <li><a href="../classes/JC.Tab.Model.html">JC.Tab.Model</a></li>
            
                <li><a href="../classes/JC.Tab.View.html">JC.Tab.View</a></li>
            
                <li><a href="../classes/JC.TableFreeze.html">JC.TableFreeze</a></li>
            
                <li><a href="../classes/JC.Tips.html">JC.Tips</a></li>
            
                <li><a href="../classes/JC.Tips.Model.html">JC.Tips.Model</a></li>
            
                <li><a href="../classes/JC.Tips.View.html">JC.Tips.View</a></li>
            
                <li><a href="../classes/JC.Tree.html">JC.Tree</a></li>
            
                <li><a href="../classes/JC.Tree.Model.html">JC.Tree.Model</a></li>
            
                <li><a href="../classes/JC.Valid.html">JC.Valid</a></li>
            
                <li><a href="../classes/window.Bizs.ActionLogic.html">window.Bizs.ActionLogic</a></li>
            
                <li><a href="../classes/window.Bizs.AutoSelectComplete.html">window.Bizs.AutoSelectComplete</a></li>
            
                <li><a href="../classes/window.Bizs.ChangeLogic.html">window.Bizs.ChangeLogic</a></li>
            
                <li><a href="../classes/window.Bizs.CommonModify.html">window.Bizs.CommonModify</a></li>
            
                <li><a href="../classes/window.Bizs.CRMSchedule.html">window.Bizs.CRMSchedule</a></li>
            
                <li><a href="../classes/window.Bizs.CustomColumn.html">window.Bizs.CustomColumn</a></li>
            
                <li><a href="../classes/window.Bizs.DisableLogic.html">window.Bizs.DisableLogic</a></li>
            
                <li><a href="../classes/window.Bizs.DMultiDate.html">window.Bizs.DMultiDate</a></li>
            
                <li><a href="../classes/window.Bizs.DropdownTree.html">window.Bizs.DropdownTree</a></li>
            
                <li><a href="../classes/window.Bizs.FormLogic.html">window.Bizs.FormLogic</a></li>
            
                <li><a href="../classes/window.Bizs.InputSelect.html">window.Bizs.InputSelect</a></li>
            
                <li><a href="../classes/window.Bizs.KillISPCache.html">window.Bizs.KillISPCache</a></li>
            
                <li><a href="../classes/window.Bizs.MoneyTips.html">window.Bizs.MoneyTips</a></li>
            
                <li><a href="../classes/window.Bizs.MultiAutoComplete.html">window.Bizs.MultiAutoComplete</a></li>
            
                <li><a href="../classes/window.Bizs.MultiDate.html">window.Bizs.MultiDate</a></li>
            
                <li><a href="../classes/window.Bizs.MultiSelect.html">window.Bizs.MultiSelect</a></li>
            
                <li><a href="../classes/window.Bizs.MultiselectPanel.html">window.Bizs.MultiselectPanel</a></li>
            
                <li><a href="../classes/window.Bizs.MultiSelectTree.html">window.Bizs.MultiSelectTree</a></li>
            
                <li><a href="../classes/window.Bizs.MultiUpload.html">window.Bizs.MultiUpload</a></li>
            
                <li><a href="../classes/window.Bizs.TaskViewer.html">window.Bizs.TaskViewer</a></li>
            
                <li><a href="../classes/window.jQuery.html">window.jQuery</a></li>
            
                <li><a href="../classes/window.jQuery.mousewheel.html">window.jQuery.mousewheel</a></li>
            
                <li><a href="../classes/window.JSON.html">window.JSON</a></li>
            
                <li><a href="../classes/window.Raphael.html">window.Raphael</a></li>
            
                <li><a href="../classes/window.requirejs.html">window.requirejs</a></li>
            
                <li><a href="../classes/window.swfobject.html">window.swfobject</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ../modules/JC.TableFreeze/0.2/TableFreeze.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
 ;(function(define, _win) { &#x27;use strict&#x27;; define( [ &#x27;JC.BaseMVC&#x27; ], function(){

//Todo: IE下resize，缩小窗口时tr的高度每一行隔了一像素。
//Todo: 鼠标hover效果性能优化

/**
 * TableFreeze 表格固定指定列功能
 *
 *&lt;p&gt;&lt;b&gt;require&lt;/b&gt;:
 *   &lt;a href=&#x27;JC.BaseMVC.html&#x27;&gt;JC.BaseMVC&lt;/a&gt;
 *&lt;/p&gt;
 *
 *&lt;p&gt;&lt;a href=&#x27;https://github.com/openjavascript/jquerycomps&#x27; target=&#x27;_blank&#x27;&gt;JC Project Site&lt;/a&gt;
 *   | &lt;a href=&#x27;http://jc2.openjavascript.org/docs_api/classes/JC.TableFreeze.html&#x27; target=&#x27;_blank&#x27;&gt;API docs&lt;/a&gt;
 *   | &lt;a href=&#x27;../../modules/JC.TableFreeze/0.2/_demo&#x27; target=&#x27;_blank&#x27;&gt;demo link&lt;/a&gt;&lt;/p&gt;
 *  
 *&lt;h2&gt;页面只要引用本文件, 默认会自动初始化div为class=&quot;js_compTableFreeze&quot;下的表格&lt;/h2&gt;
 *&lt;p&gt;目前不支持带有tfooter的表格。如果表格带有tfooter，tfooter部分的内容会被清空&lt;/p&gt;
 *&lt;p&gt;&lt;/p&gt;
 *
 *
 *&lt;h2&gt;可用的 HTML attribute&lt;/h2&gt;
 *
 *&lt;dl&gt;
 *    &lt;dt&gt;freezeType = string&lt;/dt&gt;
 *    &lt;dd&gt;
 *       声明表格列冻结的类型：
 *       &lt;p&gt;&lt;b&gt;prev：&lt;/b&gt;左边的列固定，其他滚动&lt;/p&gt;
 *       &lt;p&gt;&lt;b&gt;next：&lt;/b&gt;右边的列固定，其他滚动&lt;/p&gt;
 *       &lt;p&gt;&lt;b&gt;both：&lt;/b&gt;两边的列固定，其他滚动&lt;/p&gt;
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;freezeCol = string&lt;/dt&gt;
 *    &lt;dd&gt;
 *        声明表格要冻结的列数:
 *        &lt;p&gt;为&lt;b&gt;0：&lt;/b&gt;全部滚动，不冻结&lt;/p&gt;
 *        &lt;p&gt;为&lt;b&gt;列表数目：&lt;/b&gt;全部冻结， 不滚动&lt;/p&gt;
 *        &lt;p&gt;为&lt;b&gt;num,num：&lt;/b&gt;freezeType为&lt;b&gt;both&lt;/b&gt;时，第一个数字表示前面冻结的列数&lt;br/&gt;
 *          第二个数字表示后面冻结的列数。&lt;br/&gt;
 *           当两个数字加起来等于列数时，表示全部冻结，不会出现有滚动的列。
 *        &lt;/p&gt;
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;scrollWidth = num&lt;/dt&gt;
 *    &lt;dd&gt;
 *        声明表格滚动部分的宽度，默认120%
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;needHoverClass = true|false&lt;/dt&gt;
 *    &lt;dd&gt;
 *        声明表格行是否需要鼠标hover高亮效果:
 *        &lt;p&gt;默认值为true&lt;/p&gt;
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;alternateClass = string&lt;/dt&gt;
 *    &lt;dd&gt;
 *        声明表格索引值为奇数行的背景色的className: （表格行隔行换色）
 *        &lt;p&gt;如果为空则不指定隔行背景色&lt;/p&gt;
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;beforeCreateTableCallback = function&lt;/dt&gt;
 *    &lt;dd&gt;
 *        表格创建前, 触发的回调, &lt;b&gt;window 变量域&lt;/b&gt;
&lt;pre&gt;function beforeCreateTableCallback( _selector ){
    var _ins = this;
    JC.log( &#x27;beforeCreateTableCallback&#x27;, new Date().getTime() );
}&lt;/pre&gt;
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;afterCreateTableCallback = function&lt;/dt&gt;
 *    &lt;dd&gt;
 *        表格创建后, 触发的回调, &lt;b&gt;window 变量域&lt;/b&gt;
&lt;pre&gt;function afterCreateTableCallback( _selector ){
    var _ins = this;
    JC.log( &#x27;afterCreateTableCallback&#x27;, new Date().getTime() );
}&lt;/pre&gt;
 *    &lt;/dd&gt;
 *&lt;/dl&gt; 
 *
 * @namespace JC
 * @class TableFreeze
 * @extends JC.BaseMVC
 * @constructor
 * @param   {selector|string}   _selector   
 * @version dev 0.1 2013-11-25
 * @author  zuojing   &lt;zuojing1013@gmail.com&gt; | 75 Team
 * @example
        &lt;script&gt;
            JC.debug = true;
            JC.use(&#x27;TableFreeze&#x27;);
        &lt;/script&gt;
        &lt;dl class=&quot;defdl&quot;&gt;
            &lt;dt&gt;TableFreeze example&lt;/dt&gt;
            &lt;dd&gt;
                &lt;dl&gt;
                    &lt;dd&gt;
                        &lt;div class=&quot;js_compTableFreeze&quot; freezeType=&quot;prev&quot; freezeCols=&quot;2&quot; /&gt;
                            &lt;dl&gt;
                                &lt;dd&gt;
                                    &lt;table &gt;
                                        &lt;thead&gt;
                                            &lt;tr&gt;
                                                &lt;th &gt; 
                                                    item0
                                                &lt;/th&gt;
                                                &lt;th &gt;
                                                    item1
                                                &lt;/th&gt;
                                                &lt;th &gt;
                                                    item2
                                                &lt;/th&gt;
                                                &lt;th &gt;
                                                    item3
                                                &lt;/th&gt;
                                                &lt;th &gt;
                                                    item4
                                                &lt;/th&gt;
                                            &lt;/tr&gt;
                                        &lt;/thead&gt;
                                        &lt;tbody&gt;
                                            &lt;tr&gt;
                                                &lt;td rowspan=&quot;3&quot;&gt;
                                                    col01
                                                &lt;/td&gt;
                                                &lt;td class=&quot;breaklw&quot; &gt;
                                                    我的我的我的我的我的我的我的我的我的
                                                &lt;/td&gt;
                                                &lt;td rowspan=&quot;2&quot; colspan=&quot;2&quot;&gt;
                                                    col02
                                                &lt;/td&gt;
                                                
                                                &lt;td&gt;
                                                    col04
                                                &lt;/td&gt;

                                            &lt;/tr&gt;
                                            &lt;tr&gt;
                                                &lt;td &gt;
                                                    col11
                                                &lt;/td&gt;
                                                
                                                &lt;td &gt;
                                                    col14
                                                &lt;/td&gt;
                                            &lt;/tr&gt;
                                              &lt;tr&gt;
                                               
                                                &lt;td&gt;
                                                    col21
                                                &lt;/td&gt;
                                                 &lt;td colspan=&quot;3&quot;&gt;
                                                    col22
                                                &lt;/td&gt;
                                            &lt;/tr&gt;
                                            &lt;tr&gt;
                                                &lt;td&gt;
                                                    col30
                                                &lt;/td&gt;
                                                &lt;td rowspan=&quot;2&quot;&gt;
                                                    col31
                                                &lt;/td&gt;
                                                 &lt;td&gt;
                                                    col32
                                                &lt;/td&gt;
                                                 &lt;td&gt;
                                                    col33
                                                &lt;/td&gt;
                                                &lt;td rowspan=&quot;2&quot;&gt;
                                                    col34
                                                &lt;/td&gt;
                                            &lt;/tr&gt;
                                            &lt;tr&gt;
                                                &lt;td&gt;
                                                    col40
                                                &lt;/td&gt;
                                                
                                                 &lt;td&gt;
                                                    col42
                                                &lt;/td&gt;
                                                 &lt;td&gt;
                                                    col43
                                                &lt;/td&gt;
                                            &lt;/tr&gt;
                                            
                                        &lt;/tbody&gt;
                                    &lt;/table&gt;
                                &lt;/dd&gt;
                            &lt;/dl&gt;
                        &lt;/div&gt;
                    &lt;dd&gt;
                &lt;/dl&gt;
            &lt;/dd&gt;
        &lt;/dl&gt;
 */
    JC.TableFreeze = TableFreeze;
    JC.f.addAutoInit &amp;&amp; JC.f.addAutoInit( TableFreeze );
 
    function TableFreeze( _selector ){
        _selector &amp;&amp; ( _selector = $( _selector ) );
        
        if( TableFreeze.getInstance( _selector ) ) return TableFreeze.getInstance( _selector );
        TableFreeze.getInstance( _selector, this );
        //JC.log( TableFreeze.Model._instanceName );
 
        this._model = new TableFreeze.Model( _selector );
        this._view = new TableFreeze.View( this._model );
 
        this._init();
 
        //JC.log( &#x27;TableFreeze:&#x27;, new Date().getTime() );
    }
    /**
     * 获取或设置 TableFreeze 的实例
     * @method  getInstance
     * @param   {selector}      _selector
     * @static
     * @return  {TableFreezeInstance}
     */
    TableFreeze.getInstance = function ( _selector, _setter ) {
        if( typeof _selector == &#x27;string&#x27; &amp;&amp; !/&lt;/.test( _selector ) ) 
            _selector = $(_selector);
        if( !(_selector &amp;&amp; _selector.length ) || ( typeof _selector == &#x27;string&#x27; ) ) return;
        typeof _setter != &#x27;undefined&#x27; &amp;&amp; _selector.data( TableFreeze.Model._instanceName, _setter );

        return _selector.data( TableFreeze.Model._instanceName );
    };
    /**
     * 初始化可识别的 TableFreeze 实例
     * @method  init
     * @param   {selector}      _selector
     * @static
     * @return  {Array of TableFreezeInstance}
     */
    TableFreeze.init = function ( _selector ) {
        var _r = [];
        
        _selector = $( _selector || document );

        if ( _selector.length ) {
            if ( _selector.hasClass(&#x27;js_compTableFreeze&#x27;) ) {
                _r.push( new TableFreeze(_selector) );
            } else {
                _selector.find(&#x27;div.js_compTableFreeze&#x27;).each( function() {
                    _r.push( new TableFreeze( this ) );
                });
            }
        }
        
        return _r;
    };

    BaseMVC.build( TableFreeze );

    JC.f.extendObject( TableFreeze.prototype, {
        _beforeInit: function () {
            var _p = this,
                _table = _p._model.selector().find(&#x27;&gt;table&#x27;);
            /**
             *为了解决ie6下表格的宽度超出父容器的宽度，父容器的宽度会跟随表格的宽度
            */
            _p._model.alternateClass() &amp;&amp; (_table.find(&#x27;&gt;tbody&gt;tr:odd&#x27;).addClass(_p._model.alternateClass()));
            _p._model.sourceTable = _table.clone();
            _p._model.initcolnumWidth = _p._model.colnumWidth(_table);
            _p._model.needProcess() &amp;&amp; _table.detach();
            _p._model.initWidth = _p._model.selector().width();
            _p._model.tempWidth = _p._model.initWidth;
        },

        _initHanlderEvent: function () {
            var _p = this,
                _hoverClass;

            _p._model.beforeCreateTableCallback()
                    &amp;&amp; _p._model.beforeCreateTableCallback().call( _p, _p.selector() );
                    
            _p._view.update();

            _p._model.afterCreateTableCallback()
                    &amp;&amp; _p._model.afterCreateTableCallback().call( _p, _p.selector() );

            if ( _p._model.needHoverClass() ) {
                _p._model.selector().addClass(&#x27;needHoverClass&#x27;);
                
                if ( _p._model.needProcess() ) {
                    //_hoverClass = _p._model.hoverClass();
                    _hoverClass = &quot;compTFHover&quot;;
                    //.js-fixed-table&gt;table&gt;tbody&gt;tr,.js-roll-table&gt;table&gt;tbody&gt;tr
                    $(document)
                        .delegate(&#x27;tbody .CTF&#x27;, &#x27;mouseenter&#x27;, function () {
                            var _sp = $(this),
                                _item = &#x27;tbody .&#x27; + _sp.attr(&#x27;data-ctf&#x27;),
                                _trs = _sp.parents(&#x27;.js_compTableFreeze&#x27;).find(_item);
                                
                            _trs.addClass(_hoverClass).attr(&#x27;status&#x27;, &#x27;1&#x27;); 

                        } )
                        .delegate(&#x27;tbody .CTF&#x27;, &#x27;mouseleave&#x27;, function () {
                            var _sp = $(this),
                                _item = &#x27;tbody .&#x27; + _sp.attr(&#x27;data-ctf&#x27;),
                                _trs = _sp.parents(&#x27;.js_compTableFreeze&#x27;).find(_item);

                            _trs.removeClass(_hoverClass); 
                            
                        });

                }

            }
        }, 

        _inited: function () {
            JC.log(&#x27;TableFreeze inited&#x27;, new Date().getTime());
        },

        update: function () {
            var _p = this,
                _selector = _p._model.selector(),
                _currentWidth = _selector.width(),
                _trs = _selector.find(&#x27;.js-fixed-table&gt;table&gt;thead&gt;tr,.js-fixed-table&gt;table&gt;tbody&gt;tr,.js-roll-table&gt;table&gt;thead&gt;tr,.js-roll-table&gt;table&gt;tbody&gt;tr&#x27;);

            ( _currentWidth &gt; _p._model.tempWidth ) &amp;&amp; _trs.height(&#x27;auto&#x27;);
            _p._view.fixHeight();
        }
        
    });
 
    TableFreeze.Model._instanceName = &quot;TableFreeze&quot;;
   
    JC.f.extendObject( TableFreeze.Model.prototype, {
        init: function () {
        },

        sourceTable: &#x27;&#x27;,

        initcolnumWidth: [],

        initWidth: 0,

        tempWidth: 0,
        
        /**
         * 冻结类型:prev, both, last; 默认为prev
         */
        freezeType: function () {
            var _r = this.stringProp(&#x27;freezeType&#x27;) || &#x27;prev&#x27; 

            !( _r === &#x27;prev&#x27; || _r === &#x27;both&#x27; || _r === &#x27;last&#x27; ) &amp;&amp; ( _r = &#x27;prev&#x27; );

            return _r;
        },

        /**
         * 冻结列数:num,num 默认为1
         */
        freezeCols: function () {
            var _p = this,
                _r = _p.attrProp(&#x27;freezeCols&#x27;),
                _type = _p.freezeType(),
                _t = [];

            if ( !_r ) {
                ( _type !== &#x27;both&#x27; ) &amp;&amp; ( _r = 1 );
                ( _type === &#x27;both&#x27; ) &amp;&amp; ( _r =  [1, 1] );
               return _r;
            }
            
            _t = _r.split(&#x27;,&#x27;);
            _t[0] = + _t[0];
            _t[1] = + _t[1];

            if ( _type === &#x27;both&#x27; ) {
                if ( _t[0] === 0 &amp;&amp; _t[1] === 0 ) {
                    _r = 0;
                } else {
                    _r = _t.slice();
                }
            } else {
                _r = _t[0];
            }

            return _r
        },

        /**
         * 滚动区域的宽度默认120%
         */
        scrollWidth: function () {
            var _r = this.attrProp(&#x27;scrollWidth&#x27;);

            !_r &amp;&amp; ( _r = &#x27;120%&#x27; );

            return _r;
        },

        /**
         * tr 是否需要hover效果,默认为true
         */
        needHoverClass: function () {
            var _r = this.boolProp(&#x27;needHoverClass&#x27;);

            ( typeof _r === &#x27;undefined&#x27; ) &amp;&amp; ( _r = true );

            return _r;
        },
        
        // hoverClass: function () {
        //     var _r = this.attrProp(&#x27;hoverClass&#x27;);

        //     ( !_r ) &amp;&amp; ( _r = &#x27;compTFHover&#x27;);

        //     return _r;
        // },

        /**
         * tr的隔行换色
         */
        alternateClass: function () {
            var _r = this.attrProp(&#x27;alternateClass&#x27;);

            return _r;
        },

        colnum: function () {
            var _table = this.sourceTable,
                _tr = _table.find(&#x27;tr:eq(0)&#x27;),
                _col = _tr.find(&#x27;&gt;th, &gt;td&#x27;),
                _r = _col.length;

            _col.each( function () {
                var _sp = $(this),
                    _colspan = _sp.prop(&#x27;colspan&#x27;);

                ( _sp.prop(&#x27;colspan&#x27;) ) &amp;&amp; ( _r += ( _colspan - 1 ) );
                
            } );

            return _r;
        },

        colnumWidth: function ( _table ) {
            var _tr = _table.find(&#x27;tr:eq(0)&#x27;),
                _col = _tr.find(&#x27;&gt;th, &gt;td&#x27;),
                _r = [];

            _col.each( function () {
                _r.push( $(this).prop(&#x27;offsetWidth&#x27;) );
            } );

            return _r;
        },

        trElement: function ( _table ) {
            var _thead = _table.find(&#x27;&gt;thead&#x27;),
                _tbody = _table.find(&#x27;&gt;tbody&#x27;),
                _theadTr,
                _tbodyTr;

            if ( _thead.length ) {
                _theadTr = _thead.find(&#x27;&gt;tr&#x27;);
            } else {
                _theadTr = _table.find(&#x27;&gt;tr:eq(0)&#x27;);
            }

            if ( _tbody.length ) {
                _tbodyTr = _tbody.find(&#x27;&gt;tr&#x27;);
            } else {
                _tbodyTr = _table.find(&#x27;&gt;tr:gt(0)&#x27;);
            }

            return {
                theadTr: _theadTr,
                tbodyTr: _tbodyTr
            }

        },

        needProcess: function () {
            
            //Todo: 正则判断freezeCols的值是否合法

            var _p = this,
                _freezeCols = _p.freezeCols(),
                _freezeType = _p.freezeType(),
                _selector = _p.selector(),
                //_table = _p.selector().find(&#x27;&gt;table&#x27;),
                _table = _p.sourceTable,
                _r = true;

            if ( _table.find(&#x27;tr&#x27;).length === 0 ) {
                return false;
            }

            //全部滚动，在这里处理滚动有耦合
            if ( _freezeCols === 0 ) {
                _selector.css(&#x27;overflow-x&#x27;, &#x27;scroll&#x27;)
                    .find(&#x27;&gt;table&#x27;).css(&#x27;width&#x27;, _p.scrollWidth());
                return false;
            }

            //全部冻结
            if ( _freezeType === &#x27;both&#x27; &amp;&amp; ( _freezeCols[0] + _freezeCols[1] &gt;= _p.colnum() ) ) {
                return false;
            }

            return _r;
        },

        layout: function ( _freezeType ) {
            var _sourceTable = this.sourceTable,
                _tableObj = $(_sourceTable[0].cloneNode(false)),
                _theadObj = $(_sourceTable.find(&#x27;thead&#x27;)[0].cloneNode(false)),
                _tbodyObj = $(_sourceTable.find(&#x27;tbody&#x27;)[0].cloneNode(false)),
                _leftClass = &#x27;&#x27;,
                _rightClass = &#x27;&#x27;,
                _midClass = &#x27;&#x27;,
                _secondTempTpl,
                _thirdTempTpl,
                _tpl;

            switch ( _freezeType ) {
                case &#x27;last&#x27;:
                    _leftClass = &quot;js-roll-table compTFLastRoll&quot;;
                    _rightClass = &quot;js-fixed-table compTFLastFixed&quot;;
                    break;

                case &#x27;both&#x27;:
                    _leftClass = &quot;js-fixed-table compTFBothFixed&quot;;
                    _rightClass = &quot;js-fixed-table compTFBothFixed&quot;;
                    _midClass = &quot;js-roll-table compTFBothRoll&quot;;
                    break;

                case &#x27;prev&#x27;:
                default:
                    _leftClass = &quot;js-fixed-table compTFPrevFixed&quot;;
                    _rightClass = &quot;js-roll-table compTFPrevRoll&quot;;
            }
            
            _theadObj.html(&#x27;{0}&#x27;).appendTo(_tableObj);
            _tbodyObj.html(&#x27;{1}&#x27;).appendTo(_tableObj);
            _secondTempTpl = _tableObj.clone().find(&#x27;thead&#x27;).html(&quot;{2}&quot;).end().find(&#x27;tbody&#x27;).html(&quot;{3}&quot;).end();
            if ( !_midClass ) {
                _tpl = &#x27;&lt;div class=&quot;&#x27; + _leftClass + &#x27;&quot;&gt;&#x27; + _tableObj[0].outerHTML +&#x27;&lt;/div&gt;&#x27;
                     + &#x27;&lt;div class=&quot;&#x27; + _rightClass + &#x27;&quot;&gt;&#x27; + _secondTempTpl[0].outerHTML + &#x27;&lt;/div&gt;&#x27;;
            } else {
                _thirdTempTpl = _tableObj.clone().find(&#x27;thead&#x27;).html(&quot;{4}&quot;).end().find(&#x27;tbody&#x27;).html(&quot;{5}&quot;).end();
                _tpl = &#x27;&lt;div class=&quot;&#x27; + _leftClass + &#x27;&quot;&gt;&#x27; + _tableObj[0].outerHTML + &#x27;&lt;/div&gt;&#x27;
                     + &#x27;&lt;div class=&quot;&#x27; + _midClass + &#x27;&quot;&gt;&#x27; + _secondTempTpl[0].outerHTML + &#x27;&lt;/div&gt;&#x27;
                     + &#x27;&lt;div class=&quot;&#x27; + _rightClass + &#x27;&quot;&gt;&#x27; + _thirdTempTpl[0].outerHTML +  &#x27;&lt;/div&gt;&#x27;;
            }
            
            return _tpl;
        },

        creatTpl: function () {
            var _p = this,
                _table = _p.sourceTable,
                _freezeType = _p.freezeType(),
                _freezeCols = _p.freezeCols(),
                _colNum = _p.colnum(),
                _trElement = _p.trElement(_table),
                _theadTr = _trElement.theadTr,
                _tbodyTr = _trElement.tbodyTr,
                _headerTr = _p.getTpl(_freezeType, _freezeCols, _theadTr, _colNum),
                _bodyTr = _p.getTpl(_freezeType, _freezeCols, _tbodyTr, _colNum),
                _layout = _p.layout(_freezeType),
                _tpl;

            switch ( _freezeType ) {
                case &#x27;both&#x27;: 
                    {   
                        _tpl = JC.f.printf(_layout, _headerTr.leftTr, _bodyTr.leftTr, _headerTr.midTr, 
                            _bodyTr.midTr, _headerTr.rightTr, _bodyTr.rightTr);
                        break;
                    }
                case &#x27;last&#x27;:
                case &#x27;prev&#x27;:
                    {   
                        _tpl = JC.f.printf(_layout, _headerTr.leftTr, _bodyTr.leftTr, 
                            _headerTr.rightTr, _bodyTr.rightTr);
                        break;
                    }
            }

            _p.selector().append(_tpl);
            
        },
    
        getTpl: function ( _freezeType, _freezeCols, _trs, _colNum ) {
           
            var _tpl,
                _sLeftTpl = [],
                _sMidTpl = [],
                _sRightTpl = [],
                _col = _freezeCols,
                _rcol = 0,
                _mcol = 0,
                _p = this;

            switch (_freezeType) {
                case &#x27;prev&#x27;:
                    _sLeftTpl = _p.getTr( _trs,  _col );
                    _sRightTpl = _p.getTr( _trs, _colNum - _col );
                    break;
                case &#x27;last&#x27;:
                    _sLeftTpl = _p.getTr( _trs,  _colNum - _col );
                    _sRightTpl = _p.getTr( _trs, _col );
                    break;
                case &#x27;both&#x27;:
                    _col = _freezeCols[0];
                    _rcol = _freezeCols[1];
                    _mcol = _colNum - _col - _rcol;
                    _sLeftTpl = _p.getTr( _trs,  _col );
                    _sMidTpl =  _p.getTr( _trs,  _mcol );
                    _sRightTpl = _p.getTr( _trs, _rcol );
                    break;
            }

            _tpl = {
                leftTr: _sLeftTpl.join(&#x27;&#x27;),
                midTr: _sMidTpl.join(&#x27;&#x27;),
                rightTr: _sRightTpl.join(&#x27;&#x27;)
            };

            return _tpl;
        },

        getTr: function ( _trs, _col ) {
           
            var _row = {},
                _temp = [],
                _p = this;
            _trs.each( function (_ix) {
                var _sp = $(this),
                    _clasname = &#x27;CTF CTF&#x27; + _ix,
                    _leftTr = _sp[0].cloneNode(false),
                    _rightTr = _sp[0].cloneNode(false),
                    _midTr = _sp[0].cloneNode(false),
                    _tds = _sp.find(&#x27;&gt;th,&gt;td&#x27;),
                    _leftTd = [],
                    _rightTd = [],
                    _midTd = [],
                    _cix = 0,
                    _mcix = 0,
                    _tr = _sp[0].cloneNode(false);
                
                _tds.each( function ( _six, _sitem ) {
                    
                    var _sp = $(this), 
                        _colspan = _sp.attr(&#x27;colspan&#x27;),
                        _rowspan = _sp.attr(&#x27;rowspan&#x27;),
                        _obj = {},
                        _key;
                    
                    if ( _cix &gt;= _col ) {
                      return false;
                    }

                    if ( typeof _rowspan != &#x27;undefined&#x27; ) {
                        _rowspan = parseInt(_rowspan, 10);

                        _obj = {
                            six: _six,
                            rowspan: _rowspan,
                            colspan: _colspan
                        };

                        for ( var i = 1; i &lt; _rowspan; i++ ) {
                            
                            if (_colspan) {
                                _colspan = parseInt(_colspan, 10);
                                for (var j = 0; j &lt; _colspan; j++) {        
                                    _six === 0 ? _row[(_ix + i) + ( _six + 1 + j ).toString()] = _obj: _row[(_ix + i) + ( _six + j ).toString()] = _obj;
                                }
                            } else {
                                _six === 0 ? _row[(_ix + i) + ( _six + 1 ).toString()] = _obj: _row[(_ix + i) + ( _six ).toString()] = _obj;
                            }
                        }

                    }
                    
                    if ( typeof _colspan === &#x27;undefined&#x27; ) {
                        _cix = _cix + 1;
                    } else {
                        _cix += parseInt(_colspan, 10);
                    }

                    _key = _ix + (_six + 1).toString();
                    
                    if ( _key in _row  ) {
                        _cix = _cix + 1;
                        if (_row[_key].colspan) {
                            return;
                        }
                    }

                    _sp.appendTo( _tr );

                });

                $(_tr).attr(&#x27;data-ctf&#x27;, &#x27;CTF&#x27; + _ix).addClass(_clasname);
                _temp.push($(_tr)[0].outerHTML);
            } );

            return _temp;
        },

        getSum: function ( _array ) {
            var _sum = 1,
                _len = _array.length;

            while ( _len-- ) {
                _sum += _array.pop();
            }

            return _sum;
        },

        /**
         * TableFreeze调用前的回调
         */
        beforeCreateTableCallback: function () {
            var _p = this,
                _selector = _p.selector(),
                _key = &#x27;beforeCreateTableCallback&#x27;;
 
            return _p.callbackProp(_selector, _key);
        },
 
        /**
         * TableFreeze调用后的回调
         */
        afterCreateTableCallback: function () {
            var _p = this,
                _selector = _p.selector(),
                _key = &#x27;afterCreateTableCallback&#x27;;
 
            return _p.callbackProp(_selector, _key);
        }
        
    });
 
    JC.f.extendObject( TableFreeze.View.prototype, {
        init: function () {
           
        },

        update: function () {
            var _p = this,
                _selector = _p._model.selector(),
                _needProcess = _p._model.needProcess();

            if ( _needProcess ) {
                _p._model.creatTpl();
                _p.fixWidth();
                //fix empty cell
                _p.selector().find(&#x27;td:empty&#x27;).html(&#x27;&amp;nbsp;&#x27;);
                _p.fixHeight();
            }

        },

        fixWidth: function () {
            var _p = this,
                _selector = _p.selector(),
                _freezeType = _p._model.freezeType(),
                _freezeCols = _p._model.freezeCols(),
                _totalWidth = _p._model.initWidth,
                _scrollWidth = _p._model.scrollWidth(),
                _colWidth = _p._model.initcolnumWidth,
                _colNum = _colWidth.length,
                _leftWidth,
                _rightWidth,
                _midWidth;

            switch ( _freezeType ) {
                case &#x27;prev&#x27; : 
                    {
                        _leftWidth = _p._model.getSum(_colWidth.slice(0, _freezeCols));
                        _rightWidth = _totalWidth - _leftWidth;

                        _selector.find(&#x27;&gt;.js-fixed-table&#x27;).width(_leftWidth / _totalWidth * 100 + &#x27;%&#x27;)
                            .end()
                            .find(&#x27;&gt;.js-roll-table&#x27;).width(_rightWidth / _totalWidth * 100 + &#x27;%&#x27;)
                            .find(&#x27;&gt;table&#x27;).width(_scrollWidth);

                        break;
                    }

                case &#x27;last&#x27;:
                    {
                        _rightWidth = _p._model.getSum(_colWidth.slice(_colNum - _freezeCols, _colNum));
                        _leftWidth = _totalWidth - _rightWidth - 1;

                        _selector.find(&#x27;&gt;.js-fixed-table&#x27;).width(_rightWidth / _totalWidth * 100 + &#x27;%&#x27;)
                            .end()
                            .find(&#x27;&gt;.js-roll-table&#x27;).width(_leftWidth / _totalWidth * 100 + &#x27;%&#x27;)
                            .find(&#x27;&gt;table&#x27;).width(_scrollWidth);

                        break;
                    }

                case &#x27;both&#x27;:
                    {
                        _leftWidth = _p._model.getSum(_colWidth.slice(0, _freezeCols[0]));
                        _rightWidth = _p._model.getSum(_colWidth.slice(_colNum - _freezeCols[1], _colNum));
                        _midWidth = _totalWidth - _leftWidth - _rightWidth;
                        //_midWidth = 1 - _leftWidth - _rightWidth;

                        _selector.find(&#x27;&gt;.js-fixed-table:eq(0)&#x27;).width(_leftWidth / _totalWidth * 100 + &#x27;%&#x27;)
                            .end()
                            .find(&#x27;&gt;.js-roll-table&#x27;).width(_midWidth / _totalWidth * 100 + &#x27;%&#x27;)
                            .find(&#x27;&gt;table&#x27;).width(_scrollWidth)
                            .end()
                            .end()
                            .find(&#x27;&gt;.js-fixed-table:eq(1)&#x27;).width(_rightWidth / _totalWidth * 100 + &#x27;%&#x27;);

                        break;
                    }
            } 

        },

        fixHeight: function () {
            var _p = this,
                _selector = _p._model.selector(),
                _leftTrs = _selector.find(&#x27;&gt;.js-fixed-table:eq(0)&gt;table&gt;thead&gt;tr, &gt;.js-fixed-table:eq(0)&gt;table&gt;tbody&gt;tr&#x27;),
                _rightTrs = _selector.find(&#x27;&gt;.js-roll-table&gt;table&gt;thead&gt;tr,&gt;.js-roll-table&gt;table&gt;tbody&gt;tr&#x27;),
                _midTrs = _selector.find(&#x27;&gt;.js-fixed-table:eq(1)&gt;table&gt;thead&gt;tr, &gt;.js-fixed-table:eq(1)&gt;table&gt;tbody&gt;tr&#x27;),
                _freezeType = _p._model.freezeType();

            _leftTrs.each( function ( _ix, _item ) {
                var _sp = $(this),
                    _rightTr = _rightTrs.eq(_ix),
                    _midTr = _midTrs.eq(_ix),
                    _height = Math.max(_sp.prop(&#x27;offsetHeight&#x27;), _rightTr.prop(&#x27;offsetHeight&#x27;));

                if ( _freezeType === &#x27;both&#x27; ) {
                    _height = Math.max(_height, _midTr.prop(&#x27;offsetHeight&#x27;));
                    _midTr.height(_height);
                }

                _sp.height(_height);
                _rightTr.height(_height);

            } );    

            return;
        },

        highlight: function () {
            console.log(&quot;highlight&quot;);
        }

    });

    $(document).ready( function () {
        var _insAr = 0,
            _win= $( window );

        TableFreeze.autoInit &amp;&amp; ( _insAr = TableFreeze.init() );
        _win.on( &#x27;resize&#x27;, CTFResize );

        function CTFResize() {
            _win.off( &#x27;resize&#x27;, CTFResize );

            $( &#x27;div.js_compTableFreeze&#x27; ).each( function () {
                var _ins = TableFreeze.getInstance( $( this ) );
                _ins &amp;&amp; _ins.update() ;
                _ins._model.tempWidth = _ins._model.selector().prop(&#x27;offsetWidth&#x27;);
            });

            _win.data(&#x27;CTFResizeTimeout&#x27;) &amp;&amp; clearTimeout(_win.data(&#x27;CTFResizeTimeout&#x27;));
            _win.data(&#x27;CTFResizeTimeout&#x27;, setTimeout(function () {
                _win.off( &#x27;resize&#x27;, CTFResize );
                _win.on( &#x27;resize&#x27;, CTFResize );
            }, 80 ));

        }

    });
 
    return JC.TableFreeze;
});}( typeof define === &#x27;function&#x27; &amp;&amp; define.amd ? define : 
        function ( _name, _require, _cb ) { 
            typeof _name == &#x27;function&#x27; &amp;&amp; ( _cb = _name );
            typeof _require == &#x27;function&#x27; &amp;&amp; ( _cb = _require ); 
            _cb &amp;&amp; _cb(); 
        }
        , window
    )
);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
