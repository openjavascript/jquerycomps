<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../comps/LunarCalendar/JC.LunarCalendar.gregorianToLunar.js - jquery components</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../jc_logo.png" title="jquery components"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/.window.html">.window</a></li>
            
                <li><a href="../classes/Bizs.MultiDate.html">Bizs.MultiDate</a></li>
            
                <li><a href="../classes/JC.alert.html">JC.alert</a></li>
            
                <li><a href="../classes/JC.AutoSelect.html">JC.AutoSelect</a></li>
            
                <li><a href="../classes/JC.Calendar.html">JC.Calendar</a></li>
            
                <li><a href="../classes/JC.confirm.html">JC.confirm</a></li>
            
                <li><a href="../classes/JC.Dialog.html">JC.Dialog</a></li>
            
                <li><a href="../classes/JC.Dialog.alert.html">JC.Dialog.alert</a></li>
            
                <li><a href="../classes/JC.Dialog.confirm.html">JC.Dialog.confirm</a></li>
            
                <li><a href="../classes/JC.Dialog.mask.html">JC.Dialog.mask</a></li>
            
                <li><a href="../classes/JC.Dialog.msgbox.html">JC.Dialog.msgbox</a></li>
            
                <li><a href="../classes/JC.ExampleClass.html">JC.ExampleClass</a></li>
            
                <li><a href="../classes/JC.Fixed.html">JC.Fixed</a></li>
            
                <li><a href="../classes/JC.Form.html">JC.Form</a></li>
            
                <li><a href="../classes/JC.hideAllPanel.html">JC.hideAllPanel</a></li>
            
                <li><a href="../classes/JC.hideAllPopup.html">JC.hideAllPopup</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.html">JC.LunarCalendar</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.Model.html">JC.LunarCalendar.Model</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.View.html">JC.LunarCalendar.View</a></li>
            
                <li><a href="../classes/JC.msgbox.html">JC.msgbox</a></li>
            
                <li><a href="../classes/JC.Panel.html">JC.Panel</a></li>
            
                <li><a href="../classes/JC.Panel.Model.html">JC.Panel.Model</a></li>
            
                <li><a href="../classes/JC.Panel.View.html">JC.Panel.View</a></li>
            
                <li><a href="../classes/JC.Slider.html">JC.Slider</a></li>
            
                <li><a href="../classes/JC.Slider.Model.html">JC.Slider.Model</a></li>
            
                <li><a href="../classes/JC.Suggest.html">JC.Suggest</a></li>
            
                <li><a href="../classes/JC.Tab.html">JC.Tab</a></li>
            
                <li><a href="../classes/JC.Tab.Model.html">JC.Tab.Model</a></li>
            
                <li><a href="../classes/JC.Tab.View.html">JC.Tab.View</a></li>
            
                <li><a href="../classes/JC.Tips.html">JC.Tips</a></li>
            
                <li><a href="../classes/JC.Tips.Model.html">JC.Tips.Model</a></li>
            
                <li><a href="../classes/JC.Tips.View.html">JC.Tips.View</a></li>
            
                <li><a href="../classes/JC.Tree.html">JC.Tree</a></li>
            
                <li><a href="../classes/JC.Tree.Model.html">JC.Tree.Model</a></li>
            
                <li><a href="../classes/JC.Valid.html">JC.Valid</a></li>
            
                <li><a href="../classes/window.JC.html">window.JC</a></li>
            
                <li><a href="../classes/window.jQuery.html">window.jQuery</a></li>
            
                <li><a href="../classes/window.UXC.html">window.UXC</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ../comps/LunarCalendar/JC.LunarCalendar.gregorianToLunar.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
(function($){
    /**
     * 从公历日期获得农历日期
     * &lt;br /&gt; 返回的数据格式
     * &lt;pre&gt;
        {
            shengxiao: &#x27;&#x27;   //生肖
            , ganzhi: &#x27;&#x27;    //干支
            , yue: &#x27;&#x27;       //月份
            , ri: &#x27;&#x27;        //日
            , shi: &#x27;&#x27;       //时
            , year: &#x27;&#x27;      //农历数字年
            , month: &#x27;&#x27;     //农历数字月
            , day: &#x27;&#x27;       //农历数字天
            , hour: &#x27;&#x27;      //农历数字时
        };
     * &lt;/pre&gt;
     * @method  gregorianToLunar
     * @static
     * @for     JC.LunarCalendar
     * @param   {date}  _date      要获取农历日期的时间对象
     * @return  Object
     */
    JC.LunarCalendar.gregorianToLunar = gregorianToLunar;

    function gregorianToLunar( _date ){
        var _r = {
            shengxiao: &#x27;&#x27;   //生肖
            , ganzhi: &#x27;&#x27;    //干支
            , yue: &#x27;&#x27;       //月份
            , ri: &#x27;&#x27;        //日
            , shi: &#x27;&#x27;       //时
            , year: &#x27;&#x27;      //农历数字年
            , month: &#x27;&#x27;     //农历数字月
            , day: &#x27;&#x27;       //农历数字天
            , hour: &#x27;&#x27;      //农历数字时
        };

        var _lunar = toLunarDate( _date );
        _r.year = _lunar.y;
        _r.month = _lunar.m + 1;
        _r.day = _lunar.d;

        //JC.log( _r.year, _r.month, _r.day, &#x27; &#x27;, _date.getFullYear(), _date.getMonth()+1, _date.getDate() );

        _r.shengxiao = shengxiao.charAt((_r.year - 4) % 12);
        _r.ganzhi = tiangan.charAt((_r.year - 4) % 10) + dizhi.charAt((_r.year - 4) % 12);

        if(_lunar.isleep) {
            _r.yue = &quot;闰&quot; + yuefan.charAt(_r.month - 1);
        }
        else{
            _r.yue = yuefan.charAt(_r.month - 1);
        }
        _r.yue += &#x27;月&#x27;;

        _r.ri = (_r.day &lt; 11) ? &quot;初&quot; : ((_r.day &lt; 20) ? &quot;十&quot; : ((_r.day &lt; 30) ? &quot;廿&quot; : &quot;卅&quot;));
        if (_r.day % 10 != 0 || _r.day == 10) {
            _r.ri += shuzi.charAt((_r.day - 1) % 10);
        }
        _r.ri == &quot;廿&quot; &amp;&amp; ( _r.ri = &quot;二十&quot; );
        _r.ri == &quot;卅&quot; &amp;&amp; ( _r.ri = &quot;三十&quot; );
        /*JC.log( &#x27;month:&#x27;, _r.month, 2 );*/

        _r.shi = dizhi.charAt((_r.hour - 1) % 12);
        return _r;
    };

    function getBit(m, n) { return (m &gt;&gt; n) &amp; 1; }

    var tiangan =  &quot;甲乙丙丁戊己庚辛壬癸&quot;;
    var dizhi =  &quot;子丑寅卯辰巳午未申酉戌亥&quot;;
    var shengxiao =  &quot;鼠牛虎兔龙蛇马羊猴鸡狗猪&quot;;
    var yuefan =  &quot;正二三四五六七八九十冬腊&quot;;
    var xingqi =  &quot;日一二三四五六&quot;;
    var shuzi =  &quot;一二三四五六七八九十&quot;;
    var lunarDays = [0x41A95,0xD4A,0xDA5,0x20B55,0x56A,0x7155B,0x25D,0x92D,0x5192B,0xA95,0xB4A,0x416AA,0xAD5,0x90AB5,0x4BA,0xA5B,0x60A57,0x52B,0xA93,0x40E95];
    var lunarMonth = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334];

    ;void function(){
    var lunarDate=function(r){function l(a){for(var c=348,b=32768;b&gt;8;b&gt;&gt;=1)c+=h[a-1900]&amp;b?1:0;return c+(i(a)?(h[a-1899]&amp;15)==15?30:29:0)}function i(a){a=h[a-1900]&amp;15;return a==15?0:a}function o(a){if(!a||!a.getFullYear)return!1;var c=a.getFullYear(),b=a.getMonth(),a=a.getDate();return Date.UTC(c,b,a)&gt;Date.UTC(2101,0,28)||Date.UTC(c,b,a)&lt;Date.UTC(1900,0,31)?!0:!1}var h=[19416,19168,42352,21717,53856,55632,21844,22191,39632,21970,19168,42422,42192,53840,53845,46415,54944,44450,38320,18807,18815,42160,
    46261,27216,27968,43860,11119,38256,21234,18800,25958,54432,59984,27285,23263,11104,34531,37615,51415,51551,54432,55462,46431,22176,42420,9695,37584,53938,43344,46423,27808,46416,21333,19887,42416,17779,21183,43432,59728,27296,44710,43856,19296,43748,42352,21088,62051,55632,23383,22176,38608,19925,19152,42192,54484,53840,54616,46400,46752,38310,38335,18864,43380,42160,45690,27216,27968,44870,43872,38256,19189,18800,25776,29859,59984,27480,23232,43872,38613,37600,51552,55636,54432,55888,30034,22176,
    43959,9680,37584,51893,43344,46240,47780,44368,21977,19360,42416,20854,21183,43312,31060,27296,44368,23378,19296,42726,42208,53856,60005,54576,23200,30371,38608,19195,19152,42192,53430,53855,54560,56645,46496,22224,21938,18864,42359,42160,43600,45653,27951,44448,19299,37759,18936,18800,25776,26790,59999,27424,42692,43759,37600,53987,51552,54615,54432,55888,23893,22176,42704,21972,21200,43448,43344,46240,46758,44368,21920,43940,42416,21168,45683,26928,29495,27296,44368,19285,19311,42352,21732,53856,
    59752,54560,55968,27302,22239,19168,43476,42192,53584,62034,54560],g=&quot;\u96f6,\u4e00,\u4e8c,\u4e09,\u56db,\u4e94,\u516d,\u4e03,\u516b,\u4e5d,\u5341&quot;.split(&quot;,&quot;),p=[&quot;\u521d&quot;,&quot;\u5341&quot;,&quot;\u5eff&quot;,&quot;\u5345&quot;,&quot;\u25a1&quot;],s=&quot;\u7532,\u4e59,\u4e19,\u4e01,\u620a,\u5df1,\u5e9a,\u8f9b,\u58ec,\u7678&quot;.split(&quot;,&quot;),t=&quot;\u5b50,\u4e11,\u5bc5,\u536f,\u8fb0,\u5df3,\u5348,\u672a,\u7533,\u9149,\u620c,\u4ea5&quot;.split(&quot;,&quot;),u=&quot;\u9f20,\u725b,\u864e,\u5154,\u9f99,\u86c7,\u9a6c,\u7f8a,\u7334,\u9e21,\u72d7,\u732a&quot;.split(&quot;,&quot;),q=&quot;\u5c0f\u5bd2,\u5927\u5bd2,\u7acb\u6625,\u96e8\u6c34,\u60ca\u86f0,\u6625\u5206,\u6e05\u660e,\u8c37\u96e8,\u7acb\u590f,\u5c0f\u6ee1,\u8292\u79cd,\u590f\u81f3,\u5c0f\u6691,\u5927\u6691,\u7acb\u79cb,\u5904\u6691,\u767d\u9732,\u79cb\u5206,\u5bd2\u9732,\u971c\u964d,\u7acb\u51ac,\u5c0f\u96ea,\u5927\u96ea,\u51ac\u81f3&quot;.split(&quot;,&quot;),
    v=[0,21208,42467,63836,85337,107014,128867,150921,173149,195551,218072,240693,263343,285989,308563,331033,353350,375494,397447,419210,440795,462224,483532,504758],m=r||new Date;this.date=m;this.toLunarDate=function(a){a=a||m;if(o(a)){return&quot;the function[toLunarDate()]range[1900/0/31-2101/0/28]&quot;;throw&quot;dateRangeError&quot;;}for(var c=a.getFullYear(),b=a.getMonth(),a=a.getDate(),c=(Date.UTC(c,b,a)-Date.UTC(1900,0,31))/864E5,d,b=1900;b&lt;2100&amp;&amp;c&gt;0;b++)d=l(b),c-=d;c&lt;0&amp;&amp;(c+=d,b--);lunarYear=b;_isLeap=!1;leap=
    i(lunarYear);for(b=1;b&lt;13&amp;&amp;c&gt;0;b++)leap&gt;0&amp;&amp;b==leap+1&amp;&amp;_isLeap==!1?(b--,_isLeap=!0,d=i(lunarYear)?(h[lunarYear-1899]&amp;15)==15?30:29:0):d=h[lunarYear-1900]&amp;65536&gt;&gt;b?30:29,_isLeap==!0&amp;&amp;b==leap+1&amp;&amp;(_isLeap=!1),c-=d;c==0&amp;&amp;leap&gt;0&amp;&amp;b==leap+1&amp;&amp;(_isLeap?_isLeap=!1:(_isLeap=!0,b--));c&lt;0&amp;&amp;(c+=d,b--);lunarMonth=b-1;lunarDay=c+1;return{y:lunarYear,m:lunarMonth,d:lunarDay,leap:leap,isleep:_isLeap,toString:function(){var a=_isLeap?&quot;(\u95f0)&quot;:&quot;&quot;,b=g[parseInt(lunarYear/1E3)]+g[parseInt(lunarYear%1E3/100)]+g[parseInt(lunarYear%
    100/10)]+g[parseInt(lunarYear%10)],c=parseInt((lunarMonth+1)/10)==0?&quot;&quot;:p[1];c+=g[parseInt((lunarMonth+1)%10)];var d=p[parseInt(lunarDay/10)];d+=parseInt(lunarDay%10)==0?&quot;&quot;:g[parseInt(lunarDay%10)];return&quot;&quot;+b+&quot;\u5e74&quot;+c+&quot;\u6708&quot;+a+d+&quot;\u65e5&quot;}}};this.toSolar=function(){if(arguments.length==0)return m;else{var a,c,b;arguments[0]&amp;&amp;(a=arguments[0]);c=arguments[1]?arguments[1]:0;b=arguments[2]?arguments[2]:1;for(var d=0,e=1900;e&lt;a;e++){var f=l(e);d+=f}for(e=0;e&lt;c;e++)f=h[a-1900]&amp;65536&gt;&gt;e?30:29,d+=f;d+=
    b-1;return new Date(Date.UTC(1900,0,31)+d*864E5)}};this.ganzhi=function(a){function c(a,b){return(new Date(3.15569259747E10*(a-1900)+v[b]*6E4+Date.UTC(1900,0,6,2,5))).getUTCDate()}function b(a){return s[a%10]+t[a%12]}var d=a||m;if(o(d)){return&quot;the function[ganzhi()] date&#x27;range[1900/0/31-2101/0/28]&quot;;throw&quot;dateRangeError&quot;;}var e=d.getFullYear(),f=d.getMonth(),a=d.getDate(),d=d.getHours(),h,g,k,j,n;g=f&lt;2?e-1900+36-1:e-1900+36;k=(e-1900)*12+f+12;h=c(e,f*2);var i=c(e,f*2+1);h=a==h?q[f*2]:a==i?q[f*2+1]:
    &quot;&quot;;var i=c(e,2),l=c(e,f*2);f==1&amp;&amp;a&gt;=i&amp;&amp;(g=e-1900+36);a+1&gt;=l&amp;&amp;(k=(e-1900)*12+f+13);j=Date.UTC(e,f,1,0,0,0,0)/864E5+25577+a-1;n=j%10%5*12+parseInt(d/2)%12;d==23&amp;&amp;j++;g%=60;k%=60;j%=60;n%=60;return{y:g,m:k,d:j,h:n,jie:h,animal:u[g%12],toString:function(a){var c=b(g)+b(k)+b(j)+b(n);return a?c.substring(0,a):c}}}};
        lunarDate();
    }.call( window );
}(jQuery));

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
