<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../modules/JC.Drag/0.1/Drag.js - jquery components</title>
    <link rel="stylesheet" href="../assets/css/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/widget.css">
    <link rel="stylesheet" href="../assets/css/tabview.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="../assets/js/yui-min.js"></script>
    <script src="../assets/js/comps1.js"></script>
    <script src="../assets/js/comps2.js"></script>
    <script src="../assets/js/comps3.js"></script>
    <script src="../assets/js/comps4.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../jc_logo.png" title="jquery components"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/DEV.JC.AjaxUpload.html">DEV.JC.AjaxUpload</a></li>
            
                <li><a href="../classes/DEV.JC.ImageCutter.html">DEV.JC.ImageCutter</a></li>
            
                <li><a href="../classes/JC.AjaxUpload.html">JC.AjaxUpload</a></li>
            
                <li><a href="../classes/JC.alert.html">JC.alert</a></li>
            
                <li><a href="../classes/JC.AutoChecked.html">JC.AutoChecked</a></li>
            
                <li><a href="../classes/JC.AutoComplete.html">JC.AutoComplete</a></li>
            
                <li><a href="../classes/JC.AutoSelect.html">JC.AutoSelect</a></li>
            
                <li><a href="../classes/JC.BaseMVC.html">JC.BaseMVC</a></li>
            
                <li><a href="../classes/JC.BaseMVC.Model.html">JC.BaseMVC.Model</a></li>
            
                <li><a href="../classes/JC.Calendar.html">JC.Calendar</a></li>
            
                <li><a href="../classes/JC.common.html">JC.common</a></li>
            
                <li><a href="../classes/JC.confirm.html">JC.confirm</a></li>
            
                <li><a href="../classes/JC.DCalendar.html">JC.DCalendar</a></li>
            
                <li><a href="../classes/JC.Dialog.html">JC.Dialog</a></li>
            
                <li><a href="../classes/JC.Dialog.alert.html">JC.Dialog.alert</a></li>
            
                <li><a href="../classes/JC.Dialog.confirm.html">JC.Dialog.confirm</a></li>
            
                <li><a href="../classes/JC.Dialog.mask.html">JC.Dialog.mask</a></li>
            
                <li><a href="../classes/JC.Dialog.msgbox.html">JC.Dialog.msgbox</a></li>
            
                <li><a href="../classes/JC.Drag.html">JC.Drag</a></li>
            
                <li><a href="../classes/JC.f.html">JC.f</a></li>
            
                <li><a href="../classes/JC.Fixed.html">JC.Fixed</a></li>
            
                <li><a href="../classes/JC.Form.html">JC.Form</a></li>
            
                <li><a href="../classes/JC.FormFillUrl.html">JC.FormFillUrl</a></li>
            
                <li><a href="../classes/JC.hideAllPanel.html">JC.hideAllPanel</a></li>
            
                <li><a href="../classes/JC.hideAllPopup.html">JC.hideAllPopup</a></li>
            
                <li><a href="../classes/JC.ImageCutter.html">JC.ImageCutter</a></li>
            
                <li><a href="../classes/JC.Lazyload.html">JC.Lazyload</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.html">JC.LunarCalendar</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.Model.html">JC.LunarCalendar.Model</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.View.html">JC.LunarCalendar.View</a></li>
            
                <li><a href="../classes/JC.msgbox.html">JC.msgbox</a></li>
            
                <li><a href="../classes/JC.NumericStepper.html">JC.NumericStepper</a></li>
            
                <li><a href="../classes/JC.Panel.html">JC.Panel</a></li>
            
                <li><a href="../classes/JC.Panel.Model.html">JC.Panel.Model</a></li>
            
                <li><a href="../classes/JC.Panel.View.html">JC.Panel.View</a></li>
            
                <li><a href="../classes/JC.Placeholder.html">JC.Placeholder</a></li>
            
                <li><a href="../classes/JC.PopTips.html">JC.PopTips</a></li>
            
                <li><a href="../classes/JC.Scrollbar.html">JC.Scrollbar</a></li>
            
                <li><a href="../classes/JC.Slider.html">JC.Slider</a></li>
            
                <li><a href="../classes/JC.Slider.Model.html">JC.Slider.Model</a></li>
            
                <li><a href="../classes/JC.Suggest.html">JC.Suggest</a></li>
            
                <li><a href="../classes/JC.Tab.html">JC.Tab</a></li>
            
                <li><a href="../classes/JC.Tab.Model.html">JC.Tab.Model</a></li>
            
                <li><a href="../classes/JC.Tab.View.html">JC.Tab.View</a></li>
            
                <li><a href="../classes/JC.TableFreeze.html">JC.TableFreeze</a></li>
            
                <li><a href="../classes/JC.TableSort.html">JC.TableSort</a></li>
            
                <li><a href="../classes/JC.Tips.html">JC.Tips</a></li>
            
                <li><a href="../classes/JC.Tips.Model.html">JC.Tips.Model</a></li>
            
                <li><a href="../classes/JC.Tips.View.html">JC.Tips.View</a></li>
            
                <li><a href="../classes/JC.Tree.html">JC.Tree</a></li>
            
                <li><a href="../classes/JC.Tree.Model.html">JC.Tree.Model</a></li>
            
                <li><a href="../classes/JC.Valid.html">JC.Valid</a></li>
            
                <li><a href="../classes/window.Bizs.ActionLogic.html">window.Bizs.ActionLogic</a></li>
            
                <li><a href="../classes/window.Bizs.AutoSelectComplete.html">window.Bizs.AutoSelectComplete</a></li>
            
                <li><a href="../classes/window.Bizs.ChangeLogic.html">window.Bizs.ChangeLogic</a></li>
            
                <li><a href="../classes/window.Bizs.CommonModify.html">window.Bizs.CommonModify</a></li>
            
                <li><a href="../classes/window.Bizs.DisableLogic.html">window.Bizs.DisableLogic</a></li>
            
                <li><a href="../classes/window.Bizs.DMultiDate.html">window.Bizs.DMultiDate</a></li>
            
                <li><a href="../classes/window.Bizs.DropdownTree.html">window.Bizs.DropdownTree</a></li>
            
                <li><a href="../classes/window.Bizs.FormLogic.html">window.Bizs.FormLogic</a></li>
            
                <li><a href="../classes/window.Bizs.KillISPCache.html">window.Bizs.KillISPCache</a></li>
            
                <li><a href="../classes/window.Bizs.MoneyTips.html">window.Bizs.MoneyTips</a></li>
            
                <li><a href="../classes/window.Bizs.MultiDate.html">window.Bizs.MultiDate</a></li>
            
                <li><a href="../classes/window.Bizs.MultiSelect.html">window.Bizs.MultiSelect</a></li>
            
                <li><a href="../classes/window.Bizs.MultiUpload.html">window.Bizs.MultiUpload</a></li>
            
                <li><a href="../classes/window.jQuery.html">window.jQuery</a></li>
            
                <li><a href="../classes/window.requirejs.html">window.requirejs</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ../modules/JC.Drag/0.1/Drag.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
;(function(define, _win) { &#x27;use strict&#x27;; define( [ &#x27;JC.BaseMVC&#x27; ], function(){
/**
 * 响应式 Drag and Drop 功能
 * &lt;br /&gt;对 [ div | button ].js_compDrag 生效
 *
 *&lt;p&gt;&lt;b&gt;require&lt;/b&gt;:
 *   &lt;a href=&quot;widnow.jQuery.html&quot;&gt;jQuery&lt;/a&gt;
 *   , &lt;a href=&quot;JC.common.html&quot;&gt;JC.common&lt;/a&gt;
 *   , &lt;a href=&#x27;JC.BaseMVC.html&#x27;&gt;JC.BaseMVC&lt;/a&gt;
 *&lt;/p&gt;
 *
 *&lt;p&gt;&lt;a href=&#x27;https://github.com/openjavascript/jquerycomps&#x27; target=&#x27;_blank&#x27;&gt;JC Project Site&lt;/a&gt;
 *   | &lt;a href=&#x27;http://jc2.openjavascript.org/docs_api/classes/JC.Drag.html&#x27; target=&#x27;_blank&#x27;&gt;API docs&lt;/a&gt;
 *   | &lt;a href=&#x27;../../modules/JC.Drag/0.1/_demo&#x27; target=&#x27;_blank&#x27;&gt;demo link&lt;/a&gt;&lt;/p&gt;
 *  
 *&lt;h2&gt;通用 HTML attribute&lt;/h2&gt;
 *&lt;dl&gt;
 *    &lt;dt&gt;dragTarget = selector, default = self&lt;/dt&gt;
 *    &lt;dd&gt;要拖动的 selector, 可以通过该属性指定拖动的父节点&lt;dd&gt;
 *
 *    &lt;dt&gt;dragIn = selector, default = window&lt;/dt&gt;
 *    &lt;dd&gt;可拖动的范围&lt;/dd&gt;
 *
 *    &lt;dt&gt;disableDrag = bool, default = false&lt;/dt&gt;
 *    &lt;dd&gt;是否禁止拖动, 会执行实例初始化&lt;/dd&gt;
 *
 *    &lt;dt&gt;ignoreDrog = bool, default = false&lt;/dt&gt;
 *    &lt;dd&gt;是否忽略拖动, 不会执行实例初始化&lt;/dd&gt;
 *
 *    &lt;dt&gt;dragInitedCb = function, &lt;b&gt;window 变量域&lt;/b&gt;&lt;/dt&gt;
 *    &lt;dd&gt;实例初始化后调用的回调
&lt;pre&gt;function dragInitedCb( _selector, _dragTarget ){
    var _ins = this;
    JC.log( &#x27;dragInitedCb&#x27;, new Date().getTime() );
}&lt;/pre&gt;
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;dragBeforeCb = function, &lt;b&gt;window 变量域&lt;/b&gt;&lt;/dt&gt;
 *    &lt;dd&gt;拖动之前调用的回调, 如果返回 false, 将停止拖动操作
&lt;pre&gt;function dragBeforeCb( _dragTarget, _selector ){
    var _ins = this;
    JC.log( &#x27;dragBeforeCb&#x27;, new Date().getTime() );
    //return false;
}&lt;/pre&gt;
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;dragAfterCb = function, &lt;b&gt;window 变量域&lt;/b&gt;&lt;/dt&gt;
 *    &lt;dd&gt;拖动完成之后的回调
&lt;pre&gt;function dragAfterCb( _dragTarget, _selector ){
    var _ins = this;
    JC.log( &#x27;dragAfterCb&#x27;, new Date().getTime() );
}&lt;/pre&gt;
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;dragBeginCb = function, &lt;b&gt;window 变量域&lt;/b&gt;&lt;/dt&gt; 
 *    &lt;dd&gt;拖动开始时的回调
&lt;pre&gt;function dragBeginCb( _selector, _dragTarget, _movingSelector ){
    var _ins = this;
    JC.log( &#x27;dragBeginCb&#x27;, new Date().getTime() );
}&lt;/pre&gt;
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;dragMovingCb = function, &lt;b&gt;window 变量域&lt;/b&gt;&lt;/dt&gt;
 *    &lt;dd&gt;拖动移动时的回
&lt;pre&gt;function dragMovingCb( _selector, _dragTarget, _movingSelector, _x, _y, _evt ){
    var _ins = this;
    JC.log( &#x27;dragMovingCb&#x27;, new Date().getTime() );
}&lt;/pre&gt;
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;dragDoneCb = function, &lt;b&gt;window 变量域&lt;/b&gt;&lt;/dt&gt;
 *    &lt;dd&gt;拖动完成时的回调
&lt;pre&gt;function dragDoneCb( _selector, _dragTarget ){
    var _ins = this;
    JC.log( &#x27;dragDoneCb&#x27;, new Date().getTime() );
}&lt;/pre&gt;
 *    &lt;/dd&gt;
 *
 *&lt;/dl&gt; 
 *
 *&lt;h2&gt;drop HTML attribute&lt;/h2&gt;
 *&lt;dl&gt;
 *    &lt;dt&gt;dropFor = selector&lt;/dt&gt;
 *    &lt;dd&gt;指定可拖放的 selector&lt;/dd&gt;
 *
 *    &lt;dt&gt;dropSwap = bool, default = false&lt;/dt&gt;
 *    &lt;dd&gt;
 *          是否交换拖曳的位置
 *          &lt;br /&gt;为真, 交换 selector 的位置
 *          &lt;br /&gt;不为真, 将 append 到目标 selector
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;disableDrop = bool, default = false&lt;/dt&gt;
 *    &lt;dd&gt;是否禁止 拖放功能, 这个属性应当写在  dropFor 的 selector 里&lt;/dd&gt;
 *
 *    &lt;dt&gt;dropDoneCb = function, &lt;b&gt;window 变量域&lt;/b&gt;&lt;/dt&gt;
 *    &lt;dd&gt;拖放完成时的回调, 如果返回 false, 将停止拖放操
&lt;pre&gt;function dropDoneCb( _dragTarget, _dropTarget ){
    var _initSelector = this;
    JC.log( &#x27;dropDoneCb&#x27;, new Date().getTime() );
    //return false;
}&lt;/pre&gt;
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;dropDoneAfterCb = function, &lt;b&gt;window 变量域&lt;/b&gt;&lt;/dt&gt;
 *    &lt;dd&gt;拖放完成后的回调
&lt;pre&gt;function dropDoneAfterCb( _dragTarget, _dropTarget ){
    var _initSelector = this;
    JC.log( &#x27;dropDoneAfterCb&#x27;, new Date().getTime() );
}&lt;/pre&gt;
 *    &lt;/dd&gt;
 *&lt;/dl&gt;
 *
 * @namespace   JC
 * @class       Drag
 * @extends     JC.BaseMVC
 * @constructor
 * @param   {selector|string}   _selector   
 * @version dev 0.1 2013-12-26
 * @author  qiushaowei &lt;suches@btbtd.org&gt; | 75 Team
 * @example
        &lt;h2&gt;拖动示例&lt;/h2&gt;
        &lt;div class=&quot;JCDrag dragStyle1 js_compDrag&quot; dragBeginCb=&quot;dragBeginCb&quot;&gt;
            normal drag 
            , dragBeginCb=&quot;dragBeginCb&quot;
        &lt;/div&gt;

        &lt;h2&gt;拖放示例&lt;/h2&gt;
        &lt;table&gt;
            &lt;tr&gt;
                &lt;td&gt;
                    &lt;div class=&quot;js_compDrag&quot; 
                        dropFor=&quot;(table div.js_compDrag&quot; 
                        dropSwap=&quot;true&quot; 
                        dropDoneCb=&quot;dropDoneCbAllow&quot;
                        &gt;
                        dropDoneCb=&quot;dropDoneCbAllow&quot;
                    &lt;/div&gt;
                &lt;/td&gt;
                &lt;td&gt;
                    &lt;div class=&quot;js_compDrag&quot; 
                        dropFor=&quot;(table div.js_compDrag&quot; 
                        dropSwap=&quot;true&quot; 
                        dropDoneCb=&quot;dropDoneCbBan&quot;
                        &gt; 
                        dropDoneCb=&quot;dropDoneCbBan&quot;
                    &lt;/div&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        &lt;/table&gt;
 */
    JC.Drag = Drag;
    var _jdoc = $( document ), _jwin = $( window );

    function Drag( _selector ){
        _selector &amp;&amp; ( _selector = $( _selector ) );

        if( JC.BaseMVC.getInstance( _selector, Drag ) ) 
            return JC.BaseMVC.getInstance( _selector, Drag );

        JC.BaseMVC.getInstance( _selector, Drag, this );

        this._model = new Drag.Model( _selector );
        this._view = new Drag.View( this._model );

        this._init();

        JC.log( Drag.Model._instanceName, &#x27;inited&#x27;, new Date().getTime() );
    }

    JC.BaseMVC.build( Drag );

    JC.f.extendObject( Drag.prototype, {
        _beforeInit:
            function(){
                //JC.log( &#x27;Drag _beforeInit&#x27;, new Date().getTime() );
            }

        , _initHanlderEvent:
            function(){
                var _p = this;

                _p.on( Drag.Model.DRAG_INITED, function( _evt ){

                    _p._model.defaultCSSPosition( _p._model.dragTarget().css( &#x27;position&#x27; ) );
                    _p._model.defaultCSSZIndex( _p._model.dragTarget().css( &#x27;z-index&#x27; ) );
                    _p._model.defaultCSSCursor( _p._model.dragTarget().css( &#x27;cursor&#x27; ) );

                    _p._model.selector().css( { &#x27;cursor&#x27;: &#x27;move&#x27; } );
                    
                    _p._model.dragInitedCb() 
                        &amp;&amp; _p._model.dragInitedCb().call( _p, _p.selector(), _p.dragTarget() );
                    /*
                    JC.log( &#x27;Drag _inited&#x27;, new Date().getTime()
                            , _p._model.defaultCSSPosition() 
                            , _p._model.defaultCSSZIndex() 
                            );
                    */
                });

                _p.selector().on( &#x27;mousedown&#x27;, function( _evt, _srcEvt ){
                    _evt = _srcEvt || _evt;

                    if( _p._model.boolProp( Drag.Model.DISABLE_DRAG ) ) return;
                    if( _p._model.boolProp( Drag.Model.IGNORE_DRAG ) ) return;

                    Drag.cleanDragData();

                    if( _p._model.dragBeforeCb() 
                        &amp;&amp; _p._model.dragBeforeCb().call( _p, _p._model.dragTarget(), _p.selector() ) === false 
                    ){
                        return;
                    }

                    _p.trigger( Drag.Model.DRAG_BEFORE );

                    _p._model.relativeParent( true );

                    _p._model.isDropFor() 
                        &amp;&amp; ( 
                                _p._model.dragMovingTarget( true )
                                , _p._model.dropFor( true )
                           );

                    Drag.dragInfo( _p, _evt );
                    _p.trigger( Drag.Model.DRAG_BEGIN, [ _evt, Drag.dragInfo() ] );

                    _jdoc.on( &#x27;mouseup&#x27;, Drag.defaultMouseUp );
                    _jdoc.on( &#x27;mousemove&#x27;, Drag.defaultMouseMove );
                    _jwin.on( &#x27;scroll&#x27;, Drag.defaultScroll );

                    return false;
                });

                //低版本 IE 拖曳时不选中文字
                _p.selector()[0].onselectstart = function(){ return false; };

                _p.on( Drag.Model.DRAG_BEFORE, function( _evt ){
                    JC.log( &#x27;drag before&#x27;, new Date().getTime() );
                });

                _p.on( Drag.Model.DRAG_BEGIN, function( _evt, _dragInfo ){
                    JC.log( &#x27;drag begin&#x27;, new Date().getTime() );

                    _p._model.dragTarget().css( &#x27;z-index&#x27;, window.ZINDEX_COUNT++ );

                    Drag.draggingItem( _p._model.dragTarget() );

                    _p._model.dragBeginCb() 
                        &amp;&amp; _p._model.dragBeginCb().call( 
                            _p
                            , _p.selector()
                            , _p._model.dragTarget()
                            , _p._model.dragMovingTarget() 
                        );
                });

                _p.on( Drag.Model.DRAG_DONE, function( _evt, _dragInfo ){
                    JC.log( &#x27;drag done&#x27;, new Date().getTime() );

                    _p._view.dropDone( _dragInfo );
                    _p._view.clean( _dragInfo );
                    _p._model.clean( _dragInfo );

                    Drag.draggingItem( null );

                    _p._model.dragDoneCb() 
                        &amp;&amp; _p._model.dragDoneCb().call( 
                            _p
                            , _p.selector()
                            , _p._model.dragTarget() 
                        );

                    _p.trigger( Drag.Model.DRAG_AFTER );

                    Drag.cleanDragData();
                });

                _p.on( Drag.Model.DRAGGING_MOVING, function( _evt, _x, _y, _srcEvt, _offset ){
                    //JC.log( &#x27;Drag.Model.DRAGGING_MOVING&#x27;, new Date().getTime() );DRAG_MOVING
                    _p._model.dragMovingCb()
                        &amp;&amp; _p._model.dragMovingCb().call(
                            _p
                            , _p.selector()
                            , _p.dragTarget()
                            , _p.dragMovingTarget()
                            , _x
                            , _y
                            , _srcEvt
                        );
                });

                _p.on( Drag.Model.DRAG_AFTER, function( _evt ){
                    JC.log( &#x27;drag after&#x27;, new Date().getTime() );

                    _p._model.dragAfterCb() 
                        &amp;&amp; _p._model.dragAfterCb().call( 
                            _p
                            , _p._model.dragTarget()
                            , _p.selector() 
                        );
                });

                _p.on( Drag.Model.TRIGGER_DRAG, function( _evt, _srcEvt ){
                    _p.selector().trigger( &#x27;mousedown&#x27;, [ _srcEvt || _evt ] );
                });
            }

        , _inited:
            function(){
                this.trigger( Drag.Model.DRAG_INITED );
            }
        /**
         * 获取拖动的源节点
         * @method  dragTarget
         * @return  selector
         */
        , dragTarget: function(){ return this._model.dragTarget(); }
        /**
         * 获取拖动时移动的节点, drag 使用 dragTarget, drop clone dragTarget
         * @method  dragMovingTarget
         * @return  selector
         */
        , dragMovingTarget: function(){ return this._model.dragMovingTarget(); }
        /**
         * 获取可拖动范围的 [ 节点 | window ]
         * @method dragIn
         * @return {selector|window}
         */
        , dragIn: function(){ return this._model.dragIn(); }
        /**
         * 更新 dragMovingTarget 的位置 
         * @method  _updatePosition
         * @protected
         */
        , _updatePosition: 
            function(){ 
                this._view.updatePosition.apply( this._view, JC.f.sliceArgs( arguments ) ); 
                return this;
            }
    });
    /**
     * 初始化可识别的 Drag 实例
     * @method  init
     * @param   {selector}      _selector
     * @static
     * @return  {Array of DragInstance}
     */
    Drag.init =
        function( _selector ){
            var _r = [];
            _selector = $( _selector || document );

            if( _selector &amp;&amp; _selector.length ){
                if( _selector.hasClass( &#x27;js_compDrag&#x27; )  ){
                    !_selector.is( &#x27;[&#x27; + Drag.Model.IGNORE_DRAG + &#x27;]&#x27; ) &amp;&amp; _r.push( new Drag( _selector ) );
                }else{
                    _selector.find( &#x27;div.js_compDrag, button.js_compDrag&#x27; ).each( function(){
                        !_selector.is( &#x27;[&#x27; + Drag.Model.IGNORE_DRAG + &#x27;]&#x27; ) &amp;&amp; _r.push( new Drag( this ) );
                    });
                }
            }
            return _r;
        };
    /**
     * 设置/获取 拖动时所需的数据
     * @method  dragInfo
     * @param   {DragInstance}  _ins
     * @param   {event}         _evt
     * @return  {json|null}
     * @static
     */
    Drag.dragInfo =
        function( _ins, _evt ){
            if( _ins &amp;&amp; _evt ){
                Drag._dragInfo = {
                    &#x27;ins&#x27;: _ins
                    , &#x27;evt&#x27;: _evt
                    , &#x27;offset&#x27;: _ins._model.offset( _evt )
                };
            }
            return Drag._dragInfo;
        };
    /**
     * 设置当前的拖动 selector
     * @method  draggingItem
     * @param   {selector|null}  _setter
     * @return  {selector|null}
     * @static
     */
    Drag.draggingItem =
        function( _setter ){
            if( typeof _setter != &#x27;undefined&#x27; ){
                Drag._draggingItem &amp;&amp; Drag._draggingItem.data( Drag.Model.DRAGGING_ITEM, false );
                _setter &amp;&amp; _setter.data( Drag.Model.DRAGGING_ITEM, true );

                Drag._draggingItem = _setter;
            }
            return Drag._draggingItem;
        };
    /**
     * 清除拖动的相关数据
     * @method  cleanDragData
     * @static
     */
    Drag.cleanDragData = 
        function(){ 
            _jdoc.off( &#x27;mousemove&#x27;, Drag.defaultMouseMove );
            _jdoc.off( &#x27;mouseup&#x27;, Drag.defaultMouseUp );
            _jwin.off( &#x27;scroll&#x27;, Drag.defaultScroll );

            Drag._dragInfo = null; 
            Drag.draggingItem( null );
        };
    /**
     * 拖动时, 默认的 mousemove 函数
     * @method  defaultMouseMove
     * @param   {evt}   _evt
     * @static
     */
    Drag.defaultMouseMove =
        function( _evt ){
            if( !Drag.dragInfo() ) return;
            //JC.log( &#x27;JC.Drag mousemove&#x27;, new Date().getTime() );
            var _di = Drag.dragInfo()
                , _p = _di.ins
                , _offset = _di.offset
                , _newX, _newY
                ;
            if( !_p ) return;
            _newX = _evt.pageX - _offset.x;
            _newY = _evt.pageY - _offset.y;

            _newX &lt;= _offset.minX &amp;&amp; ( _newX = _offset.minX );
            _newY &lt;= _offset.minY &amp;&amp; ( _newY = _offset.minY );

            _newX &gt;= _offset.maxX &amp;&amp; ( _newX = _offset.maxX );
            _newY &gt;= _offset.maxY &amp;&amp; ( _newY = _offset.maxY );

            _newX -= _di.offset.relativeFixX;
            _newY -= _di.offset.relativeFixY;

            //JC.log( _newX, _newY, _offset.maxX, _offset.maxY );
            _p._updatePosition( _newX, _newY, _offset );
            _p.trigger( Drag.Model.DRAGGING_MOVING, [ _newX, _newY, _evt, _offset ] );
        };
    /**
     * 拖动时, 默认的 mouseup 函数
     * @method  defaultMouseUp
     * @param   {evt}   _evt
     * @static
     */
    Drag.defaultMouseUp =
        function( _evt ){
            var _di = Drag.dragInfo();

            if( _di &amp;&amp; _di.ins ){
                _di.ins.trigger( Drag.Model.DRAG_DONE, _di );
            }

            Drag.cleanDragData();
        };
    /**
     * 拖动时, 默认的 scroll 函数
     * @method  defaultScroll
     * @param   {evt}   _evt
     * @static
     */
    Drag.defaultScroll =
        function( _evt ){
            //
            /// 如果 dragIn 不是 window的时候, scrollTop 计算有问题
            //
            var _di = Drag.dragInfo();
            if( !( _di &amp;&amp; _di.ins ) ) return;
            var _scrollX = _di.ins.dragIn().scrollLeft()
                , _scrollY = _di.ins.dragIn().scrollTop()
                , _offset = _di.ins.dragMovingTarget().offset()
                , _newX, _newY
                , _fixScrollX = _scrollX - _di.offset.scrollX
                , _fixScrollY = _scrollY - _di.offset.scrollY
                ;

            _newX = _offset.left + _fixScrollX;
            _newY = _offset.top + _fixScrollY;

            //JC.log( _di.offset.scrollY, _scrollY, _offset.left, _newX, _offset.top, _newY );
            /*
            _di.ins.dragMovingTarget().css({
                &#x27;left&#x27;: _newX + &#x27;px&#x27;
                , &#x27;top&#x27;: _newY + &#x27;px&#x27;
            });
            */
            _newX -= _di.offset.relativeFixX;
            _newY -= _di.offset.relativeFixY;

            _di.ins._updatePosition( _newX, _newY, _offset );

            _di.offset.scrollX = _scrollX;
            _di.offset.scrollY = _scrollY;
            _di.offset.maxX += _fixScrollX;
            _di.offset.maxY += _fixScrollY;
        };

    Drag.Model._instanceName = &#x27;JCDragIns&#x27;;

    Drag.Model.DRAG_INITED = &#x27;JCDragInited&#x27;;
    Drag.Model.DRAG_BEFORE = &#x27;JCDragBefore&#x27;;
    Drag.Model.DRAG_BEGIN = &#x27;JCDragBegin&#x27;;
    Drag.Model.DRAG_DONE = &#x27;JCDragDone&#x27;;
    Drag.Model.DRAG_AFTER = &#x27;JCDragAfter&#x27;;
    Drag.Model.DRAGGING_ITEM = &#x27;JCDraggingItem&#x27;;
    Drag.Model.DRAGGING_MOVING= &#x27;JCDraggingMoving&#x27;;
    Drag.Model.DROP_DONE = &#x27;JCDropDone&#x27;;
    Drag.Model.DROP_DONE_AFTER = &#x27;JCDropDoneAfter&#x27;;

    Drag.Model.DISABLE_DRAG = &#x27;disableDrag&#x27;;
    Drag.Model.DISABLE_DROP = &#x27;disableDrop&#x27;;
    Drag.Model.IGNORE_DRAG = &#x27;ignoreDrog&#x27;;

    Drag.Model.TRIGGER_DRAG = &#x27;JCTriggerDrag&#x27;;

    Drag.Model.CLASS_CURRENT = &#x27;JCCurrentDropBox&#x27;;
    Drag.Model.CLASS_MOVING = &#x27;JCMovingDropBox&#x27;;

    JC.f.extendObject( Drag.Model.prototype, {
        init:
            function(){
                //JC.log( &#x27;Drag.Model.init:&#x27;, new Date().getTime() );
            }

        , defaultCSSPosition:
            function( _setter ){
                typeof _setter != &#x27;undefined&#x27; &amp;&amp; ( this._defaultCSSPosition = _setter );
                return this._defaultCSSPosition;
            }

        , defaultCSSZIndex:
            function( _setter ){
                typeof _setter != &#x27;undefined&#x27; &amp;&amp; ( this._defaultCSSZIndex = _setter );
                return this._defaultCSSZIndex;
            }

        , defaultCSSCursor:
            function( _setter ){
                typeof _setter != &#x27;undefined&#x27; &amp;&amp; ( this._defaultCSSCursor = _setter );
                return this._defaultCSSCursor;
            }

        , dragTarget:
            function(){
                var _p = this;
                if( !_p._dragTarget ){
                    _p._dragTarget = _p.selectorProp( &#x27;dragTarget&#x27; );

                    !( _p._dragTarget &amp;&amp; _p._dragTarget.length ) 
                        &amp;&amp; ( _p._dragTarget = _p.selector() )
                        ;
                }
                return _p._dragTarget;
            }

        , dragMovingTarget:
            function( _cleanCache ){
                var _p = this, _isDropFor = _p.isDropFor();

                if( _isDropFor &amp;&amp; _cleanCache ){
                    _p._dragMovingTarget &amp;&amp; _p._dragMovingTarget.remove();
                    _p._dragMovingTarget = null;
                }

                if( !_p._dragMovingTarget ){
                    _p._dragMovingTarget = _p.dragTarget();

                    if( _isDropFor ){
                        var _offset = _p.dragTarget().offset();

                        _p._dragMovingTarget = _p.dragTarget().clone();
                        _p._dragMovingTarget.css( { 
                            &#x27;position&#x27;: &#x27;absolute&#x27;
                            , &#x27;left&#x27;: _offset.left + &#x27;px&#x27;
                            , &#x27;top&#x27;: _offset.top + &#x27;px&#x27;
                            , &#x27;z-index&#x27;: window.ZINDEX_COUNT++ 
                        } );
                        _p._dragMovingTarget.attr( Drag.Model.DISABLE_DROP, true )
                            .attr( Drag.Model.IGNORE_DRAG, true )
                            .addClass( Drag.Model.CLASS_MOVING )
                            ;
                    }
                }

                _isDropFor 
                    &amp;&amp; _cleanCache 
                    &amp;&amp; _p.dragTarget().after( _p._dragMovingTarget )
                    ;

                return _p._dragMovingTarget;
            }

        , isDropFor: 
            function(){ 
                typeof this._isDropFor == &#x27;undefined&#x27;
                    &amp;&amp; ( this._isDropFor = this.is( &#x27;[dropFor]&#x27; ) &amp;&amp; JC.f.parseBool( this.attrProp( &#x27;dropFor&#x27; ) ) );
                return this._isDropFor;
            }

        , dropFor: 
            function( _cleanCache ){
                ( !this._dropFor == &#x27;undefined&#x27; || _cleanCache )
                    &amp;&amp; ( this._dropFor = this.selectorProp( &#x27;dropFor&#x27; ) );
                return this._dropFor;
            }

        , relativeParent:
            function( _cleanCache ){
                if( !this._relativeParent == &#x27;undefined&#x27; || _cleanCache ){
                    this._relativeParent = null;
                    var _tmp = this.dragTarget();
                    while( (_tmp = $( _tmp.parent() ) ).length ){
                        if( /body|html/i.test( _tmp.prop( &#x27;nodeName&#x27; ) ) ) break;
                        if( ( _tmp.css( &#x27;position&#x27; ) || &#x27;&#x27; ).toLowerCase() == &#x27;relative&#x27; ){
                            this._relativeParent = _tmp;
                            break;
                        }
                    }
                }
                return this._relativeParent;
            }

        , dropSwap:
            function(){
                return this.boolProp( &#x27;dropSwap&#x27; );
            }

        , selectedDropBox:
            function( _x, _y ){
                var _p = this, _dropFor = _p.dropFor(), _di = Drag.dragInfo();

                if( !_di ){ return null; }

                if( typeof _x != &#x27;undefined&#x27; &amp;&amp; typeof _y != &#x27;undefined&#x27; &amp;&amp; _dropFor &amp;&amp; _dropFor.length ){
                    _p._selectedDropBox = null;

                    if( _dropFor &amp;&amp; _dropFor.length ){
                        var _ls = []
                            , _srcRect = locationToRect( _x, _y, _di.offset.width, _di.offset.height )
                            ;

                        _dropFor.each( function(){
                            var _sp = $(this);

                            if( _sp.is( &#x27;[&#x27; + Drag.Model.DISABLE_DROP + &#x27;]&#x27; ) ) { return; }

                            var _offset = _sp.offset()
                                , _rect = locationToRect( _offset.left
                                                            , _offset.top
                                                            , _sp.prop( &#x27;offsetWidth&#x27; )
                                                            , _sp.prop( &#x27;offsetHeight&#x27; )
                                                        );

                            if( intersectRect( _srcRect, _rect ) ){
                                _rect.selector = _sp;
                                _ls.push( _rect );
                            }
                        });

                        if( _ls.length ){
                            var _findItem;
                            $.each( _ls, function( _ix, _rect ){
                                _rect.dist = pointDistance( rectToPoint( _srcRect ), rectToPoint( _rect ) );

                                //_rect.selector.html( JC.f.moneyFormat( _dist ) );

                                if( !_ix ){
                                    _findItem = _rect;
                                    return;
                                }
                                _rect.dist &lt; _findItem.dist &amp;&amp; ( _findItem = _rect );
                            });
                            this._selectedDropBox = _findItem.selector;
                        }else{
                            this._selectedDropBox = null;
                        }
                    }
                }
                return this._selectedDropBox;
            }

        , dragIn:
            function(){
                if( ! ( this._dragIn &amp;&amp; this._dragIn.length ) ){
                    this._dragIn = this.selectorProp( &#x27;dragIn&#x27; );
                    !( this._dragIn &amp;&amp; this._dragIn.length )
                        &amp;&amp; ( this._dragIn = $( window ) )
                        ;
                }
                return this._dragIn;
            }

        , offset:
            function( _evt ){
                var _p = this
                    , _toffset = _p.dragTarget().offset()
                    , _inoffset = _p.dragIn().offset()
                    , _roffset = _p.relativeParent() ? _p.relativeParent().offset() : { &#x27;left&#x27;: 0, &#x27;top&#x27;: 0 }
                    , _r = {
                        &#x27;mouseX&#x27;: _evt.pageX
                        , &#x27;mouseY&#x27;: _evt.pageY
                        , &#x27;targetX&#x27;: _toffset.left
                        , &#x27;targetY&#x27;: _toffset.top
                        , &#x27;scrollX&#x27;: _p.dragIn().scrollLeft()
                        , &#x27;scrollY&#x27;: _p.dragIn().scrollTop() 
                        , &#x27;maxXFix&#x27;: -1
                        , &#x27;maxYFix&#x27;: -1
                        , &#x27;width&#x27;: _p.dragTarget().prop( &#x27;offsetWidth&#x27; )
                        , &#x27;height&#x27;: _p.dragTarget().prop( &#x27;offsetHeight&#x27; )
                        , &#x27;relativeFixX&#x27;: _roffset.left
                        , &#x27;relativeFixY&#x27;: _roffset.top
                    };

                    _r.x = _r.mouseX - _r.targetX;
                    _r.y = _r.mouseY - _r.targetY;

                    !_inoffset &amp;&amp; ( _inoffset = { &#x27;left&#x27;: 0, &#x27;top&#x27;: 0 } , _r.maxXFix = 0, _r.maxYFix = 0 );
                    _r.minX = _inoffset.left;
                    _r.minY = _inoffset.top;

                    _r.maxX = _r.minX 
                                    + _p.dragIn().scrollLeft() 
                                    + _p.dragIn().width() 
                                    - _r.width
                                    - _r.maxXFix
                                    ;

                    _r.maxY = _r.minY 
                                    + _p.dragIn().scrollTop() 
                                    + _p.dragIn().height() 
                                    - _r.height
                                    - _r.maxYFix
                                    ;

                    //JC.log( [ _r.maxX, _r.maxY, _p.dragTarget().width(), _p.dragTarget().prop( &#x27;offsetWidth&#x27; ) ] );

                return _r;
            }

        , dragInitedCb: function(){ return this.callbackProp( &#x27;dragInitedCb&#x27; ) || Drag.dragInitedCb; }
        , dragBeforeCb: function(){ return this.callbackProp( &#x27;dragBeforeCb&#x27; ) || Drag.dragBeforeCb; }
        , dragAfterCb: function(){ return this.callbackProp( &#x27;dragAfterCb&#x27; ) || Drag.dragAfterCb; }
        , dragBeginCb: function(){ return this.callbackProp( &#x27;dragBeginCb&#x27; ) || Drag.dragBeginCb; }
        , dragMovingCb: function(){ return this.callbackProp( &#x27;dragMovingCb&#x27; ) || Drag.dragMovingCb; }
        , dragDoneCb: function(){ return this.callbackProp( &#x27;dragDoneCb&#x27; ) || Drag.dragDoneCb; }
        , dropDoneCb: function(){ return this.callbackProp( &#x27;dropDoneCb&#x27; ) || Drag.dropDoneCb; }
        , dropDoneAfterCb: function(){ return this.callbackProp( &#x27;dropDoneAfterCb&#x27; ) || Drag.dropDoneAfterCb; }

        , clean:
            function( _dragInfo ){
                var _p = this;
            }
    });

    JC.f.extendObject( Drag.View.prototype, {
        init:
            function(){
                //JC.log( &#x27;Drag.View.init:&#x27;, new Date().getTime() );
            }

        , updatePosition: 
            function( _x, _y ){
                var _p = this
                    , _dt = _p._model.dragMovingTarget()
                    , _selectedDropBox
                    ;

                _dt.css({
                    &#x27;left&#x27;: _x + &#x27;px&#x27;
                    , &#x27;top&#x27;: _y + &#x27;px&#x27;
                });

                if( _p._model.isDropFor() ){
                    _selectedDropBox = _p._model.selectedDropBox();
                    _selectedDropBox &amp;&amp; _selectedDropBox.removeClass( Drag.Model.CLASS_CURRENT );
                    _selectedDropBox = _p._model.selectedDropBox( _x, _y );
                    _selectedDropBox &amp;&amp; _selectedDropBox.addClass( Drag.Model.CLASS_CURRENT );
                }
            }

        , dropDone:
            function( _dragInfo ){
                var _p = this;

                if( _p._model.isDropFor() ){
                    var _selectedDropBox = _p._model.selectedDropBox();
                    if( !( _selectedDropBox &amp;&amp; _selectedDropBox.length ) ) return;

                    if( _selectedDropBox.data( Drag.Model.DRAGGING_ITEM ) ) return;


                    if( _p._model.dropDoneCb() 
                            &amp;&amp; _p._model.dropDoneCb().call( 
                                _p._model.selector()
                                , _p._model.dragTarget() 
                                , _selectedDropBox
                           ) === false
                    ){
                        return;
                    }

                    _p.trigger( Drag.Model.DROP_DONE );

                    if( _p._model.dropSwap() ){
                        var _srcIpt = $( &#x27;&lt;input type=&quot;hidden&quot; /&gt;&#x27; )
                            , _targetIpt = _srcIpt.clone()
                            ;
                        _p._model.dragTarget().after( _srcIpt );
                        _selectedDropBox.after( _targetIpt );

                        _targetIpt.after( _p._model.dragTarget() );
                        _srcIpt.after( _selectedDropBox );

                        _srcIpt.remove();
                        _targetIpt.remove();
                    }else{
                        _p._model.dragTarget().appendTo( _selectedDropBox );
                    }

                    _p._model.dropDoneAfterCb() 
                        &amp;&amp; _p._model.dropDoneAfterCb().call( 
                            _p._model.selector()
                            , _p._model.dragTarget() 
                            , _selectedDropBox
                        );

                    _p.trigger( Drag.Model.DROP_DONE_AFTER );
                }
            }

        , clean:
            function( _dragInfo ){
                var _p = this;

                if( _p._model.isDropFor() ){
                    _p._model.dragMovingTarget() 
                        &amp;&amp; _p._model.dragMovingTarget().remove()
                        ;

                    _p._model.selectedDropBox() 
                        &amp;&amp; _p._model.selectedDropBox().removeClass( Drag.Model.CLASS_CURRENT )
                        ;
                }
            }
    });
    /**
     * 判断两个矩形是否有交集
     */
    function intersectRect( r1, r2 ) {
        return !(
                    r2.left &gt; r1.right || 
                    r2.right &lt; r1.left || 
                    r2.top &gt; r1.bottom ||
                    r2.bottom &lt; r1.top
                );
    }
    /**
     * 把坐标和宽高生成一个 rectangle 数据
     */
    function locationToRect( _x, _y, _width, _height ){
        var _offset, _r = {
            &#x27;left&#x27;: _x
            , &#x27;top&#x27;: _y
            , &#x27;right&#x27;: _x + _width
            , &#x27;bottom&#x27;: _y + _height 
        };
        return _r;
    }
    /**
     * 把 rectangle 数据 转换为 坐标数据
     */
    function rectToPoint( _rect ){
        var _r = {
            &#x27;x&#x27;: _rect.left + ( _rect.right - _rect.left ) / 2
            , &#x27;y&#x27;: _rect.top + ( _rect.bottom - _rect.top ) / 2
        };
        return _r;
    }
    /**
     * 计算两个坐标点之间的距离
     */
    function pointDistance( _p1, _p2 ){
        var _dx = _p2.x - _p1.x
            , _dy = _p2.y - _p1.y
            , _dist = Math.sqrt( _dx * _dx + _dy * _dy );
            ;
        return _dist;
    }
    /**
     * 实例初始化后触发的事件
     * @event JCDragInited
     */
    /**
     * 拖动开始前触发的事件
     * @event JCDragBefore
     */
    /**
     * 拖动开始时触发的事件
     * @event JCDragBegin
     */
    /**
     * 拖动完成时触发的事件
     * @event JCDragDone
     */
    /**
     * 拖动完成之后触发的事件
     * @event JCDragAfter
     */
    /**
     * 拖动移动时触发的事件
     * @event JCDraggingMoving
     */
    /**
     * 拖放完成时触发的事件
     * @event JCDropDone
     */
    /**
     * 拖放完成后触发的事件
     * @event JCDropDoneAfter
     */
    /**
     * 手动触发拖动事件
     * @event JCTriggerDrag
     */
    /*
    $(document).ready( function(){
        var _insAr = 0;
        Drag.autoInit
            &amp;&amp; ( _insAr = Drag.init() )
            ;
    });
    */

    _jdoc.delegate( &#x27;div.js_compDrag, button.js_compDrag&#x27;, &#x27;mouseenter&#x27;, function( _evt ){
        var _p = $( this ), _ins = JC.BaseMVC.getInstance( $(this), JC.Drag );
        if( _p.is( &#x27;[&#x27; + Drag.Model.IGNORE_DRAG + &#x27;]&#x27; ) ) return
        !_ins &amp;&amp; ( _ins = new JC.Drag( _p ) ) &amp;&amp; JC.BaseMVC.getInstance( _p, JC.Drag, _ins );
    });

    _jdoc.delegate( &#x27;div.js_compDrag, button.js_compDrag&#x27;, &#x27;mousedown&#x27;, function( _evt ){
        var _p = $( this ), _ins = JC.BaseMVC.getInstance( _p, Drag );
        if( _p.is( &#x27;[&#x27; + Drag.Model.IGNORE_DRAG + &#x27;]&#x27; ) ) return
        !_ins &amp;&amp; ( _ins = new Drag( _p ) ) &amp;&amp; _ins.trigger( Drag.Model.TRIGGER_DRAG, [ _evt ] );
        return false;
    });

    _jwin.on( &#x27;resize&#x27;, function( _evt ){
        Drag.cleanDragData();
    });

    return JC.Drag;
});}( typeof define === &#x27;function&#x27; &amp;&amp; define.amd ? define : 
        function ( _name, _require, _cb ) { 
            typeof _name == &#x27;function&#x27; &amp;&amp; ( _cb = _name );
            typeof _require == &#x27;function&#x27; &amp;&amp; ( _cb = _require ); 
            _cb &amp;&amp; _cb(); 
        }
        , window
    )
);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
