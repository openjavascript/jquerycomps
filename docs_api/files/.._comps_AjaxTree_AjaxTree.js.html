<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../comps/AjaxTree/AjaxTree.js - jquery components</title>
    <link rel="stylesheet" href="../assets/css/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/widget.css">
    <link rel="stylesheet" href="../assets/css/tabview.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="../assets/js/yui-min.js"></script>
    <script src="../assets/js/comps1.js"></script>
    <script src="../assets/js/comps2.js"></script>
    <script src="../assets/js/comps3.js"></script>
    <script src="../assets/js/comps4.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../jc_logo.png" title="jquery components"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/.Bizs.html">.Bizs</a></li>
            
                <li><a href="../classes/.JC.html">.JC</a></li>
            
                <li><a href="../classes/JC.AjaxTree.html">JC.AjaxTree</a></li>
            
                <li><a href="../classes/JC.AjaxUpload.html">JC.AjaxUpload</a></li>
            
                <li><a href="../classes/JC.alert.html">JC.alert</a></li>
            
                <li><a href="../classes/JC.AutoChecked.html">JC.AutoChecked</a></li>
            
                <li><a href="../classes/JC.AutoComplete.html">JC.AutoComplete</a></li>
            
                <li><a href="../classes/JC.AutoSelect.html">JC.AutoSelect</a></li>
            
                <li><a href="../classes/JC.BaseMVC.html">JC.BaseMVC</a></li>
            
                <li><a href="../classes/JC.BaseMVC.Model.html">JC.BaseMVC.Model</a></li>
            
                <li><a href="../classes/JC.Calendar.html">JC.Calendar</a></li>
            
                <li><a href="../classes/JC.common.html">JC.common</a></li>
            
                <li><a href="../classes/JC.confirm.html">JC.confirm</a></li>
            
                <li><a href="../classes/JC.DCalendar.html">JC.DCalendar</a></li>
            
                <li><a href="../classes/JC.Dialog.html">JC.Dialog</a></li>
            
                <li><a href="../classes/JC.Dialog.alert.html">JC.Dialog.alert</a></li>
            
                <li><a href="../classes/JC.Dialog.confirm.html">JC.Dialog.confirm</a></li>
            
                <li><a href="../classes/JC.Dialog.mask.html">JC.Dialog.mask</a></li>
            
                <li><a href="../classes/JC.Dialog.msgbox.html">JC.Dialog.msgbox</a></li>
            
                <li><a href="../classes/JC.Drag.html">JC.Drag</a></li>
            
                <li><a href="../classes/JC.DragSelect.html">JC.DragSelect</a></li>
            
                <li><a href="../classes/JC.f.html">JC.f</a></li>
            
                <li><a href="../classes/JC.FChart.html">JC.FChart</a></li>
            
                <li><a href="../classes/JC.Fixed.html">JC.Fixed</a></li>
            
                <li><a href="../classes/JC.FlowChart.html">JC.FlowChart</a></li>
            
                <li><a href="../classes/JC.Form.html">JC.Form</a></li>
            
                <li><a href="../classes/JC.FormFillUrl.html">JC.FormFillUrl</a></li>
            
                <li><a href="../classes/JC.FrameUtil.html">JC.FrameUtil</a></li>
            
                <li><a href="../classes/JC.hideAllPanel.html">JC.hideAllPanel</a></li>
            
                <li><a href="../classes/JC.hideAllPopup.html">JC.hideAllPopup</a></li>
            
                <li><a href="../classes/JC.ImageCutter.html">JC.ImageCutter</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.html">JC.LunarCalendar</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.Model.html">JC.LunarCalendar.Model</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.View.html">JC.LunarCalendar.View</a></li>
            
                <li><a href="../classes/JC.msgbox.html">JC.msgbox</a></li>
            
                <li><a href="../classes/JC.NumericStepper.html">JC.NumericStepper</a></li>
            
                <li><a href="../classes/JC.Paginator.html">JC.Paginator</a></li>
            
                <li><a href="../classes/JC.Panel.html">JC.Panel</a></li>
            
                <li><a href="../classes/JC.Panel.Model.html">JC.Panel.Model</a></li>
            
                <li><a href="../classes/JC.Panel.View.html">JC.Panel.View</a></li>
            
                <li><a href="../classes/JC.Placeholder.html">JC.Placeholder</a></li>
            
                <li><a href="../classes/JC.PopTips.html">JC.PopTips</a></li>
            
                <li><a href="../classes/JC.ServerSort.html">JC.ServerSort</a></li>
            
                <li><a href="../classes/JC.Slider.html">JC.Slider</a></li>
            
                <li><a href="../classes/JC.Slider.Model.html">JC.Slider.Model</a></li>
            
                <li><a href="../classes/JC.StepControl.html">JC.StepControl</a></li>
            
                <li><a href="../classes/JC.Suggest.html">JC.Suggest</a></li>
            
                <li><a href="../classes/JC.Tab.html">JC.Tab</a></li>
            
                <li><a href="../classes/JC.TableFreeze.html">JC.TableFreeze</a></li>
            
                <li><a href="../classes/JC.Tips.html">JC.Tips</a></li>
            
                <li><a href="../classes/JC.Tips.Model.html">JC.Tips.Model</a></li>
            
                <li><a href="../classes/JC.Tips.View.html">JC.Tips.View</a></li>
            
                <li><a href="../classes/JC.Tree.html">JC.Tree</a></li>
            
                <li><a href="../classes/JC.Tree.Model.html">JC.Tree.Model</a></li>
            
                <li><a href="../classes/JC.Valid.html">JC.Valid</a></li>
            
                <li><a href="../classes/window.Bizs.ActionLogic.html">window.Bizs.ActionLogic</a></li>
            
                <li><a href="../classes/window.Bizs.AutoSelectComplete.html">window.Bizs.AutoSelectComplete</a></li>
            
                <li><a href="../classes/window.Bizs.ChangeLogic.html">window.Bizs.ChangeLogic</a></li>
            
                <li><a href="../classes/window.Bizs.CommonModify.html">window.Bizs.CommonModify</a></li>
            
                <li><a href="../classes/window.Bizs.CustomColumn.html">window.Bizs.CustomColumn</a></li>
            
                <li><a href="../classes/window.Bizs.DisableLogic.html">window.Bizs.DisableLogic</a></li>
            
                <li><a href="../classes/window.Bizs.DMultiDate.html">window.Bizs.DMultiDate</a></li>
            
                <li><a href="../classes/window.Bizs.DropdownTree.html">window.Bizs.DropdownTree</a></li>
            
                <li><a href="../classes/window.Bizs.FormLogic.html">window.Bizs.FormLogic</a></li>
            
                <li><a href="../classes/window.Bizs.InputSelect.html">window.Bizs.InputSelect</a></li>
            
                <li><a href="../classes/window.Bizs.KillISPCache.html">window.Bizs.KillISPCache</a></li>
            
                <li><a href="../classes/window.Bizs.MoneyTips.html">window.Bizs.MoneyTips</a></li>
            
                <li><a href="../classes/window.Bizs.MultiAutoComplete.html">window.Bizs.MultiAutoComplete</a></li>
            
                <li><a href="../classes/window.Bizs.MultiDate.html">window.Bizs.MultiDate</a></li>
            
                <li><a href="../classes/window.Bizs.MultiSelect.html">window.Bizs.MultiSelect</a></li>
            
                <li><a href="../classes/window.Bizs.MultiselectPanel.html">window.Bizs.MultiselectPanel</a></li>
            
                <li><a href="../classes/window.Bizs.MultiSelectTree.html">window.Bizs.MultiSelectTree</a></li>
            
                <li><a href="../classes/window.Bizs.MultiUpload.html">window.Bizs.MultiUpload</a></li>
            
                <li><a href="../classes/window.Bizs.TaskViewer.html">window.Bizs.TaskViewer</a></li>
            
                <li><a href="../classes/window.jQuery.html">window.jQuery</a></li>
            
                <li><a href="../classes/window.jQuery.mousewheel.html">window.jQuery.mousewheel</a></li>
            
                <li><a href="../classes/window.JSON.html">window.JSON</a></li>
            
                <li><a href="../classes/window.Raphael.html">window.Raphael</a></li>
            
                <li><a href="../classes/window.swfobject.html">window.swfobject</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ../comps/AjaxTree/AjaxTree.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
;(function(define, _win) { &#x27;use strict&#x27;; define( [ &#x27;JC.BaseMVC&#x27;, &#x27;plugins.json2&#x27; ], function(){
    JC.use 
        &amp;&amp; !window.JSON 
        &amp;&amp; JC.use( &#x27;plugins.json2&#x27; )
        ;
    JC.AjaxTree = AjaxTree;
    /**
     * AJAX 树菜单类 JC.AjaxTree
     * &lt;p&gt;&lt;b&gt;require&lt;/b&gt;: 
     *      &lt;a href=&#x27;JC.BaseMVC.html&#x27;&gt;JC.BaseMVC&lt;/a&gt;
     *      , &lt;b&gt;JSON2&lt;/b&gt;
     * &lt;/p&gt;
     * &lt;p&gt;&lt;a href=&#x27;https://github.com/openjavascript/jquerycomps&#x27; target=&#x27;_blank&#x27;&gt;JC Project Site&lt;/a&gt;
     * | &lt;a href=&#x27;http://jc.openjavascript.org/docs_api/classes/JC.AjaxTree.html&#x27; target=&#x27;_blank&#x27;&gt;API docs&lt;/a&gt;
     * | &lt;a href=&#x27;../../comps/AjaxTree/_demo&#x27; target=&#x27;_blank&#x27;&gt;demo link&lt;/a&gt;&lt;/p&gt;
     *
     * &lt;h2&gt;页面只要引用本文件, 默认会自动初始化 div class=&quot;js_compAjaxTree&quot; 的树组件&lt;/h2&gt;
     *
     * &lt;h2&gt;可用的 html attribute&lt;/h2&gt;
     * &lt;dl&gt;
     *      &lt;dt&gt;data-defaultOpenRoot = bool, default = true&lt;/dt&gt;
     *      &lt;dd&gt;如果没有默认选中节点， 是否展开根节点&lt;/dd&gt;
     *
     *      &lt;dt&gt;data-cajScriptData = script selector&lt;/dt&gt;
     *      &lt;dd&gt;从脚本模板解释数据&lt;/dd&gt;
     *
     *      &lt;dt&gt;data-cajData = object name of window&lt;/dt&gt;
     *      &lt;dd&gt;从window变量获取数据&lt;/dd&gt;
     *
     *      &lt;dt&gt;data-cajUrl = url&lt;/dt&gt;
     *      &lt;dd&gt;从 url 加载数据&lt;/dd&gt;
     *
     *      &lt;dt&gt;data-rootId = node id, default = &#x27;&#x27;&lt;/dt&gt;
     *      &lt;dd&gt;指定根节点ID&lt;/dd&gt;
     *
     *      &lt;dt&gt;data-urlArgName = string, default = &#x27;tree_node&#x27;&lt;/dt&gt;
     *      &lt;dd&gt;书节点的URL参数名&lt;/dd&gt;
     *
     *      &lt;dt&gt;data-typeIndex = int, default = 0&lt;/dt&gt;
     *      &lt;dd&gt;数据节点中 节点类型 所在的索引位置&lt;/dd&gt;
     *
     *      &lt;dt&gt;data-idIndex = int, default = 1&lt;/dt&gt;
     *      &lt;dd&gt;数据节点中 节点id 所在的索引位置&lt;/dd&gt;
     *
     *      &lt;dt&gt;data-nameIndex = int, default = 2&lt;/dt&gt;
     *      &lt;dd&gt;数据节点中 节点name 所在的索引位置&lt;/dd&gt;
     * &lt;/dl&gt;
     *
     * @namespace       JC
     * @class           AjaxTree
     * @extends         JC.BaseMVC
     * @constructor
     * @param   {selector}          _selector   树要显示的选择器
     * @version dev 0.1 2014-11-13, qiushaowei &lt;suches@btbtd.org&gt;, pjk &lt;pengjunkai@360.cn&gt; | 75 Team
     *
     * @example
     *
           &lt;div class=&quot;js_compAjaxTree js_tree2&quot; data-cajData=&quot;TREE_2&quot; data-urlArgName=&quot;node&quot;&gt;
            &lt;script&gt;
                window.TREE_2 = {
                    root: [ &#x27;folder&#x27;, &quot;23&quot;,&#x27;客户发展部&#x27;]
                    , data: 
                        {
                            &quot;24&quot;:
                            [
                                [
                                    &#x27;file&#x27;,
                                    &quot;25&quot;, 
                                    &quot;二组一队&quot;
                                ], 
                                [
                                    &#x27;file&#x27;,
                                    &quot;26&quot;, 
                                    &quot;二组二队&quot;
                                ], 
                                [
                                    &#x27;file&#x27;,
                                    &quot;27&quot;, 
                                    &quot;二组三队&quot;
                                ]
                            ], 
                            &quot;23&quot;:
                            [
                                [
                                    &#x27;file&#x27;,
                                    &quot;28&quot;, 
                                    &quot;销售二组&quot;
                                ], 
                                [
                                    &#x27;folder&#x27;, 
                                    &quot;24&quot;, 
                                    &quot;售前审核组&quot;
                                ]
                            ]
                        }
                };           

                $( document ).delegate( &#x27;div.js_tree2&#x27;, &#x27;renderItem&#x27;, function( _evt, _item, _data ){
                    _item.html( JC.f.printf( &#x27;&lt;a href=&quot;?node={0}&quot; data-id=&quot;{0}&quot;&gt;{1}&lt;/a&gt;&#x27;, _data[1], _data[2] ) );
                });

            &lt;/script&gt;
        &lt;/div&gt;
     */
    function AjaxTree( _selector ){

        _selector &amp;&amp; ( _selector = $( _selector ) );

        if( JC.BaseMVC.getInstance( _selector, AjaxTree ) ) 
            return JC.BaseMVC.getInstance( _selector, AjaxTree );

        JC.BaseMVC.getInstance( _selector, AjaxTree, this );

        this._model = new AjaxTree.Model( _selector );
        this._view = new AjaxTree.View( this._model );

        this._init();
    }
    /**
     * 初始化可识别的 AjaxTree 实例
     * @method  init
     * @param   {selector}      _selector
     * @static
     * @return  {Array of AjaxTreeInstance}
     */
    AjaxTree.init =
        function( _selector ){
            var _r = [];
            _selector = $( _selector || document );

            if( _selector.length ){
                if( _selector.hasClass( &#x27;js_compAjaxTree&#x27; )  ){
                    _r.push( new AjaxTree( _selector ) );
                }else{
                    _selector.find( &#x27;div.js_compAjaxTree&#x27; ).each( function(){
                        _r.push( new AjaxTree( this ) );
                    });
                }
            }
            return _r;
        };

    JC.BaseMVC.build( AjaxTree );
    /**
     * 树的数据过滤函数
     * &lt;br /&gt; 如果树的初始数据格式不符合要求, 可通过该属性定义函数进行数据修正
     * @property    dataFilter
     * @type        function
     * @default     undefined
     * @static
     * @example
            JC.AjaxTree.dataFilter =
            function( _data ){
                var _r = {};

                if( _data ){
                    if( _data.root.length &gt; 2 ){
                        _data.root.shift();
                        _r.root = _data.root;
                     }
                    _r.data = {};
                    for( var k in _data.data ){
                        _r.data[ k ] = [];
                        for( var i = 0, j = _data.data[k].length; i &lt; j; i++ ){
                            if( _data.data[k][i].length &lt; 3 ) continue;
                            _data.data[k][i].shift();
                            _r.data[k].push( _data.data[k][i] );
                        }
                    }
                }
                return _r;
            };
     */
    AjaxTree.dataFilter;
    
    JC.f.extendObject( AjaxTree.prototype, {
        _beforeInit:
            function(){
            }

        , _initHanlderEvent:
            function(){
                var _p = this, _data;

                _p.on( &#x27;inited&#x27;, function(){
                    _data = _p._model.parseInitData();

                    if( !_data &amp;&amp; _p._model.url() ){
                        _data = { url: _p._model.url() };
                    }

                    if( _data ){
                        _data.data = _data.data || {};

                        _p._model.data( _data );
                        if( _data.root ){
                            _p.trigger( &#x27;update_init_data&#x27;, [ _data ] );
                        }else if( _data.url ){
                            _p._model.ajaxData( _p._model.rootId(), function( _sdata ){
                                if( _sdata &amp;&amp; _sdata.data &amp;&amp; _sdata.data[0] &amp;&amp; _sdata.data[0].length ){
                                    _data.root = _sdata.data[0];
                                    _p.trigger( &#x27;update_init_data&#x27;, [ _data ] );
                                }
                            });
                        }
                    }
                });

                _p.on( &#x27;update_init_data&#x27;, function( _evt, _data ){
                    if( !_data ) return;
                    _p._model.data( _data );
                    if( !( _p._model.data() &amp;&amp; _p._model.root() ) ) return;

                    _p._view._process( _p._model.child( _p._model.root()[ _p._model.idIndex() ] ), _p._view._initRoot() );

                    _p.trigger( &#x27;AT_OPEN_FOLDER&#x27; );
                });

                _p.on( &#x27;AT_OPEN_FOLDER&#x27;, function(){
                    var _arg = ( JC.f.getUrlParam( _p._model.urlArgName() ) || &#x27;&#x27; ).trim()
                        , _list
                        ;
                    if( !_arg ) {
                        if( _p._model.defaultOpenRoot() &amp;&amp; _p._model.root() ){
                            _p.open( _p._model.root()[ _p._model.idIndex ] );
                        };
                        return;
                    }
                    _list = _p.triggerHandler( &#x27;AT_PROCESS_ID&#x27;, [ _arg ] );
                    if( !_list.length ) return;

                    _p.trigger( &#x27;AT_OPEN_ALL_FOLDER&#x27;, [ _list, 0 ] );
                });

                _p.on( &#x27;AT_OPEN_ALL_FOLDER&#x27;, function( _evt, _list, _ix ){
                    if( _ix &gt;= _list.length ) {
                        _p.openUI( _list.last() );
                        return;
                    }
                    var _id = _list[ _ix ]
                        , _node = _p.selector().find( JC.f.printf( &#x27;div.node_ctn[data-id={0}]&#x27;, _id ) )
                        , _nodeUl
                        ;
                    if( !( _node &amp;&amp; _node.length ) ) return;
                    _p._view.openFolder( _id, function(){
                        _p.trigger( &#x27;AT_OPEN_ALL_FOLDER&#x27;, [ _list, ++_ix ] );
                    });
                });

                _p.on( &#x27;AT_PROCESS_ID&#x27;, function( _evt, _ids ){
                    var _r = [];
                    typeof _ids != &#x27;string&#x27; &amp;&amp; ( _ids = _ids.toString() );
                    _ids = (_ids || &#x27;&#x27; ).replace( /[\s]+/g, &#x27;&#x27; );
                    _ids &amp;&amp; ( _r = _ids.split( &#x27;,&#x27; ) );
                    return _r;
                });

            }

        , _inited:
            function(){
                this.trigger( &#x27;inited&#x27; );
            }
        /**
         * 展开树到某个具体节点, 或者展开树的所有节点
         * @method  open
         * @param   {string|int}    _nodeId     如果_nodeId=&#x27;undefined&#x27;, 将会展开树的所有节点
         *                                      &lt;br /&gt;_nodeId 不为空, 将展开树到 _nodeId 所在的节点
         */
        , open:
            function( _nodeId ){
                var _p = this;
                if( typeof _nodeId == &#x27;undefined&#x27; ){
                    _p._view.openAll();
                    return _p;
                }
                var _list = _p.triggerHandler( &#x27;AT_PROCESS_ID&#x27;, [ _nodeId ] );
                if( _list.length ){
                    _p.trigger( &#x27;AT_OPEN_ALL_FOLDER&#x27;, [ _list, 0 ] );
                }
                return _p;
            }
        /**
         * 展开树到某个具体节点, 或者展开树的所有节点
         * @method  openUI
         * @param   {string|int}    _nodeId     如果_nodeId=&#x27;undefined&#x27;, 将会展开树的所有节点
         *                                      &lt;br /&gt;_nodeId 不为空, 将展开树到 _nodeId 所在的节点
         */
        , openUI:
            function( _nodeId ){
                if( typeof _nodeId == &#x27;undefined&#x27; ){
                    this._view.openAll();
                    return this;
                }
                this._view.openUI( _nodeId );
                return this;
            }

        /**
         * 关闭某个节点, 或者关闭整个树
         * @method  close
         * @param   {string|int}    _nodeId     如果_nodeId=&#x27;undefined&#x27;, 将会关闭树的所有节点
         *                                      &lt;br /&gt;_nodeId 不为空, 将关闭树 _nodeId 所在的节点
         */
        , close:
            function( _nodeId ){
                if( typeof _nodeId == &#x27;undefined&#x27; ){
                    this._view.closeAll();
                    return this;
                }
                this._view.close( _nodeId );
                return this;
            }
        /**
         * 获取树的 ID 前缀
         * &lt;br /&gt;每个树都会有自己的随机ID前缀
         * @method  idPrefix
         * @return  {string}    树的ID前缀
         */
        , idPrefix: function(){ return this._model.idPrefix(); }
        /**
         * 获取树的节点 label
         * @method  getItem
         * @param   {string|int}    _nodeId     
         */
        , getItem:
            function( _nodeId ){
                var _r;
                _nodeId &amp;&amp; ( _r = $(&#x27;#&#x27; + this._model.id( _nodeId ) ) );
                return _r;
            }
        /**
         * 获取或设置树的高亮节点
         * @method  selectedItem
         * @param   {selector}  _selector
         * @return  selector
         */
        , selectedItem:
            function( _selector ){
                return this._view.selectedItem( _selector );
            }
        , highlight:
            function(){
                return this.selectedItem.apply( this, JC.f.sliceArgs( arguments ) );
            }
        
    });

    AjaxTree.Model._instanceName = &#x27;JCAjaxTreeIns&#x27;;

    AjaxTree.Model._insCount = 1;
    
    JC.f.extendObject( AjaxTree.Model.prototype, {
        init:
            function(){
                /**
                 * 展现树需要的数据
                 * @type    object
                 */
                this._data
                /**
                 * 树的随机ID前缀
                 * @type    string
                 */
                this._id = JC.f.printf( &#x27;tree_{0}_{1}_&#x27;, new Date().getTime(), AjaxTree.Model._insCount++ );
                /**
                 * 树当前的高亮节点
                 * @type    selector
                 */
                this._highlight;
                /**
                 * 保存树的所有绑定事件
                 * @type    object
                 */
                this._events = {};

            }
        , parseInitData:
            function(){
                var _p = this, _data;
                if( _p.is( &#x27;[data-cajScriptData]&#x27; ) ){
                    _data = _p.scriptDataProp( &#x27;data-cajScriptData&#x27; );
                }else if( _p.is( &#x27;[data-cajData]&#x27; ) ){
                    _data = _p.windowProp( &#x27;data-cajData&#x27; );
                    _data &amp;&amp; ( _data = $.parseJSON( JSON.stringify( _data ) ) );
                }
                _data &amp;&amp; ( _data.data = _data.data || {} );
                return _data;
            }
        , idIndex:
            function(){
                if( typeof this._idIndex == &#x27;undefined&#x27; ){
                    this._idIndex = this.attrProp( &#x27;data-idIndex&#x27; ) || 1;
                }
                return this._idIndex;
            }
        , nameIndex:
            function(){
                if( typeof this._nameIndex == &#x27;undefined&#x27; ){
                    this._nameIndex = this.attrProp( &#x27;data-nameIndex&#x27; ) || 2;
                }
                return this._nameIndex;
            }
        , typeIndex:
            function(){
                if( typeof this._typeIndex == &#x27;undefined&#x27; ){
                    this._typeIndex = this.attrProp( &#x27;data-typeIndex&#x27; ) || 0;
                }
                return this._typeIndex;
            }
        /**
         * 获取树所要展示的容器
         * @return  selector
         */
        , selector: function(){ return this._selector; }
        /**
         * 获取节点将要显示的ID
         * @param   {string}    _id 节点的原始ID
         * @return  string  节点的最终ID
         */
        , id: function( _id ){ return this._id + _id; }
        /**
         *  获取树的随机ID前缀
         *  @return string
         */
        , idPrefix: function(){ return this._id; }
        /**
         * 获取树的原始数据
         * @return  object
         */
        , data: 
            function( _setter ){ 
                if( typeof _setter != &#x27;undefined&#x27; ){
                    this._data = _setter;
                    AjaxTree.dataFilter &amp;&amp; ( this._data = AjaxTree.dataFilter( this._data ) );
                }
                return this._data; 
            }
        /**
         * 获取树生成后的根节点
         * @return  selector
         */
        , root: function(){ return this._data.root; }
        /**
         * 获取ID的具体节点
         * @param   {string}    _id
         * @return  selector
         */
        , child: function( _id ){ 
            var _r = this._data.data[ _id ]; 
            !( _r &amp;&amp; _r.length ) &amp;&amp; ( _r = [] );
            return _r;
        }
        /**
         * 判断原始数据的某个ID是否有子级节点
         * @param   {string}    _id
         * @return  bool
         */
        , hasChild: function( _id ){ return _id in this._data.data; }
        /**
         * 获取或设置树的高亮节点
         * &lt;br /&gt;&lt;b&gt;注意:&lt;/b&gt; 这个只是数据层面的设置, 不会影响视觉效果
         * @param   {selector}  _item
         * @return  selector
         */
        , highlight:
            function( _highlight ){
                _highlight &amp;&amp; ( this._highlight = $( _highlight ) );
                return this._highlight;
            }

        , urlArgName:
            function(){
                var _r = this.attrProp( &#x27;data-urlArgName&#x27; ) || &#x27;tree_node&#x27;;
                return _r;
            }

        , getNodeById:
            function( _nodeId ){
                var target = null;
                if( _nodeId ){
                    target = $( &#x27;#&#x27; + this.id( _nodeId ) );
                }
                return target;
            }
        , defaultOpenRoot:
            function(){
                var _r = true;
                this.is( &#x27;[data-defaultOpenRoot]&#x27; ) &amp;&amp; ( _r = this.boolProp( &#x27;data-defaultOpenRoot&#x27; ) );
                return _r;
            }

        , ajaxData:
            function( _id, _cb ){
                _id = _id || &#x27;&#x27;;
                var _url = JC.f.printf( this.data().url, _id );
                $.ajax({
                    type: &quot;GET&quot;,
                    url: _url,
                    dataType: &quot;json&quot;,
                    success: function( _data ){
                        _cb &amp;&amp; _cb( _data );
                    }
                });
                return this;
            }

        , url:
            function(){
                return this.attrProp( &#x27;data-cajUrl&#x27; ) || &#x27;&#x27;;
            }

        , rootId:
            function(){
                return this.attrProp( &#x27;data-rootId&#x27; ) || &#x27;&#x27;;
            }
    });

    JC.f.extendObject( AjaxTree.View.prototype, {
        /**
         * 初始化树的可视状态
         */
        init:
            function() {

                return this;
            }
        /**
         * 处理树的展现效果
         * @param   {array}     _data   节点数据
         * @param   {selector}  _parentNode
         */
        , _process:
            function( _data, _parentNode ){
                var _p = this;
                if( !( _data &amp;&amp; _data.length ) ) return;
                for( var i = 0, j = _data.length, _item, _isLast; i &lt; j; i++ ){
                    _item = _data[ i ];
                    _isLast = i === j - 1;
                    
                    if( &#x27;folder&#x27; == _item[ _p._model.typeIndex() ] ){
                        this._initFolder( _parentNode, _item, _isLast );
                    }else{
                        this._initFile( _parentNode, _item, _isLast );
                    }
                }
            }
        /**
         * 初始化树根节点
         */
        , _initRoot:
            function(){
                var _p = this;

                if( !_p._model.data().root ) return;

                var _data, _parentNode, _label, _node, _span, _r;
                
                _data = _p._model.data().root;
                _parentNode = $( &#x27;&lt;ul class=&quot;ajtree_wrap&quot;&gt;&lt;/ul&gt;&#x27; );

                _label = this._initLabel( _data );


                if( !( _data[ _p._model.idIndex() ] in ( _p._model.data().data || {} ) ) ){
                    _node = $( &#x27;&lt;li class=&quot;folder_closed&quot;&gt;&lt;/li&gt;&#x27; );
                    _span = $( &#x27;&lt;span class=&quot;folder_img_root folderRoot folder_img_closed&quot;&gt;&amp;nbsp;&lt;/span&gt;&#x27; );
                }else{
                    _node = $( &#x27;&lt;li class=&quot;folder_open&quot;&gt;&lt;/li&gt;&#x27; );
                    _span = $( &#x27;&lt;span class=&quot;folder_img_root folderRoot folder_img_open&quot;&gt;&amp;nbsp;&lt;/span&gt;&#x27; );
                }

                //_node.html( &#x27;&lt;span class=&quot;folder_img_root folderRoot folder_img_open&quot;&gt;&amp;nbsp;&lt;/span&gt;&#x27; );
                _span.appendTo( _node );
                _label.appendTo( _node );

                _span.on( &#x27;click&#x27;, function( e ){
                    _p.folderClick( _data[ _p._model.idIndex() ] );
                });

                _node.appendTo( _parentNode );
                _parentNode.appendTo( _p._model.selector() );

                this.selector( _parentNode );

                _r =  $( &#x27;&lt;ul style=&quot;&quot; class=&quot;ajtree_wrap_inner&quot;&gt;&lt;/ul&gt;&#x27; )
                _r.appendTo( _node );

                return _r;
            }
        /**
         * 初始化树的文件夹节点
         * @param   {selector}  _parentNode
         * @param   {object}    _data
         * @param   {bool}      _isLast
         */
        , _initFolder:
            function( _parentNode, _data, _isLast ){

                var _p = this, _last = &#x27;&#x27;, _last1 = &#x27;&#x27;;
                    _isLast &amp;&amp; ( _last = &#x27;folder_span_lst &#x27;, _last1 = &#x27;folder_last&#x27; );

                var _label = this._initLabel( _data );

                var _node = $( JC.f.printf( &#x27;&lt;span class=&quot;folder_img_closed folder {1}&quot;&gt;&amp;nbsp;&lt;/span&gt;&#x27;, _data[ _p._model.nameIndex() ], _last ) );
                var _li = $(&#x27;&lt;li&gt;&lt;/li&gt;&#x27;);
                    _li.addClass( JC.f.printf( &#x27;folder_closed {0} folder&#x27;, _last1 ));
                    _node.appendTo( _li );
                    _label.appendTo( _li );

                var _r =  $( &#x27;&lt;ul style=&quot;display:none;&quot; class=&quot;folder_ul_lst&quot; &gt;&lt;/ul&gt;&#x27; );

                $( _node ).on( &#x27;click&#x27;, function( e ){
                    _p.folderClick( _data[ _p._model.idIndex() ] );
                });
                _r.appendTo( _li );

                _li.appendTo( _parentNode );
                this._process( this._model.child( _data[ _p._model.idIndex() ] ), _r );
            }
        /**
         * 初始化树的文件节点
         * @param   {selector}  _parentNode
         * @param   {object}    _data
         * @param   {bool}      _isLast
         */
        , _initFile:
            function( _parentNode, _data, _isLast ){
                var _p = this, _last = &#x27;folder_img_bottom &#x27;, _last1 = &#x27;&#x27;;
                    _isLast &amp;&amp; ( _last = &#x27;folder_img_last &#x27;, _last1 = &#x27;&#x27; );

                var _label = this._initLabel( _data );

                var _node = $( JC.f.printf( &#x27;&lt;li&gt;&lt;span class=&quot;{1}file&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;/li&gt;&#x27;, _data[ _p._model.nameIndex() ], _last ) );
                    _node.addClass( &#x27;folder_closed file&#x27;);
                    _label.appendTo( _node );

                    _node.appendTo( _parentNode );
            }
        /**
         * 初始化树的节点标签
         * @param   {object}    _data
         * @return  selector
         */
        , _initLabel:
            function( _data ){
                var _p = this, _label = $(&#x27;&lt;div class=&quot;node_ctn&quot;&gt;&lt;/div&gt;&#x27;);
                    _label.attr( &#x27;id&#x27;, this._model.id( _data[ _p._model.idIndex() ] ) )
                        .attr( &#x27;data-id&#x27;, _data[ _p._model.idIndex() ] )
                        .attr( &#x27;data-name&#x27;, _data[ _p._model.nameIndex() ] )
                        .attr( &#x27;data-type&#x27;, _data[ _p._model.typeIndex() ] || &#x27;&#x27; )
                        .data( &#x27;nodeData&#x27;, _data );

                _label.html( _data[ _p._model.nameIndex() ] || &#x27;没有标签&#x27; );
                _p.notification( &#x27;renderItem&#x27;, [ _label, _data ] );
                return _label;
            }
        /**
         * 展开树的所有节点
         */
        , openAll:
            function(){
                if( !this.selector() ) return;
                this.selector().find(&#x27;span.folder_img_closed&#x27;).each( function(){
                    $(this).trigger(&#x27;click&#x27;);
                });
            }
        /**
         * 关闭树的所有节点
         */
        , closeAll:
            function(){
                if( !this.selector() ) return;
                this.selector().find(&#x27;span.folder_img_open, span.folder_img_root&#x27;).each( function(){
                    if( $(this).hasClass( &#x27;folder_img_closed&#x27; ) ) return;
                    $(this).trigger(&#x27;click&#x27;);
                });
            }
        /**
         * 展开树到具体节点
         * @param   {string}    _nodeId
         */
        , openUI: 
            function( _nodeId ){
                var _p = this;
                var _tgr = _p._model.getNodeById( _nodeId );

                if( !_tgr.length ) return;

                var lis = _tgr.parents(&#x27;li&#x27;);
                this.selectedItem( _tgr );

                lis.each( function(){
                    var _sp = $(this), _child = _sp.find( &#x27;&gt; span.folderRoot, &gt; span.folder&#x27; );
                    if( _child.length ){
                        if( _child.hasClass( &#x27;folder_img_open&#x27; ) ) return;
                        _child.trigger( &#x27;click&#x27; );
                    }
                });
            }
        , selectedItem:
            function( _selector ){
                _selector &amp;&amp; ( _selector = $( _selector ) );
                if( !( _selector &amp;&amp; _selector.length ) ) return this._model.highlight();

                if( this._model.highlight() ) {
                    this._model.highlight().removeClass(&#x27;highlight&#x27;).removeClass( &#x27;selectedAjaxTreeNode&#x27; );
                }
                _selector.addClass( &#x27;highlight&#x27; ).addClass( &#x27;selectedAjaxTreeNode&#x27; );

                this._model.highlight( _selector );
                return _selector;
            }
        /**
         * 关闭树的具体节点
         * @param   {string}    _nodeId
         */
        , close:
            function( _nodeId ){
                var _p = this;
                var _tgr = _p._model.getNodeById( _nodeId );
                
                if( !_tgr.length ) return;

                var _child = _tgr.parent(&#x27;li&#x27;).find( &#x27;&gt; span.folderRoot, &gt; span.folder&#x27; );
                if( _child.length ){
                    if( _child.hasClass( &#x27;folder_img_closed&#x27; ) ) return;
                    _child.trigger( &#x27;click&#x27; );
                }
                
            }
        , nodeImgClick:
            function( _nodeId ){
                var _p = this, 
                    _node = _p._model.getNodeById( _nodeId ),
                    _nodeImg = _node.siblings(&#x27;span&#x27;),
                    _pntLi = _node.parent(&#x27;li&#x27;), 
                    _childUl = _pntLi.find( &#x27;&gt; ul&#x27;);
                var _treeselector = JC.f.getJqParent( _node, &#x27;div.js_compAjaxTree&#x27; )
                    , _treeIns = _treeselector.data( AjaxTree.Model._instanceName )
                    ;
                if( !_treeIns ) return;

                if( _nodeImg.hasClass( &#x27;folder_img_open&#x27; ) ){
                    _nodeImg.removeClass( &#x27;folder_img_open&#x27; ).addClass( &#x27;folder_img_closed&#x27; );
                    _childUl.hide();
                }else if( _nodeImg.hasClass( &#x27;folder_img_closed&#x27; ) ){
                    _nodeImg.addClass( &#x27;folder_img_open&#x27; ).removeClass( &#x27;folder_img_closed&#x27; );
                    _childUl.show();
                }

                if( _pntLi.hasClass(&#x27;folder_closed&#x27;) ){
                    _pntLi.addClass(&#x27;folder_open&#x27;).removeClass(&#x27;folder_closed&#x27;);
                }else if( _pntLi.hasClass(&#x27;folder_open&#x27;) ){
                    _pntLi.removeClass(&#x27;folder_open&#x27;).addClass(&#x27;folder_closed&#x27;);
                }
            }
        , folderClick:
            function( _nodeId ){

                var _p = this,
                    _model = _p._model,
                    _node = _model.getNodeById( _nodeId ),
                    _pntLi = _node.parent(&#x27;li&#x27;);
                if( _pntLi.hasClass( &#x27;folder_open&#x27; ) ){
                    _p.nodeImgClick( _nodeId );
                } else {
                    _p.openFolder( _nodeId );
                }
            }
        , openFolder:
            function( _nodeId, _callback ){
                var _p = this,
                    _model = _p._model,
                    _node = _model.getNodeById( _nodeId ),
                    _pntLi = _node.parent(&#x27;li&#x27;),
                    _nodeImg = _node.siblings(&#x27;span&#x27;),
                    _nodeUl = _node.siblings(&#x27;ul&#x27;),
                    _type = ( _node.attr( &#x27;data-type&#x27; ) || &#x27;file&#x27; )
                    ;

                if( _type == &#x27;file&#x27; ){
                    _callback &amp;&amp; _callback();
                    return;
                }
                
                if( _nodeUl.data( &#x27;inited&#x27; ) || _nodeUl.children(&#x27;li&#x27;).length &gt; 0 ){/* 已经初始化子节点 展开 */
                    _p.nodeImgClick( _nodeId );
                    _callback &amp;&amp; _callback();
                } else {/* 通过ajxa获取数据 */
                    _nodeImg.removeClass(&#x27;folder_img_closed&#x27;).addClass(&#x27;folder_img_loading&#x27;);
                    _nodeUl.data( &#x27;inited&#x27;, true );

                    if( !_model.data().url ){
                        return;
                    }
                    _p._model.ajaxData( _nodeId, function( _data ){
                        _pntLi.addClass(&#x27;folder_open&#x27;).removeClass(&#x27;folder_closed&#x27;);
                        _nodeImg.removeClass(&#x27;folder_img_loading&#x27;).addClass(&#x27;folder_img_open&#x27;);
                        _p._process( _data.data, _nodeUl.show() );
                        _callback &amp;&amp; _callback();
                    });
                }
            }
        , showDataLoading:
            function( _node ){
                _node.siblings(&#x27;span&#x27;).removeClass(&#x27;folder_img_closed&#x27;).addClass(&#x27;folder_img_loading&#x27;);
            }
    });
    /**
     * 树节点的点击事件
     * @event   click
     * @param   {event}     _evt
     * @example
            $( document ).delegate( &#x27;div.js_compAjaxTree&#x27;, &#x27;click&#x27;, function( _evt, _item, _data, _box ){
                JC.dir( _item[0], _data, _box[0] );
            });
     */
    /**
     * 树节点的change事件
     * @event   change
     * @param   {event}     _evt
     * @example
            $( document ).delegate( &#x27;div.js_compAjaxTree&#x27;, &#x27;change&#x27;, function( _evt, _item, _data, _box ){
                JC.dir( _item[0], _data, _box[0] );
            });
     */

    /**
     * 树节点的展现事件
     * @event   RenderLabel
     * @param   {array}     _data
     * @param   {selector}  _item
     * @example
            _tree.on(&#x27;RenderLabel&#x27;, function( _data ){
                var _node = $(this);
                _node.html( JC.f.printf( &#x27;&lt;a href=&quot;javascript:&quot; dataid=&quot;{0}&quot;&gt;{1}&lt;/a&gt;&#x27;, _data[0], _data[1] ) );
            });
     */

    /**
     * 树文件夹的点击事件
     * @event   FolderClick
     * @param   {event}     _evt
     * @example
            _tree.on(&#x27;FolderClick&#x27;, function( _evt ){
                var _p = $(this);
                alert( &#x27;folder click&#x27; );
            });
     */
    /**
     * 树的最后的 hover 节点
     * &lt;br /&gt;树的 hover 是全局属性, 页面上的所有树只会有一个当前 hover
     * @property    lastHover
     * @type    selector
     * @default null
     */
    AjaxTree.lastHover = null;

    JDOC.delegate( &#x27;.js_compAjaxTree ul.ajtree_wrap div.node_ctn&#x27;, &#x27;mouseenter&#x27;, function(){
        if( AjaxTree.lastHover ) AjaxTree.lastHover.removeClass(&#x27;ms_over&#x27;);
        $(this).addClass(&#x27;ms_over&#x27;);
        AjaxTree.lastHover = $(this);
    });
    JDOC.delegate( &#x27;.js_compAjaxTree ul.ajtree_wrap div.node_ctn&#x27;, &#x27;mouseleave&#x27;, function(){
        if( AjaxTree.lastHover ) AjaxTree.lastHover.removeClass(&#x27;ms_over&#x27;);
    });

    JDOC.delegate( &#x27;.js_compAjaxTree ul.ajtree_wrap div.node_ctn a[href]&#x27;, &#x27;click&#x27;, function( _evt ){
        var _p = $( this )
            , _href = ( _p.attr( &#x27;href&#x27; ) || &#x27;&#x27; ).trim().replace( /[\s]+/g, &#x27;&#x27; )
            , _idList
            , _node 
            , _treeBox, _treeIns
            , _args
            ;
        if( /^(javascript\:|#)/.test( _href ) ) return;

        _node = JC.f.getJqParent( _p, &#x27;div.node_ctn&#x27; );
        if( !( _node &amp;&amp; _node.length ) ) return;

        _treeBox = JC.f.getJqParent( _p, &#x27;.js_compAjaxTree&#x27; );
        if( !( _treeBox &amp;&amp; _treeBox.length ) ) return;

        _treeIns = JC.BaseMVC.getInstance( _treeBox, JC.AjaxTree );
        if( !_treeIns ) return;

        _idList = JWIN.triggerHandler( &#x27;AJAXTREE_GET_PARENT_LIST&#x27;, [ _node ] );
        _args = {};
        _args[ _treeIns._model.urlArgName() ] = _idList.join(&#x27;,&#x27;);
        _p.attr( &#x27;href&#x27;, JC.f.addUrlParams( _href, _args ) ); 
    });

    JWIN.on( &#x27;AJAXTREE_GET_PARENT_LIST&#x27;, function( _evt, _node, _list ){
        _list = _list || [];
        _node = $( _node );
        var _pntUl, _pntNode;

        _list.unshift( _node.attr( &#x27;data-id&#x27; ) );

        _pntUl = JC.f.getJqParent( _node, &#x27;ul&#x27; );
        if( _pntUl 
            &amp;&amp; _pntUl.length 
            &amp;&amp; ( _pntUl.is( &#x27;.folder_ul_lst&#x27; ) || _pntUl.is( &#x27;.ajtree_wrap_inner&#x27; ) ) 
        ){
            _pntNode = _pntUl.prev( &#x27;div.node_ctn&#x27; );
            if( _pntNode &amp;&amp; _pntNode.length ){
                JWIN.trigger( &#x27;AJAXTREE_GET_PARENT_LIST&#x27;, [ _pntNode, _list ] );
            }
        }

        return _list;
    });

    JDOC.delegate( &#x27;.js_compAjaxTree ul.ajtree_wrap div.node_ctn&#x27;, &#x27;click&#x27;, function( _evt ){
        var _p = $(this)
            , _treeselector = JC.f.getJqParent( _p, &#x27;.js_compAjaxTree&#x27; )
            , _treeIns = _treeselector.data( AjaxTree.Model._instanceName )
            , _nodeData, _tmpData
            , _isChange = true
            ;

        if( !_treeIns ) return;

        _treeIns.open( _p.attr( &#x27;data-id&#x27; ) );

        if( _treeselector.data( &#x27;AT_PRESELECTED_ID&#x27; ) == _p.attr( &#x27;data-id&#x27; ) ){
        }else{
            _treeselector.data( &#x27;AT_PRESELECTED_ID&#x27;, _p.attr( &#x27;data-id&#x27; ) );
            _treeselector.trigger( &#x27;change&#x27;, [ _p, _p.data( &#x27;nodeData&#x27; ), _treeselector ] );
        }
    });

    JDOC.ready( function(){
        JC.f.safeTimeout( function(){
            AjaxTree.autoInit &amp;&amp; AjaxTree.init();
        }, null, &#x27;JCAjaxTreeInit&#x27;, 1 );
    });

    return JC.AjaxTree;
});}( typeof define === &#x27;function&#x27; &amp;&amp; define.amd ? define : 
        function ( _name, _require, _cb) { 
            typeof _name == &#x27;function&#x27; &amp;&amp; ( _cb = _name );
            typeof _require == &#x27;function&#x27; &amp;&amp; ( _cb = _require ); 
            _cb &amp;&amp; _cb(); 
        }
        , window
    )
);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
