<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../comps/PopTips/PopTips.js - jquery components</title>
    <link rel="stylesheet" href="../assets/css/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/widget.css">
    <link rel="stylesheet" href="../assets/css/tabview.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="../assets/js/yui-min.js"></script>
    <script src="../assets/js/comps1.js"></script>
    <script src="../assets/js/comps2.js"></script>
    <script src="../assets/js/comps3.js"></script>
    <script src="../assets/js/comps4.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../jc_logo.png" title="jquery components"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/.Bizs.html">.Bizs</a></li>
            
                <li><a href="../classes/.JC.html">.JC</a></li>
            
                <li><a href="../classes/.jQuery.html">.jQuery</a></li>
            
                <li><a href="../classes/JC.AjaxUpload.html">JC.AjaxUpload</a></li>
            
                <li><a href="../classes/JC.alert.html">JC.alert</a></li>
            
                <li><a href="../classes/JC.AutoChecked.html">JC.AutoChecked</a></li>
            
                <li><a href="../classes/JC.AutoComplete.html">JC.AutoComplete</a></li>
            
                <li><a href="../classes/JC.AutoSelect.html">JC.AutoSelect</a></li>
            
                <li><a href="../classes/JC.BaseMVC.html">JC.BaseMVC</a></li>
            
                <li><a href="../classes/JC.BaseMVC.Model.html">JC.BaseMVC.Model</a></li>
            
                <li><a href="../classes/JC.Calendar.html">JC.Calendar</a></li>
            
                <li><a href="../classes/JC.common.html">JC.common</a></li>
            
                <li><a href="../classes/JC.confirm.html">JC.confirm</a></li>
            
                <li><a href="../classes/JC.DCalendar.html">JC.DCalendar</a></li>
            
                <li><a href="../classes/JC.Dialog.html">JC.Dialog</a></li>
            
                <li><a href="../classes/JC.Dialog.alert.html">JC.Dialog.alert</a></li>
            
                <li><a href="../classes/JC.Dialog.confirm.html">JC.Dialog.confirm</a></li>
            
                <li><a href="../classes/JC.Dialog.mask.html">JC.Dialog.mask</a></li>
            
                <li><a href="../classes/JC.Dialog.msgbox.html">JC.Dialog.msgbox</a></li>
            
                <li><a href="../classes/JC.Drag.html">JC.Drag</a></li>
            
                <li><a href="../classes/JC.DragSelect.html">JC.DragSelect</a></li>
            
                <li><a href="../classes/JC.f.html">JC.f</a></li>
            
                <li><a href="../classes/JC.Fixed.html">JC.Fixed</a></li>
            
                <li><a href="../classes/JC.FlowChart.html">JC.FlowChart</a></li>
            
                <li><a href="../classes/JC.Form.html">JC.Form</a></li>
            
                <li><a href="../classes/JC.FormFillUrl.html">JC.FormFillUrl</a></li>
            
                <li><a href="../classes/JC.FrameUtil.html">JC.FrameUtil</a></li>
            
                <li><a href="../classes/JC.hideAllPanel.html">JC.hideAllPanel</a></li>
            
                <li><a href="../classes/JC.hideAllPopup.html">JC.hideAllPopup</a></li>
            
                <li><a href="../classes/JC.ImageCutter.html">JC.ImageCutter</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.html">JC.LunarCalendar</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.Model.html">JC.LunarCalendar.Model</a></li>
            
                <li><a href="../classes/JC.LunarCalendar.View.html">JC.LunarCalendar.View</a></li>
            
                <li><a href="../classes/JC.msgbox.html">JC.msgbox</a></li>
            
                <li><a href="../classes/JC.NumericStepper.html">JC.NumericStepper</a></li>
            
                <li><a href="../classes/JC.Paginator.html">JC.Paginator</a></li>
            
                <li><a href="../classes/JC.Panel.html">JC.Panel</a></li>
            
                <li><a href="../classes/JC.Panel.Model.html">JC.Panel.Model</a></li>
            
                <li><a href="../classes/JC.Panel.View.html">JC.Panel.View</a></li>
            
                <li><a href="../classes/JC.Placeholder.html">JC.Placeholder</a></li>
            
                <li><a href="../classes/JC.PopTips.html">JC.PopTips</a></li>
            
                <li><a href="../classes/JC.ServerSort.html">JC.ServerSort</a></li>
            
                <li><a href="../classes/JC.Slider.html">JC.Slider</a></li>
            
                <li><a href="../classes/JC.Slider.Model.html">JC.Slider.Model</a></li>
            
                <li><a href="../classes/JC.StepControl.html">JC.StepControl</a></li>
            
                <li><a href="../classes/JC.Suggest.html">JC.Suggest</a></li>
            
                <li><a href="../classes/JC.Tab.html">JC.Tab</a></li>
            
                <li><a href="../classes/JC.Tab.Model.html">JC.Tab.Model</a></li>
            
                <li><a href="../classes/JC.Tab.View.html">JC.Tab.View</a></li>
            
                <li><a href="../classes/JC.TableFreeze.html">JC.TableFreeze</a></li>
            
                <li><a href="../classes/JC.Tips.html">JC.Tips</a></li>
            
                <li><a href="../classes/JC.Tips.Model.html">JC.Tips.Model</a></li>
            
                <li><a href="../classes/JC.Tips.View.html">JC.Tips.View</a></li>
            
                <li><a href="../classes/JC.Tree.html">JC.Tree</a></li>
            
                <li><a href="../classes/JC.Tree.Model.html">JC.Tree.Model</a></li>
            
                <li><a href="../classes/JC.Valid.html">JC.Valid</a></li>
            
                <li><a href="../classes/window.Bizs.ActionLogic.html">window.Bizs.ActionLogic</a></li>
            
                <li><a href="../classes/window.Bizs.AutoSelectComplete.html">window.Bizs.AutoSelectComplete</a></li>
            
                <li><a href="../classes/window.Bizs.ChangeLogic.html">window.Bizs.ChangeLogic</a></li>
            
                <li><a href="../classes/window.Bizs.CommonModify.html">window.Bizs.CommonModify</a></li>
            
                <li><a href="../classes/window.Bizs.DisableLogic.html">window.Bizs.DisableLogic</a></li>
            
                <li><a href="../classes/window.Bizs.DMultiDate.html">window.Bizs.DMultiDate</a></li>
            
                <li><a href="../classes/window.Bizs.DropdownTree.html">window.Bizs.DropdownTree</a></li>
            
                <li><a href="../classes/window.Bizs.FormLogic.html">window.Bizs.FormLogic</a></li>
            
                <li><a href="../classes/window.Bizs.KillISPCache.html">window.Bizs.KillISPCache</a></li>
            
                <li><a href="../classes/window.Bizs.MoneyTips.html">window.Bizs.MoneyTips</a></li>
            
                <li><a href="../classes/window.Bizs.MultiAutoComplete.html">window.Bizs.MultiAutoComplete</a></li>
            
                <li><a href="../classes/window.Bizs.MultiDate.html">window.Bizs.MultiDate</a></li>
            
                <li><a href="../classes/window.Bizs.MultiSelect.html">window.Bizs.MultiSelect</a></li>
            
                <li><a href="../classes/window.Bizs.MultiselectPanel.html">window.Bizs.MultiselectPanel</a></li>
            
                <li><a href="../classes/window.Bizs.MultiSelectTree.html">window.Bizs.MultiSelectTree</a></li>
            
                <li><a href="../classes/window.Bizs.MultiUpload.html">window.Bizs.MultiUpload</a></li>
            
                <li><a href="../classes/window.Bizs.TaskViewer.html">window.Bizs.TaskViewer</a></li>
            
                <li><a href="../classes/window.Raphael.html">window.Raphael</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ../comps/PopTips/PopTips.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
 ;(function(define, _win) { &#x27;use strict&#x27;; define( [ &#x27;JC.BaseMVC&#x27; ], function(){
/**
 * PopTips 带箭头的气泡提示框功能
 * &lt;p&gt;
 *      &lt;b&gt;require&lt;/b&gt;: 
 *          &lt;a href=&#x27;JC.BaseMVC.html&#x27;&gt;JC.BaseMVC&lt;/a&gt;
 * &lt;/p&gt;
 * &lt;p&gt;&lt;a href=&#x27;https://github.com/openjavascript/jquerycomps&#x27; target=&#x27;_blank&#x27;&gt;JC Project Site&lt;/a&gt;
 * | &lt;a href=&#x27;http://jc.openjavascript.org/docs_api/classes/JC.PopTips.html&#x27; target=&#x27;_blank&#x27;&gt;API docs&lt;/a&gt;
 * | &lt;a href=&#x27;../../comps/PopTips/_demo&#x27; target=&#x27;_blank&#x27;&gt;demo link&lt;/a&gt;&lt;/p&gt;
 *
 * &lt;h2&gt;页面只要引用本文件, 默认会自动初始化span|em|a|b为class=&quot;js_compPoptips&quot;的提示气泡&lt;/h2&gt;
 * &lt;p&gt;&lt;/p&gt;
 *
 *
 * &lt;h2&gt;可用的 HTML attribute&lt;/h2&gt;
 *
 * &lt;dl&gt;
 *    &lt;dt&gt;htmlContent&lt;/dt&gt;
 *    &lt;dd&gt;
 *       &lt;p&gt;声明气泡提示的内容支持脚本模板&lt;br&gt;
 *        如果有设置该属性那么会优先选用htmlContent提供的内容
 *       &lt;/p&gt;
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;ajaxContent&lt;/dt&gt;
 *    &lt;dd&gt;
 *       &lt;p&gt;声明气泡提示的ajax 模板&lt;/p&gt;
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;content = string &lt;/dt&gt;
 *    &lt;dd&gt;
 *       &lt;p&gt;声明气泡提示的内容，如果需要提示html内容那么用&lt;b&gt;htmlContent&lt;/b&gt;属性&lt;br&gt;
 *       如果没有设置则去查找title属性，如果title也没有设置，&lt;br/&gt;
         则将触发元素的text作为提示内容。&lt;/p&gt;
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;theme = yellow | blue | white | green, &lt;a href=&quot;../../modules/JC.PopTips/0.1/res/default/style.html&quot; target=&quot;_blank&quot;&gt;查看&lt;/a&gt; &lt;/dt&gt;
 *    &lt;dd&gt;
 *       气泡主题，提供黄色、蓝色、白色、绿色四种样式，默认为 yellow.
 *       &lt;p&gt;&lt;b&gt;yellow：&lt;/b&gt;黄色&lt;br/&gt;
 *       &lt;b&gt;blue：&lt;/b&gt;蓝色&lt;br/&gt;
 *       &lt;b&gt;white：&lt;/b&gt;白色&lt;br/&gt;
 *       &lt;b&gt;green：&lt;/b&gt;绿色&lt;/p&gt;
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;triggerType = hover | click&lt;/dt&gt;
 *    &lt;dd&gt;
 *        触发方式: 支持hover和click
 *        &lt;p&gt;默认为hover&lt;/p&gt;
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;arrowPosition = left | right | top | bottom&lt;/dt&gt;
 *    &lt;dd&gt;
 *        声明箭头的方向，默认值为left
 *        &lt;p&gt;&lt;b&gt;left:&lt;/b&gt;箭头向左（提示框在触发元素的右边）如果右边空间不够，提示框自动显示在左边，如果左边空间不够，提示框显示在上方，如果上方空间，提示框显示到下方&lt;br/&gt;
 *        &lt;b&gt;right:&lt;/b&gt;箭头向右（提示框在触发元素的左边）如果左边空间不够，提示框自动显示在右边，如果右边空间不够，提示框显示在上方，如果上方空间，提示框显示到下方&lt;br/&gt;
 *        &lt;b&gt;top:&lt;/b&gt;箭头向上（提示框在触发元素的下边）如果下边不够，提示框自动显示到上边&lt;br/&gt;
 *        &lt;b&gt;bottom:&lt;/b&gt;箭头向下（提示框在触发元素的上边）如果上边不够，提示框自动显示到下边&lt;/p&gt;    
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;arrowPositionOffset = left | right | top , &lt;a href=&quot;../../modules/JC.PopTips/0.1/res/default/style.html#pos&quot; target=&quot;_blank&quot;&gt;查看&lt;/a&gt;&lt;/dt&gt;
 *    &lt;dd&gt;
 *        声明箭头在提示框的位置，默认居中
 *        &lt;p&gt;如果arrowPosition = left | right, arrowPositionOffset可以设置为top&lt;/p&gt;
 *        &lt;p&gt;如果arrowPosition = top | bottom, arrowPositionOffset可以设置为left | right&lt;/p&gt;
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;offsetXY = num,num&lt;/dt&gt;
 *    &lt;dd&gt;
 *        声明提示框相对于当前位置的偏移位置(x 坐标，y 坐标)，默认值为0
 *        &lt;p&gt;x &lt; 0，往左偏移，x &gt; 0 往右偏移 &lt;br/&gt;
 *         y &lt; 0, 往上偏移，y &gt; 0 往下偏移 &lt;br/&gt;
 *         两个数值以&lt;b&gt;逗号&lt;/b&gt;分隔，如果只写一个值表示 y 坐标为0。&lt;/p&gt;
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;popTipsWidth = num&lt;/dt&gt;
 *    &lt;dd&gt;
 *        声明提示框的宽度，默认自适应
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;popTipsHeight = num&lt;/dt&gt;
 *    &lt;dd&gt;
 *        声明提示框的高度，默认自适应
 *    &lt;/dd&gt;
 * 
 *    &lt;dt&gt;popTipsMinWidth= num, default = auto&lt;/dt&gt;
 *    &lt;dd&gt;
 *        声明提示框的最小宽度，默认自适应
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;popTipsMinHeight = num, default = auto&lt;/dt&gt;
 *    &lt;dd&gt;
 *        声明提示框的最小高度，默认自适应
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;beforeShowCallback = function&lt;/dt&gt;
 *    &lt;dd&gt;
 *        气泡显示前, 触发的回调, &lt;b&gt;window 变量域&lt;/b&gt;
&lt;pre&gt;function beforeShowCallback( _selector ){
    var _ins = this;
    JC.log( &#x27;beforeShowCallback&#x27;, new Date().getTime() );
}&lt;/pre&gt;
 *    &lt;/dd&gt;
 *
 *    &lt;dt&gt;afterHideCallback = function&lt;/dt&gt;
 *    &lt;dd&gt;
 *        气泡隐藏后, 触发的回调, &lt;b&gt;window 变量域&lt;/b&gt;
&lt;pre&gt;function afterHideCallback( _selector ){
    var _ins = this;
    JC.log( &#x27;afterHideCallback&#x27;, new Date().getTime() );
}&lt;/pre&gt;
 *    &lt;/dd&gt;
 *&lt;/dl&gt; 
 *
 * @namespace JC
 * @class PopTips
 * @extends JC.BaseMVC
 * @constructor
 * @param   {selector|string}   _selector   
 * @version dev 0.2 2014-09-03
 * @version dev 0.1 2013-12-13
 * @author  zuojing   &lt;zuojing1013@gmail.com&gt;, qiushaowei &lt;qiushaowei@360.cn&gt; | 75 Team
 * @example
	&lt;span class=&quot;js_compPopTips&quot; style=&quot;margin-top:50px; margin-left:200px; display:inline-block;&quot;  
		content=&quot;1.这个tip显示在右边&lt;br&gt;2.古希腊学者亚里士多&lt;br&gt;3.古希腊学者亚里士多&lt;br&gt;4.古希腊学者亚里士多&quot;  
		theme=&quot;yellow&quot; 
		arrowposition=&quot;left&quot;
		triggerType=&quot;click&quot;
		&gt;
		&lt;span&gt;古希腊学者亚里士多德曾编&lt;br&gt;
			写过全面讲述当时学问的讲义，&lt;br&gt;
			被西方奉为“百科全书之父”，&lt;br&gt;
			中国汉朝初年的《尔雅》，&lt;br&gt;
			是中国百科全书性质著作的渊源。&lt;/span&gt;
	&lt;/span&gt;
  */
    JC.PopTips = PopTips;
 
    function PopTips( _selector ){
        _selector &amp;&amp; ( _selector = $( _selector ) );
        
        if( PopTips.getInstance( _selector ) ) return PopTips.getInstance( _selector );
        PopTips.getInstance( _selector, this );
        //JC.log( PopTips.Model._instanceName );
 
        this._model = new PopTips.Model( _selector );
        this._view = new PopTips.View( this._model );
 
        this._init();
 
        //JC.log( &#x27;PopTips:&#x27;, new Date().getTime() );
    }
    /**
     * 获取或设置 PopTips 的实例
     * @method  getInstance
     * @param   {selector}      _selector
     * @static
     * @return  {PopTipsInstance}
     */
    PopTips.getInstance = function ( _selector, _setter ) {
        if( typeof _selector == &#x27;string&#x27; &amp;&amp; !/&lt;/.test( _selector ) ) 
            _selector = $(_selector);
        if( !(_selector &amp;&amp; _selector.length ) || ( typeof _selector == &#x27;string&#x27; ) ) return;
        typeof _setter != &#x27;undefined&#x27; &amp;&amp; _selector.data( PopTips.Model._instanceName, _setter );

        return _selector.data( PopTips.Model._instanceName );
    };
    /**
     * 初始化可识别的 PopTips 实例
     * @method  init
     * @param   {selector}      _selector
     * @static
     * @return  {Array of PopTipsInstance}
     */
    PopTips.init = function ( _selector ) {
        var _r = [];
        
        _selector = $( _selector || document );

        if ( _selector.length ) {
            if ( _selector.hasClass(&#x27;js_compPopTips&#x27;) ) {
                _r.push( new PopTips(_selector) );
            } else {
                _selector.find(&#x27;span.js_compPopTips,a.js_compPopTips,b.js_compPopTips,em.js_compPopTips&#x27;).each( function() {
                    _r.push( new PopTips( this ) );
                });
            }
        }
        
        return _r;
    };

    PopTips.update = function () {
        var _items = $( JC.f.printf( &#x27;#{0}&gt;div&#x27;, PopTips.Model._boxId ) );

        if( !_items.length ) return;

        _items.each( function(){
            var _p = $(this), 
                _ins = _p.data( &#x27;CPopTipsIns&#x27; );

            if( !_ins ) return;

            if ( _ins._model.layout().is(&#x27;:visible&#x27;) &amp;&amp; _ins._model.layout().offset().left &gt;= -200 ) {
                _ins.update();
            }

        });
      
    },

    BaseMVC.build( PopTips );

    JC.f.extendObject( PopTips.prototype, {
        _beforeInit: function () {
            //JC.log( &#x27;PopTips _beforeInit&#x27;, new Date().getTime() );
        },

        _initHanlderEvent: function () {
            var _p = this;

            _p.on( &#x27;CPopTipsUpdate&#x27;, function( _evt ){
                _p._model.beforeShowCallback()
                    &amp;&amp; _p._model.beforeShowCallback().call( _p, _p.selector() );

            });

            var _timerIn = null,
                _timerOut = null,
                _tipsTimerIn = null,
                _tipsTimerOut = null;

            if ( _p._model.triggerType() == &#x27;hover&#x27; ) {
                 _p._model.selector()
                .on(&#x27;mouseenter&#x27;, function () {
                    clearTimeout( _tipsTimerIn );
                    clearTimeout( _tipsTimerOut );
                    clearTimeout( _timerIn );
                    clearTimeout( _timerOut );
                    _timerIn = setTimeout( function () {
                        _p._view.update();
                        _p._view.show();
                    }, 50);

                })
                .on(&#x27;mouseleave&#x27;, function () {
                    clearTimeout( _tipsTimerIn );
                    clearTimeout( _tipsTimerOut );
                    clearTimeout( _timerIn );
                    clearTimeout( _timerOut );
                    _timerOut = setTimeout( function () {
                         _p._view.hide();    
                    }, 200)
                });

                _p._model.layout()
                .on(&#x27;mouseenter&#x27;, function () {
                    clearTimeout( _tipsTimerIn );
                    clearTimeout( _tipsTimerOut );
                    clearTimeout( _timerIn );
                    clearTimeout( _timerOut );
                    _tipsTimerIn = setTimeout( function () {
                        _p._view.update();
                        _p._view.show();
                       
                    }, 50)
                })
                .on(&#x27;mouseleave&#x27;, function () {
                    clearTimeout( _tipsTimerIn );
                    clearTimeout( _tipsTimerOut );
                    clearTimeout( _timerIn );
                    clearTimeout( _timerOut );
                    _tipsTimerOut = setTimeout( function () {
                        _p._view.hide();
                    }, 200)
                });

            }

            _p.on( &#x27;update_layout&#x27;, function( _evt, _html ){
                var _json;
                try{
                    _json = $.parseJSON( _html );
                    if( _json &amp;&amp; &#x27;errorno&#x27; in _json &amp;&amp; !_json.errorno &amp;&amp; _json.data ){
                        _html = _json.data;
                    }
                }catch( _ex ){
                }
                _p._model.layout().find( &#x27;.js_cpt_ajax_ph&#x27; ).html( _html );
            });

            if ( _p._model.triggerType() == &#x27;click&#x27; ) {
                _p._model.selector().on(&#x27;click&#x27;, function ( _evt ) {
                    if ( _p._model.layout().is(&#x27;:visible&#x27;) &amp;&amp; _p._model.layout().offset().left &gt;= -200 ) {
                        _p._view.hide();
                    } else {
                        _p._view.update();
                        _p._view.show();
                    }
                });
            }

        }, 

        _inited: function () {
            //JC.log( &#x27;PopTips _inited&#x27;, new Date().getTime() );
           var _p = $(this);

           _p.trigger(&#x27;CPopTipsUpdate&#x27;);

        },

        /**
         * 更新 PopTips 状态
         * @method update
         */
        update: function () {

            this._view.update();

            return this;
        }

    });
 
    PopTips.Model._instanceName = &quot;PopTips&quot;;
    PopTips.Model._boxId = &#x27;CPTBox&#x27;;

    JC.f.extendObject( PopTips.Model.prototype, {
        init: function () {
            var _p = this;
        },

        baseTpl: &#x27;&lt;div class=&quot;CPT CPT_{0}&quot; style=&quot;position:absolute;display:none;&quot;&gt;&#x27;
            +   &#x27;&lt;div class=&quot;CPT_shadow&quot;&gt;&#x27;
            +       &#x27;&lt;div class=&quot;CPT_container&quot; style=&quot;min-width:{4}; min-height: {5}&quot;&gt;&#x27;
            +           &#x27;&lt;div class=&quot;CPT_arrow CPT_arrow_{1}&quot;&gt;&#x27;
            +               &#x27;&lt;em&gt;&lt;/em&gt;&#x27;
            +               &#x27;&lt;span&gt;&lt;/span&gt;&#x27;
            +           &#x27;&lt;/div&gt;&#x27;
            +           &#x27;&lt;div class=&quot;CPT_content&quot;  data-role=&quot;content&quot; {3}&gt;&#x27;
            +               &#x27;{2}&#x27;
            +           &#x27;&lt;/div&gt;&#x27;
            +       &#x27;&lt;/div&gt;&#x27;
            +   &#x27;&lt;/div&gt;&#x27;
            + &#x27;&lt;/div&gt;&#x27;,

        theme: function () {
            var _r = this.stringProp(&#x27;theme&#x27;);
            
            !_r &amp;&amp; ( _r = &#x27;yellow&#x27; );

            return _r;

        },

        contents: function () {
            var _r = this.attrProp(&#x27;content&#x27;) || this.attrProp(&#x27;title&#x27;);
            
            !_r &amp;&amp; ( _r = this.selector().text() );

            return _r;

        },

        htmlContents: function () {
            var _r,
                _s = JC.f.parentSelector( this.selector(), this.attrProp(&#x27;htmlContent&#x27;) );

            _r = JC.f.scriptContent( _s );

            return _r;
        },

        ajaxContent: function () {
            var _p = this;
            this.is( &#x27;[ajaxContent]&#x27; ) &amp;&amp;
                $.get( this.attrProp( &#x27;ajaxContent&#x27; ) ).done( 
                    function( _r ){
                        _p.trigger( &#x27;update_layout&#x27;, [ _r ] );
                    });
        },

        arrowPosition: function () {
            var _r = this.stringProp(&#x27;arrowPosition&#x27;);

            !_r &amp;&amp; ( _r = &#x27;left&#x27; );

            return _r;
        },

        arrowPositionOffset: function () {
            var _r = this.stringProp(&#x27;arrowPositionOffset&#x27;),
                _arrowPosition = this.arrowPosition();

            if ( _arrowPosition === &#x27;left&#x27; || _arrowPosition === &#x27;right&#x27; ) {
                if ( _r != &#x27;top&#x27; ) {
                    _r = &#x27;&#x27;;
                }
            }

            if ( _arrowPosition === &#x27;top&#x27; || _arrowPosition === &#x27;bottom&#x27; ) {
                if ( _r != &#x27;left&#x27; || _r != &#x27;right&#x27; ) {
                    _r = &#x27;&#x27;;
                }
            }

            return _r;
        },

        offsetXY: function () {
            var _r = this.attrProp(&#x27;offsetXY&#x27;).split(&#x27;,&#x27;),
                _x = parseInt( _r[0], 10 ) || 0,
                _y = parseInt( _r[1], 10 ) || 0;

            return {
                x: _x,
                y: _y
            };
        },

        triggerType: function () {
            var _r = this.stringProp(&#x27;triggerType&#x27;);

            !_r &amp;&amp; ( _r = &#x27;hover&#x27;);

            return _r;

        },

        layout: function () {
            var _p = this,
                _tpl = _p.baseTpl;
            
            if ( !this._layout ) {
                if ( _p.htmlContents() ) {
                    this._layout = $( JC.f.printf( _tpl
                        , _p.theme()
                        , _p.arrowPosition()
                        , _p.htmlContents()
                        , &#x27;style=&quot;width:&#x27; + _p.layoutWidth() + &#x27;;height:&#x27; + _p.layoutHeight() + &#x27;;&quot;&#x27; 
                        , _p.layoutMinWidth(), _p.layoutMinHeight()
                        ) )
                        .appendTo( this.layoutBox() );
                } else if ( this.is( &#x27;[ajaxContent]&#x27; ) ) {
                    this._layout = $( JC.f.printf( _tpl
                        , _p.theme()
                        , _p.arrowPosition()
                        , &#x27;&lt;div class=&quot;js_cpt_ajax_ph&quot;&gt;加载中...&lt;/div&gt;&#x27;
                        , &#x27;style=&quot;width:&#x27; + _p.layoutWidth() + &#x27;;height:&#x27; + _p.layoutHeight() + &#x27;;&quot;&#x27; 
                        , _p.layoutMinWidth(), _p.layoutMinHeight()
                        ) )
                        .appendTo( this.layoutBox() );
                    _p.ajaxContent();
                } else {
                    this._layout = $( JC.f.printf( _tpl
                        , _p.theme()
                        , _p.arrowPosition()
                        , _p.contents()
                        , &#x27;style=&quot;width:&#x27; + _p.layoutWidth() + &#x27;;height:&#x27; + _p.layoutHeight() + &#x27;;&quot;&#x27; 
                        , _p.layoutMinWidth(), _p.layoutMinHeight()
                        ) )
                        .appendTo( this.layoutBox() );
                }
                this._layout.css( { &#x27;left&#x27;: &#x27;-10000px&#x27; } ).show();
                
            }

            return this._layout;

        },

        layoutWidth: function () {
            var _r = this.intProp(&#x27;popTipsWidth&#x27;);

            _r &amp;&amp; ( _r = _r + &#x27;px&#x27; );
            !_r &amp;&amp; ( _r = &#x27;auto&#x27; );

            return _r;
        },

        layoutMinWidth: function () {
            var _r = this.intProp(&#x27;popTipsMinWidth&#x27;);
            _r &amp;&amp; ( _r = _r + &#x27;px&#x27; );
            !_r &amp;&amp; ( _r = &#x27;auto&#x27; );
            return _r;
        },

        layoutHeight: function () {
           var _r = this.intProp(&#x27;popTipsHeight&#x27;);

           _r &amp;&amp; ( _r = _r + &#x27;px&#x27; );
           !_r &amp;&amp; ( _r = &#x27;auto&#x27; );

           return _r;
        },

        layoutMinHeight: function () {
           var _r = this.intProp(&#x27;popTipsMinHeight&#x27;);
           _r &amp;&amp; ( _r = _r + &#x27;px&#x27; );
           !_r &amp;&amp; ( _r = &#x27;auto&#x27; );

           return _r;
        },


        layoutBox: function () {
            var _r = $(&#x27;#&#x27; + PopTips.Model._boxId );

            if ( !(_r &amp;&amp; _r.length) ) {
                _r = $( JC.f.printf( &#x27;&lt;div id=&quot;{0}&quot;&gt;&lt;/div&gt;&#x27;, PopTips.Model._boxId ) )
                    .appendTo( document.body );
            }

            return _r;
        },

        calcPosOffset: function ( _arrowPosition, _pos, _lw, _lh ) {
            var _r = {},
                _p = this,
                _selector = _p.selector(),
                _pos = {
                    top: _selector.offset().top + _p.offsetXY().y,
                    left: _selector.offset().left + _p.offsetXY().x,
                    width: _selector.prop(&#x27;offsetWidth&#x27;),
                    height: _selector.prop(&#x27;offsetHeight&#x27;)
                },
                _lw = _p.layout().outerWidth(),
                _lh = _p.layout().outerHeight();
            //JC.log( _lh, _lw, _arrowPosition, JC.f.ts() );
            //JC.log( _p.layout().html() );
            
            switch ( _arrowPosition ) {
                case &#x27;top&#x27;:
                    _r = {
                        top: _pos.top + _pos.height + 5 ,
                        left: _pos.left + _pos.width / 2 - _lw / 2 
                    };
                    break;
                case &#x27;right&#x27;:
                    _r = {
                        top: _pos.top + _pos.height / 2 - _lh / 2,
                        left: _pos.left - _lw - 5
                    };
                    break;
                case &#x27;bottom&#x27;:
                    _r = {
                        top: _pos.top - _lh - 5,
                        left: _pos.left + _pos.width / 2 - _lw / 2
                    };

                    break;
                case &#x27;left&#x27;:
                    _r = {
                        top: _pos.top + _pos.height / 2 - _lh / 2,
                        left: _pos.left + _pos.width + 5
                    };

                    break;
            }

            _r.width = _lw;
            _r.height = _lh;
  
            return _r;
        },

        /**
         * 设置 left top 之后, 获取高度不准确
         */
        offSet: function ( _offset ) {
            this.layout().css({
                top: _offset.top + &#x27;px&#x27;,
                left: _offset.left + &#x27;px&#x27;
            });
        },

        changePosition: function ( _newAP, _now ) {
            var _p = this,
                _offset;

            _offset = _p.calcPosOffset( _newAP );
            _p.changeArrow( _now );
            
            if ( ( _now === &#x27;top&#x27;  ) 
                || ( _now === &#x27;bottom&#x27; ) ) {
                _p.offSet( _offset );
            }
            
            return _offset;
        },

        changeArrow: function ( _className ) {
            var _p = this;
            _p.layout().find(&#x27;div.CPT_arrow&#x27;)[0].className = &#x27;CPT_arrow CPT_arrow_&#x27; + _className;

        },

        setPosition: function ( _offset, _arrowPosition ) {

            var _p = this,
                _newAP,
                _now,
                _win = $(window),
                _viewportHeight = _win.outerHeight(),
                _viewportWidth = _win.outerWidth(),
                _scrollTop = _win.scrollTop(),
                _scrollLeft = _win.scrollLeft(),
                _viewMaxX = _viewportWidth + _scrollLeft,
                _viewMaxY = _viewportHeight + _scrollTop,
                _tipsMaxPosX = _offset.width + _offset.left,
                _tipsMaxPosY = _offset.top + _offset.height,
                _baseP = _p.arrowPositionOffset(),
                //_baseP = &#x27;&#x27;,
                _afterChangePos,
                _winSize = JC.f.winSize(),
                _fixed
                ;

            _baseP &amp;&amp; ( _baseP = &#x27;_&#x27; + _baseP );
            

            if ( _arrowPosition === &#x27;bottom&#x27;  ) { 
                if ( _offset.top &lt; _winSize.viewportY ) {
                    _newAP = &#x27;top&#x27;;
                    _now = &#x27;top&#x27; + _baseP;
                    _p.changePosition( _newAP, _now );
                    _fixed = true;
                } else {
                    _p.changeArrow( &quot;bottom&quot; + _baseP );
                }
            }

            if ( _arrowPosition === &#x27;top&#x27;  ) {
                if( _viewMaxY &lt; _tipsMaxPosY ) {
                    _newAP = &#x27;bottom&#x27;;
                    _now = &#x27;bottom&#x27; + _baseP;
                    _afterChangePos = _p.changePosition( _newAP, _now );
                    _fixed = true;
                } else  {
                    _p.changeArrow( &#x27;top&#x27; + _baseP );
                }
                
            }

            if ( _arrowPosition === &#x27;right&#x27; ) {
                if ( _offset.left &lt; _winSize.viewportX ) {
                    _newAP = &#x27;left&#x27;;
                    _now = &#x27;left&#x27; + _baseP;
                    _afterChangePos = _p.changePosition(_newAP, _now);
                    _tipsMaxPosX = _afterChangePos.width + _afterChangePos.left;
                    _fixed = true;

                    if ( _viewMaxX &lt; _tipsMaxPosX ) {
                        _newAP = &#x27;bottom&#x27;;
                        _now = &#x27;bottom&#x27;;
                        _afterChangePos = _p.changePosition(_newAP, _now);

                        if ( _afterChangePos.top &lt; _winSize.viewportY ) {
                            _newAP = &#x27;top&#x27;;
                            _now = &#x27;top&#x27;;
                            _afterChangePos = _p.changePosition(_newAP, _now);
                        }

                    } else {
                        _p.offSet( _afterChangePos );
                    }
                } else {
                    _p.changeArrow(&#x27;right&#x27; + _baseP);
                }

            }

            if ( _arrowPosition === &#x27;left&#x27; ) {
                
                if ( _viewMaxX &lt; _tipsMaxPosX ) {
                    _newAP = &#x27;right&#x27;;
                    _now = &#x27;right&#x27; + _baseP;
                    _afterChangePos = _p.changePosition(_newAP, _now);
                    _fixed = true;

                    if ( _afterChangePos.left &lt; _winSize.viewportX ) {
                        _newAP = &#x27;bottom&#x27;;
                        _now = &#x27;bottom&#x27;;
                        _afterChangePos = _p.changePosition(_newAP, _now);
                        //JC.dir( _afterChangePos );

                        if ( _afterChangePos.top &lt; _winSize.viewportY ) {
                            _newAP = &#x27;top&#x27;;
                            _now = &#x27;top&#x27;;
                            _afterChangePos = _p.changePosition(_newAP, _now);
                        }

                    } else {
                        _p.offSet( _afterChangePos );
                    }

                } else {
                    _p.changeArrow(&#x27;left&#x27; + _baseP);
                }
            }

            !_fixed &amp;&amp; _p.offSet( _offset );
        },

        /**
         * PopTips显示前的回调
         */
        beforeShowCallback: function () {
            var _p = this,
                _selector = _p.selector(),
                _key = &#x27;beforeShowCallback&#x27;;

            return _p.callbackProp(_selector, _key);
        },

        /**
         * PopTips隐藏后的回调
        */
        afterHideCallback: function () {
            var _p = this,
                _selector = _p.selector(),
                _key = &#x27;afterShowCallback&#x27;;

            return _p.callbackProp(_selector, _key);
        }
    });
 
    JC.f.extendObject( PopTips.View.prototype, {
        init: function () {
            var _p = this;
        },

        update: function () {
            var _p = this,
                _selector = _p._model.selector(),
                _pos = {
                    top: _selector.offset().top,
                    left: _selector.offset().left,
                    width: _selector.prop(&#x27;offsetWidth&#x27;),
                    height: _selector.prop(&#x27;offsetHeight&#x27;)
                },
                _arrowPosition = _p._model.arrowPosition(),
                _revertArrow = _arrowPosition, 
                _offset, _revertOffset;

            switch( _arrowPosition ){
                case &#x27;left&#x27;: _revertArrow = &#x27;right&#x27;; break;
                case &#x27;right&#x27;: _revertArrow = &#x27;left&#x27;; break;
                case &#x27;top&#x27;: _revertArrow = &#x27;bottom&#x27;; break;
                case &#x27;bottom&#x27;: _revertArrow = &#x27;top&#x27;; break;
            }

            _offset = _p._model.calcPosOffset(_arrowPosition, JC.f.cloneObject( _pos ) );
            //JC.log( _arrowPosition, _revertArrow );

            var _newAP,
                _now,
                _win = $(window),
                _viewportHeight = _win.outerHeight(),
                _viewportWidth = _win.outerWidth(),
                _scrollTop = _win.scrollTop(),
                _scrollLeft = _win.scrollLeft(),
                _viewMaxX = _viewportWidth + _scrollLeft,
                _viewMaxY = _viewportHeight + _scrollTop,
                _tipsMaxPosX = _offset.width + _offset.left,
                _tipsMaxPosY = _offset.top + _offset.height,
                _baseP = _p._model.arrowPositionOffset(),
                _afterChangePos,
                _winSize = JC.f.winSize()
                ;

                ;
            if( _tipsMaxPosX &gt; _winSize.maxViewportX ){
                _arrowPosition = &#x27;right&#x27;;
                _offset = _p._model.calcPosOffset(_arrowPosition, JC.f.cloneObject( _pos ) );
            }

            if( _offset.left &lt; _winSize.viewportX ){
                _arrowPosition = &#x27;left&#x27;;
                _offset = _p._model.calcPosOffset(_arrowPosition, JC.f.cloneObject( _pos ) );
                //JC.dir( _offset );
            }

            if( _offset.top &lt; _winSize.viewportX ){
                _arrowPosition = &#x27;top&#x27;;
                _offset = _p._model.calcPosOffset(_arrowPosition, JC.f.cloneObject( _pos ) );
            }
            
            if( _tipsMaxPosY &gt; _winSize.maxViewportY ){
                _arrowPosition = &#x27;bottom&#x27;;
                _offset = _p._model.calcPosOffset(_arrowPosition, JC.f.cloneObject( _pos ) );
            }

            _p._model.setPosition( _offset, _arrowPosition );

            _p._model.layout().data(&#x27;CPopTipsIns&#x27;, _p);
        },

        show: function () {
            var _p = this;

            //_p._model.layout().show();
            
        },

        hide: function () {
            var _p = this;

            _p._model.layout().css( { left: &#x27;-10000px&#x27; } );
            

            _p._model.afterHideCallback() &amp;&amp; _p._model.afterHideCallback().call( _p, _p.selector() );

        }

    });

    $(document).ready( function () {
        var _insAr = 0;
        PopTips.autoInit
            &amp;&amp; ( _insAr = PopTips.init() );

    });

    $(window).on(&#x27;resize&#x27;, function () {
        JC.f.safeTimeout( function(){
            PopTips.update();
        }, null, &#x27;PopTipsResize&#x27;, 20 );
        //JC.log(&#x27;resize&#x27;);
    });
 
    return JC.PopTips;
});}( typeof define === &#x27;function&#x27; &amp;&amp; define.amd ? define : 
        function ( _name, _require, _cb ) { 
            typeof _name == &#x27;function&#x27; &amp;&amp; ( _cb = _name );
            typeof _require == &#x27;function&#x27; &amp;&amp; ( _cb = _require ); 
            _cb &amp;&amp; _cb(); 
        }
        , window
    )
);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
