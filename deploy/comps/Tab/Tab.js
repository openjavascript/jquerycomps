(function(define,_win){define(["JC.common"],function(){(function($){window.JC=window.JC||{log:function(){}};window.Tab=JC.Tab=Tab;function Tab(_selector,_triggerTarget){_selector&&(_selector=$(_selector));_triggerTarget&&(_triggerTarget=$(_triggerTarget));if(Tab.getInstance(_selector)){return Tab.getInstance(_selector)}this._model=new Model(_selector,_triggerTarget);this._view=new View(this._model);JC.log("initing tab");this._init()}Tab.autoInit=true;Tab.activeClass="cur";Tab.activeEvent="click";Tab.getInstance=function(_selector,_setter){var _r;_selector&&(_selector=$(_selector)).length&&(typeof _setter!="undefined"&&_selector.data("TabInstance",_setter),_r=_selector.data("TabInstance"));return _r};Tab.ajaxCallback=null;Tab.ajaxRandom=true;Tab.isAjax=function(_label){return $(_label).attr("tabajaxurl")};Tab.isAjaxInited=function(_label,_setter){_setter!="undefined"&&($(_label).data("TabAjaxInited",_setter));return $(_label).data("TabAjaxInited")};Tab.prototype={_init:function(){if(!this._model.layoutIsTab()){return this}Tab.getInstance(this._model.layout(),this);this._view.init();var _triggerTarget=$(this._model.triggerTarget());_triggerTarget&&_triggerTarget.length&&this._model.tablabel(_triggerTarget)&&_triggerTarget.trigger("click");return this},active:function(_label){var _ix;if(typeof _label=="number"){_ix=_label}else{_label&&$(_label).length&&(_ix=this._model.tabindex(_label))}typeof _ix!="undefined"&&(this._view.active(_ix));return this}};function Model(_selector,_triggerTarget){this._layout=_selector;this._triggerTarget=_triggerTarget;this._tablabels;this._tabcontainers;this.currentIndex;this._init()}Model.prototype={_init:function(){if(!this.layoutIsTab()){return}var _p=this,_re=/^\~[\s]+/g;if(_p.isFromChild(_p.layout().attr("tablabels"))){this._tablabels=_p.layout().find(_p.layout().attr("tablabels").replace(_re,""))}else{this._tablabels=JC.f.parentSelector(_p.layout(),_p.layout().attr("tablabels"))}if(_p.isFromChild(_p.layout().attr("tabcontainers"))){this._tabcontainers=_p.layout().find(_p.layout().attr("tabcontainers").replace(_re,""))}else{this._tabcontainers=JC.f.parentSelector(_p.layout(),_p.layout().attr("tabcontainers"))}this._tablabels.each(function(){_p.tablabel(this,1)});this._tabcontainers.each(function(){_p.tabcontent(this,1)});this._tablabels.each(function(_ix){_p.tabindex(this,_ix)});return this},isFromChild:function(_selector){return/^\~/.test($.trim(_selector))},layout:function(){return this._layout},tablabels:function(_ix){if(typeof _ix!="undefined"){return $(this._tablabels[_ix])}return this._tablabels},tabcontainers:function(_ix){if(typeof _ix!="undefined"){return $(this._tabcontainers[_ix])}return this._tabcontainers},triggerTarget:function(){return this._triggerTarget},layoutIsTab:function(){return this.layout().attr("tablabels")&&this.layout().attr("tabcontainers")},activeClass:function(){return this.layout().attr("tabactiveclass")||Tab.activeClass},activeEvent:function(){return this.layout().attr("tabactiveevent")||Tab.activeEvent},tablabel:function(_label,_setter){_label&&(_label=$(_label));if(!(_label&&_label.length)){return}typeof _setter!="undefined"&&_label.data("TabLabel",_setter);return _label.data("TabLabel")},tabcontent:function(_content,_setter){_content&&(_content=$(_content));if(!(_content&&_content.length)){return}typeof _setter!="undefined"&&_content.data("TabContent",_setter);return _content.data("TabContent")},tabindex:function(_label,_setter){_label&&(_label=$(_label));if(!(_label&&_label.length)){return}typeof _setter!="undefined"&&_label.data("TabIndex",_setter);return _label.data("TabIndex")},tabactivecallback:function(){var _r;this.layout().attr("tabactivecallback")&&(_r=window[this.layout().attr("tabactivecallback")]);return _r},tabchangecallback:function(){var _r;this.layout().attr("tabchangecallback")&&(_r=window[this.layout().attr("tabchangecallback")]);return _r},tablabelparent:function(_label){var _tmp;this.layout().attr("tablabelparent")&&(_tmp=_label.parent(this.layout().attr("tablabelparent")))&&_tmp.length&&(_label=_tmp);return _label},tabajaxurl:function(_label){return _label.attr("tabajaxurl")},tabajaxmethod:function(_label){return(_label.attr("tabajaxmethod")||"get").toLowerCase()},tabajaxdata:function(_label){var _r;_label.attr("tabajaxdata")&&(eval("(_r = "+_label.attr("tabajaxdata")+")"));_r=_r||{};Tab.ajaxRandom&&(_r.rnd=new Date().getTime());return _r},tabajaxcallback:function(_label){var _r=Tab.ajaxCallback,_tmp;_label.attr("tabajaxcallback")&&(_tmp=window[_label.attr("tabajaxcallback")])&&(_r=_tmp);return _r}};function View(_model){this._model=_model}View.prototype={init:function(){JC.log("Tab.View:",new Date().getTime());var _p=this;this._model.tablabels().on(this._model.activeEvent(),function(_evt){var _sp=$(this),_r;if(typeof _p._model.currentIndex!=="undefined"&&_p._model.currentIndex===_p._model.tabindex(_sp)){return}_p._model.currentIndex=_p._model.tabindex(_sp);_p._model.tabactivecallback()&&(_r=_p._model.tabactivecallback().call(this,_evt,_p._model.tabcontainers(_p._model.currentIndex),_p));if(_r===false){return}_p.active(_p._model.tabindex(_sp))});return this},active:function(_ix){if(typeof _ix=="undefined"){return}var _p=this,_r,_activeClass=_p._model.activeClass(),_activeItem=_p._model.tablabels(_ix);_p._model.tablabels().each(function(){_p._model.tablabelparent($(this)).removeClass(_activeClass)});_activeItem=_p._model.tablabelparent(_activeItem);_activeItem.addClass(_activeClass);_p._model.tabcontainers().hide();_p._model.tabcontainers(_ix).show();_p._model.tabchangecallback()&&(_r=_p._model.tabchangecallback().call(_p._model.tablabels(_ix),_p._model.tabcontainers(_ix),_p));if(_r===false){return}_p.activeAjax(_ix)},activeAjax:function(_ix){var _p=this,_label=_p._model.tablabels(_ix);if(!Tab.isAjax(_label)){return}if(Tab.isAjaxInited(_label)){return}var _url=_p._model.tabajaxurl(_label);if(!_url){return}JC.log(_p._model.tabajaxmethod(_label),_p._model.tabajaxdata(_label),_p._model.tabajaxcallback(_label));Tab.isAjaxInited(_label,1);$[_p._model.tabajaxmethod(_label)](_url,_p._model.tabajaxdata(_label),function(_r,_textStatus,_jqXHR){_p._model.tabajaxcallback(_label)&&_p._model.tabajaxcallback(_label)(_r,_label,_p._model.tabcontainers(_ix),_p,_textStatus,_jqXHR);!_p._model.tabajaxcallback(_label)&&_p._model.tabcontainers(_ix).html(_r)})}};$(document).delegate(".js_autoTab","mouseover",function(_evt){if(!Tab.autoInit){return}var _p=$(this),_tab,_src=_evt.target||_evt.srcElement;if(Tab.getInstance(_p)){return}_src&&(_src=$(_src));JC.log(new Date().getTime(),_src.prop("nodeName"));_tab=new Tab(_p,_src)})}(jQuery));return JC.Tab})}(typeof define==="function"&&define.amd?define:function(a,b){b&&b()},this));