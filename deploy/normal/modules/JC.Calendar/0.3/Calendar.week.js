(function(e,t){e(["JC.Calendar.date"],function(){function e(e){this._selector=e}function t(e){this._model=e}return JC.Calendar.weekTpl="",JC.Calendar.weekDayOffset=0,JC.Calendar.WeekModel=e,JC.Calendar.WeekView=t,JC.Calendar.clone(e,t),JC.f.extendObject(e.prototype,{layout:function(){var e=$("#UXCCalendar_week");return e.length||(e=$(JC.Calendar.weekTpl||this.tpl).hide(),e.attr("id","UXCCalendar_week").hide().appendTo(document.body)),e},tpl:['<div id="UXCCalendar_week" class="UXCCalendar UXCCalendar_week" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join(""),month:function(){var e=0,t,n=new Date;return(t=this.layout().find("td.cur a[dstart]")).length&&(n=new Date)&&n.setTime(t.attr("dstart")),e=n.getMonth(),e},selectedDate:function(){var e,t,n;return t=this.layout().find("td.cur"),t.length&&!t.hasClass("unable")&&(n=t.find("a[dstart]"))&&(e={start:new Date,end:new Date},e.start.setTime(n.attr("dstart")),e.end.setTime(n.attr("dend"))),e},singleLayoutDate:function(){var e=this,t=e.defaultDate(),n=this.day(),r,i=e.layout().find("td.cur > a[week]");return t.date.setDate(1),t.date.setFullYear(this.year()),t.date.setMonth(this.month()),r=JC.f.maxDayOfMonth(t.date),n>r&&(n=r),t.date.setDate(n),i.length&&(t.curweek=parseInt(i.attr("week"),10)),t}}),JC.f.extendObject(t.prototype,{_buildBody:function(e){var t=this,n=e.date,r=t._model.layout(),i=(new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate())).getTime(),s=JC.f.weekOfYear(n.getFullYear(),JC.Calendar.weekDayOffset),o=JC.f.weekOfYear(n.getFullYear()+1,JC.Calendar.weekDayOffset),u=0,a=[],f,l,c,h,p,d=n.getFullYear(),v=Math.ceil(s.length/8),m=JC.Calendar.lastIpt,g=JC.f.parseBool(m.attr("currentcanselect")),y,b=e.minvalue?JC.f.cloneDate(e.minvalue):null,w=e.maxvalue?JC.f.cloneDate(e.maxvalue):null;w&&g&&(y=w.getDay(),y>0&&w.setDate(w.getDate()+(7-y))),b&&g&&(y=b.getDay(),y>0?b.setDate(b.getDate()-y+1):b.setDate(b.getDate()-6)),a.push("<tr>");for(var E=1,S=v*8;E<=S;E++)l=s[E-1],l||(l=o[u++],d=n.getFullYear()+1),h=JC.f.pureDate(new Date),p=JC.f.pureDate(new Date),h.setTime(l.start),p.setTime(l.end),c=JC.f.printf("{0}年 第{1}周\n开始日期: {2} (周{4})\n结束日期: {3} (周{5})",d,JC.Calendar.getCnNum(l.week),JC.f.formatISODate(h),JC.f.formatISODate(p),JC.Calendar.cnWeek.charAt(h.getDay()%7),JC.Calendar.cnWeek.charAt(p.getDay()%7)),f=[],b&&h.getTime()<b.getTime()&&f.push("unable"),w&&p.getTime()>w.getTime()&&f.push("unable"),e.curweek?l.week==e.curweek&&n.getFullYear()==h.getFullYear()&&f.push("cur"):n.getTime()>=h.getTime()&&n.getTime()<=p.getTime()&&f.push("cur"),i>=h.getTime()&&i<=p.getTime()&&f.push("today"),a.push(JC.f.printf('<td class="{0}"><a href="javascript:" title="{2}" dstart="{3}" dend="{4}" week="{1}" date="{5}" >{1}</a></td>',f.join(" "),l.week,c,h.getTime(),p.getTime(),e.date.getTime())),E%8===0&&E!=S&&a.push("</tr><tr>");a.push("</tr>"),r.find("table.UTableBorder tbody").html($(a.join("")))},updateSelected:function(e){var t=this,n,r,i;if(!e)i=this._model.selectedDate(),i&&(n=i.start,r=i.end);else{e=$(e),i=JC.f.getJqParent(e,"td");if(i&&i.hasClass("unable"))return;n=new Date,r=new Date,n.setTime(e.attr("dstart")),r.setTime(e.attr("dend"))}if(!n||!r)return;t._model.selector().val(t._model.fullFormat(t._model.dateFormat(n),t._model.dateFormat(r))),$(t).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"week",n,r]),JC.Calendar.hide()}}),$(document).delegate(["input[datatype=week]","input[multidate=week]"].join(),"focus",function(e){Calendar.pickDate(this)}),$(document).delegate(["button[datatype=week]","button[multidate=week]"].join(),"click",function(e){Calendar.pickDate(this)}),$(document).delegate(["textarea[datatype=week]","textarea[multidate=week]"].join(),"click",function(e){Calendar.pickDate(this)}),JC.Calendar})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);