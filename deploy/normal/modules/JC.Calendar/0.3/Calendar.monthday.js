(function(e,t){e(["JC.Calendar.date"],function(){function e(e){this._selector=e}function t(e){this._model=e}function n(e,t,n){var r=[];e.minvalue&&t.getTime()<e.minvalue.getTime()&&r.push("unable"),e.maxvalue&&t.getTime()>e.maxvalue.getTime()&&r.push("unable"),JC.f.isSameDay(t,n)&&r.push("today");for(var i=0,s=e.multidate.length;i<s;i++)if(JC.f.isSameDay(e.multidate[i].start,t)){r.push("cur");break}return r}return JC.Calendar.monthdayTpl="",JC.Calendar.monthdayHeadAppendText="",JC.Calendar.MonthDayModel=e,JC.Calendar.MonthDayView=t,JC.Calendar.clone(e,t),JC.f.extendObject(e.prototype,{fixCheckall:function(){var e=this,t,n,r=!0,i;e._fixCheckAllTm&&clearTimeout(e._fixCheckAllTm),e._fixCheckAllTm=setTimeout(function(){n=e.layout().find("input.js_JCCalendarCheckbox[action=all]"),t=e.layout().find("input.js_JCCalendarCheckbox[dstart]"),t.each(function(){i=$(this);var t=e.findItemByTimestamp(i.attr("dstart"));if(t.atd.hasClass("unable"))return;if(!i.prop("checked"))return r=!1}),n.prop("checked",r)},100)},findItemByTimestamp:function(e){var t=this,n={a:null,atd:null,atr:null,input:null,inputtr:null,tm:e};return e&&(n.a=t.layout().find(JC.f.printf("a[dstart={0}]",e)),n.atd=JC.f.getJqParent(n.a,"td"),n.atr=JC.f.getJqParent(n.a,"tr"),n.input=t.layout().find(JC.f.printf("input[dstart={0}]",e)),n.inputtr=JC.f.getJqParent(n.input,"tr")),n},layout:function(){var e=$("#UXCCalendar_monthday");if(!e.length){e=$(JC.f.printf(JC.Calendar.monthdayTpl||this.tpl,JC.Calendar.monthdayHeadAppendText)).hide(),e.attr("id","UXCCalendar_monthday").hide().appendTo(document.body);var t=$(['<option value="0">一月</option>','<option value="1">二月</option>','<option value="2">三月</option>','<option value="3">四月</option>','<option value="4">五月</option>','<option value="5">六月</option>','<option value="6">七月</option>','<option value="7">八月</option>','<option value="8">九月</option>','<option value="9">十月</option>','<option value="10">十一月</option>','<option value="11">十二月</option>'].join("")).appendTo(e.find("select.UMonth"))}return e},tpl:['<div id="UXCCalendar_monthday" class="UXCCalendar UXCCalendar_week UXCCalendar_monthday" >','    <div class="UHeader">','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <button type="button" class="UButton UPreMonth">&nbsp;&nbsp;&lt;&nbsp;&nbsp;</button>','        <select class="UYear" style=""></select>','        <select class="UMonth"></select>',"        {0}",'        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UNextMonth">&nbsp;&nbsp;&gt;&nbsp;&nbsp;</button>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join(""),multiselect:function(){return!0},multiselectDate:function(){var e=this,t=[],n,r,i;return e.layout().find("input.js_JCCalendarCheckbox[dstart]").each(function(){n=$(this);if(!n.prop("checked"))return;i=new Date,i.setTime(n.attr("dstart")),t.push(i)}),t},ccPreserveDisabled:function(){var e=!0;return this.selector().is("[ccPreserveDisabled]")&&(e=JC.f.parseBool(this.selector().attr("ccPreserveDisabled"))),e},calendarclear:function(){var e=this,t=this.selector(),n,r;t&&t.attr("calendarclear")&&(r=window[t.attr("calendarclear")])&&(n=r);if(e.ccPreserveDisabled()){var i=e.layout().find("input[date]"),s=[];i.each(function(){var e=$(this),t;if(!e.is(":disabled")||!e.is(":checked"))return;t=new Date,t.setTime(e.attr("date")),s.push(JC.f.formatISODate(t))}),t.val(s.join(","))}return n},fixedDate:function(e){var t=this,n=JC.Calendar.lastIpt,r;n&&!n.is("[defaultdate]")&&(r=JC.f.cloneDate(e.multidate[0].start),n.attr("defaultdate",JC.f.formatISODate(r)))}}),JC.f.extendObject(t.prototype,{init:function(){var e=this;return $(e).on("MonthDayToggle",function(t,n){var r=e._model.findItemByTimestamp(n.attr("dstart"));if(r.atd.hasClass("unable"))return;r.input.prop("checked",r.atd.hasClass("cur")),e._model.fixCheckall()}),$(e).on("MonthDayInputToggle",function(t,n){var r=e._model.findItemByTimestamp(n.attr("dstart"));if(!r.atd){$(e).trigger("MonthDayToggleAll",[n]);return}if(r.atd.hasClass("unable"))return;r.atd[r.input.prop("checked")?"addClass":"removeClass"]("cur"),e._model.fixCheckall()}),$(e).on("MonthDayToggleAll",function(t,n){var r=e._model.layout().find("a[dstart]"),i=n.prop("checked");if(!r.length)return;r.each(function(){var t=$(this),n=JC.f.getJqParent(t,"td");if(n.hasClass("unable"))return;n[i?"addClass":"removeClass"]("cur"),$(e).trigger("MonthDayToggle",[t])})}),this},updateSelected:function(e){var t=this,n,r,i,s,o;if(!e){i=this._model.multiselectDate();if(!i.length)return;o=[];for(var u=0;u<i.length;u++)o.push(JC.f.formatISODate(i[u]));s=o.join(",")}else{e=$(e),i=JC.f.getJqParent(e,"td");if(i&&i.hasClass("unable"))return;if(t._model.multiselect()){i.toggleClass("cur");return}_date=new Date,_date.setTime(e.attr("date")),s=e.attr("date"),s=JC.f.printf("{0}",JC.f.formatISODate(_date))}if(!s)return;i.length&&(t._model.selector().attr("placeholder",JC.f.printf("{0}年 {1}",i[0].getFullYear(),i[0].getMonth()+1)),t._model.selector().attr("defaultdate",JC.f.formatISODate(i[0]))),t._model.selector().val(s),$(t).trigger("TriggerEvent",[JC.Calendar.Model.UPDATE,"monthday",i]),JC.Calendar.hide()},_buildBody:function(e){var t=this,r=t._model.layout(),i=JC.f.maxDayOfMonth(e.date),s=[],o,u,a,f,l=new Date;t._model.fixedDate(e),JC.log(e.date);var c=[],h=[],p=[],d=[],v=[];c.push('<tr><td><span class="bold">星期</span></td>'),h.push('<tr><td><span class="bold">日期</span></td>'),p.push('<tr class="Uchkdate"><td><label><span class="bold">全选</span>&nbsp;<input type="checkbox" class="js_JCCalendarCheckbox" action="all"  /></lable></td>');for(o=0;o<i;o++)a=new Date(e.date.getFullYear(),e.date.getMonth(),o+1),f=a.getDay(),d=[],v=n(e,a,l).join(" "),(f==0||f==6)&&d.push("red"),c.push(JC.f.printf('<td class="{0}">{1}</td>',d.join(" "),Calendar.cnWeek.charAt(f))),h.push(JC.f.printf('<td class="{0}"><a href="javascript:;" dstart="{1}" dend="{1}" title="{3}" >{2}</a></td>',v,a.getTime(),o+1,JC.f.formatISODate(a))),p.push(JC.f.printf('<td><input type="checkbox" date="{1}" dstart="{1}" dend="{1}" class="js_JCCalendarCheckbox" action="item" {3} {4} title="{2}" /></td>',"",a.getTime(),JC.f.formatISODate(a),!/\bunable\b/.test(v)&&/\bcur\b/.test(v)?"checked":"",/\bunable\b/.test(v)?"disabled":"")),a.setDate(a.getDate()+1),f=a.getDay();c.push("</tr>"),h.push("</tr>"),p.push("</tr>"),s=s.concat(c,h,p),r.find("table.UTableBorder tbody").html($(s.join(""))),t._model.fixCheckall()}}),$(document).delegate("#UXCCalendar_monthday a[dstart]","click",function(e){var t=JC.Calendar.lastIpt,n,r,i=$(this);if(!t)return;n=JC.Calendar.type(t),r=JC.Calendar.getInstance(t);if(!r)return;$(r._view).trigger("MonthDayToggle",[i])}),$(document).delegate("#UXCCalendar_monthday input.js_JCCalendarCheckbox","click",function(e){var t=JC.Calendar.lastIpt,n,r,i=$(this);if(!t)return;n=JC.Calendar.type(t),r=JC.Calendar.getInstance(t);if(!r)return;$(r._view).trigger("MonthDayInputToggle",[i])}),$(document).delegate(["input[datatype=monthday]","input[multidate=monthday]"].join(),"focus",function(e){Calendar.pickDate(this)}),$(document).delegate(["button[datatype=monthday]","button[multidate=monthday]"].join(),"click",function(e){Calendar.pickDate(this)}),$(document).delegate(["textarea[datatype=monthday]","textarea[multidate=monthday]"].join(),"click",function(e){Calendar.pickDate(this)}),JC.Calendar})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);