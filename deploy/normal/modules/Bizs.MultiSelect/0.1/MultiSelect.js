(function(e,t){e(["JC.BaseMVC"],function(){function e(t){t&&(t=$(t));if(JC.BaseMVC.getInstance(t,e))return JC.BaseMVC.getInstance(t,e);JC.BaseMVC.getInstance(t,e,this),this._model=new e.Model(t),this._view=new e.View(this._model),this._init()}Bizs.MultiSelect=e,e.init=function(t){var n=[];return t=$(t||document),t&&t.length&&(t.hasClass("js_bizMultiSelect")?n.push(new e(t)):t.find("div.js_bizMultiSelect").each(function(){n.push(new e(this))})),n},e.dataFilter,BaseMVC.build(e),JC.f.extendObject(e.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){},_inited:function(){},show:function(){return this._view.show(),this},hide:function(){return this._view.hide(),this}}),e.Model._instanceName="MultiSelectIns",e.Model.SHOW="SHOW",JC.f.extendObject(e.Model.prototype,{init:function(){},defaultLabel:function(){return this.attrProp("defaultLabel")},dataBindBox:function(){var e=this,t=e.attrProp("dataBindBox");return JC.f.parentSelector(e.selector(),t)},listBox:function(){return this.selector().find(".SELECTListBox")},ajaxUrl:function(){return this.attrProp("ajaxUrl")},ajaxData:function(){var e=this,t=e.ajaxUrl(),n=e.attrProp("dataname"),r=[],i=e.listBox();if(!t)return;r.push('<ul><li class="SELECTIgnore"><label><input type="checkbox" value="" checktype="all" checkfor="///input[type=checkbox]">全选</label></li>'),$.get(t,function(t){t=e.dataFilter($.parseJSON(t));var s=0,o=t.length,u="",a;for(s=0;s<o;s++)a=t[s].isChecked?"checked":"",u='<li><label><input type="checkbox" value="'+t[s].id+'" name="'+n+'" '+a+' data-text="'+t[s].label+'" />'+t[s].label+"</label></li>",r.push(u);r.push("</ul>"),$(r.join(" ")).prependTo(i),JC.f.autoInit(i)})},dataFilter:function(t){var n=this,r=n.callbackProp("dataFilter")||e.dataFilter;return r&&(t=r(t)),t},dataList:function(){var e=this,t=e.listBox().find(">ul>li").not(".SELECTIgnore"),n=[];return t.length===0&&e.ajaxUrl()&&e.ajaxData(),t.each(function(){var e=$(this),t="",r=e.find("input");r.prop("checked")&&(t="<li>"+r.data("text")+"</li>",n.push(t))}),n},bindData:function(){var e=this,t=e.dataBindBox(),n=e.dataList(),r=n.length,i=e.defaultLabel(),s="";t.html("<ul>"+n.join(" ")+"</ul>"),s=r?"已选择"+r+"个"+i:"请选择"+i,e.selector().find(".SELECTLabel").html(s)}}),JC.f.extendObject(e.View.prototype,{init:function(){},show:function(){var e=this,t=e._model.selector();JC.f.safeTimeout(setTimeout(function(){},50),t,"SELECTListBoxUi"),t.addClass("SELECTBOX-active"),e._model.listBox().show().css({"z-index":ZINDEX_COUNT++})},hide:function(){var e=this,t=e._model.selector();e._model.listBox().hide(),JC.f.safeTimeout(setTimeout(function(){t.removeClass("SELECTBOX-active"),e._model.bindData()},50),t,"SELECTListBoxUi")}});var t=$(document);return t.ready(function(){var t=0;e.autoInit&&(t=e.init())}),t.delegate(".js_bizMultiSelect","click",function(){var t=$(this),n;JC.f.safeTimeout(function(){n=JC.BaseMVC.getInstance(t,e),!n&&(n=new e(t)),n.show()},t,"bizMultiSelectClick",50)}),t.on("mousedown",function(){JC.f.safeTimeout(function(){$(".js_bizMultiSelect").each(function(){var t=JC.BaseMVC.getInstance($(this),e);t&&t.hide()})},null,"CLOSE_MULTI_SELECT")}),t.delegate(".SELECTCloseBtn","mousedown",function(){var t=JC.BaseMVC.getInstance(JC.f.getJqParent($(this),".js_bizMultiSelect"),e);t&&t.hide()}),t.delegate(".js_bizMultiSelect>.SELECTListBox","mousedown",function(e){e.stopPropagation()}),Bizs.MultiSelect})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);