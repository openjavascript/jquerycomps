(function(define,_win){define(["JC.BaseMVC"],function(){function Tab(e,t){e&&(e=$(e)),t&&(t=$(t));if(Tab.getInstance(e))return Tab.getInstance(e);Tab.getInstance(e,this),this._model=new Tab.Model(e,t),this._view=new Tab.View(this._model),this._init()}return window.Tab=JC.Tab=Tab,JC.f.addAutoInit(Tab),Tab.autoInit=!0,Tab.activeClass="cur",Tab.activeEvent="click",Tab.getInstance=function(e,t){return JC.BaseMVC.getInstance(e,Tab,t)},Tab.triggerDefault=function(e){if(!(e&&e._model&&e._model.tablabels))return e;var t=e._model.tabQueryKey(),n,r;if(t){n=JC.f.getUrlParam(t);if(n){r=$(e._model.tablabels()[n]);if(r&&r.length)return r.trigger(e._model.activeEvent()),e}}return e._model.tablabels().each(function(){var t=$(this);if(t.parent().hasClass(e._model.activeClass(e._model.tablabelparent(t))))return t.trigger(e._model.activeEvent()),!1}),e},Tab.init=function(e){var t=[],n;return e=$(e||document),e&&e.length&&(e.hasClass("js_autoTab")||e.hasClass("js_compTab")?t.push(Tab.triggerDefault(new Tab(e))):e.find("div.js_autoTab, div.js_compTab").each(function(){t.push(Tab.triggerDefault(new Tab(this)))})),t},Tab.selectorIsTab=function(e){var t;return e&&(e=$(e))&&e.length&&e.attr("tablabels")&&e.attr("tabcontainers")&&(t=!0),t},Tab.ajaxCallback=null,Tab.ajaxRandom=!0,Tab.isAjax=function(e){return $(e).attr("tabAjaxUrl")},Tab.isAjaxInited=function(e,t){return t!="undefined"&&$(e).data("TabAjaxInited",t),$(e).data("TabAjaxInited")},Tab.isIframe=function(e){return $(e).attr("tabIframeUrl")},Tab.isIframeInited=function(e,t){return t!="undefined"&&$(e).data("TabIframeInited",t),$(e).data("TabIframeInited")},Tab.Model=function(e,t){this._selector=e,this._triggerTarget=t,this._tablabels,this._tabcontainers,this.currentIndex},JC.BaseMVC.build(Tab),JC.f.extendObject(Tab.prototype,{_initHanlderEvent:function(){var e=this;e.on("inited",function(){var t=$(this._model.triggerTarget());t&&t.length&&this._model.tablabel(t)&&t.trigger(e._model.activeEvent())})},active:function(e){var t;return typeof e=="number"?t=e:e&&$(e).length&&(t=this._model.tabindex(e)),typeof t!="undefined"&&this._view.active(t),this},_inited:function(){this.trigger("inited")}}),Tab.Model._instanceName="TabInstance",JC.f.extendObject(Tab.Model.prototype,{init:function(){var e=this,t=/^\~[\s]+/g;return e.isFromChild(e.selector().attr("tablabels"))?this._tablabels=e.selector().find(e.selector().attr("tablabels").replace(t,"")):this._tablabels=JC.f.parentSelector(e.selector(),e.selector().attr("tablabels")),e.isFromChild(e.selector().attr("tabcontainers"))?this._tabcontainers=e.selector().find(e.selector().attr("tabcontainers").replace(t,"")):this._tabcontainers=JC.f.parentSelector(e.selector(),e.selector().attr("tabcontainers")),this._tablabels.each(function(){e.tablabel(this,1)}),this._tabcontainers.each(function(){e.tabcontent(this,1)}),this._tablabels.each(function(t){e.tabindex(this,t)}),this},tabQueryKey:function(){var e=this.attrProp("tabQueryKey")||"";return e},isFromChild:function(e){return/^\~/.test($.trim(e))},tablabels:function(e){return typeof e!="undefined"?$(this._tablabels[e]):this._tablabels},tabcontainers:function(e){return typeof e!="undefined"?$(this._tabcontainers[e]):this._tabcontainers},triggerTarget:function(){return this._triggerTarget},activeClass:function(){return this.selector().attr("tabactiveclass")||Tab.activeClass},activeEvent:function(){return this.selector().attr("tabactiveevent")||Tab.activeEvent},tablabel:function(e,t){e&&(e=$(e));if(!e||!e.length)return;return typeof t!="undefined"&&e.data("TabLabel",t),e.data("TabLabel")},tabcontent:function(e,t){e&&(e=$(e));if(!e||!e.length)return;return typeof t!="undefined"&&e.data("TabContent",t),e.data("TabContent")},tabindex:function(e,t){e&&(e=$(e));if(!e||!e.length)return;return typeof t!="undefined"&&e.data("TabIndex",t),e.data("TabIndex")},tabactivecallback:function(){var e;return this.selector().attr("tabactivecallback")&&(e=window[this.selector().attr("tabactivecallback")]),e},tabchangecallback:function(){var e;return this.selector().attr("tabchangecallback")&&(e=window[this.selector().attr("tabchangecallback")]),e},tablabelparent:function(e){var t;return this.selector().attr("tablabelparent")&&(t=e.parent(this.selector().attr("tablabelparent")))&&t.length&&(e=t),e},tabAjaxUrl:function(e){return e.attr("tabAjaxUrl")},tabIframeUrl:function(e){return e.attr("tabIframeUrl")},tabajaxmethod:function(e){return(e.attr("tabajaxmethod")||"get").toLowerCase()},tabajaxdata:function(_label){var _r;return _label.attr("tabajaxdata")&&eval("(_r = "+_label.attr("tabajaxdata")+")"),_r=_r||{},Tab.ajaxRandom&&(_r.rnd=(new Date).getTime()),_r},tabajaxcallback:function(e){var t=Tab.ajaxCallback,n;return e.attr("tabajaxcallback")&&(n=window[e.attr("tabajaxcallback")])&&(t=n),t}}),JC.f.extendObject(Tab.View.prototype,{init:function(){var e=this;return this._model.tablabels().on(e._model.activeEvent(),function(t){var n=$(this),r;if(typeof e._model.currentIndex!="undefined"&&e._model.currentIndex===e._model.tabindex(n))return;e._model.currentIndex=e._model.tabindex(n),e._model.tabactivecallback()&&(r=e._model.tabactivecallback().call(this,t,e._model.tabcontainers(e._model.currentIndex),e));if(r===!1)return;e.active(e._model.tabindex(n))}),this},active:function(e){if(typeof e=="undefined")return;var t=this,n,r=t._model.activeClass(),i=t._model.tablabels(e);t._model.tablabels().each(function(){t._model.tablabelparent($(this)).removeClass(r)}),i=t._model.tablabelparent(i),i.addClass(r),t._model.tabcontainers().hide(),t._model.tabcontainers(e).show(),t._model.tabchangecallback()&&(n=t._model.tabchangecallback().call(t._model.tablabels(e),t._model.tabcontainers(e),t));if(n===!1)return;t.activeAjax(e),t.activeIframe(e)},activeAjax:function(e){var t=this,n=t._model.tablabels(e);if(!Tab.isAjax(n))return;if(Tab.isAjaxInited(n))return;var r=t._model.tabAjaxUrl(n);if(!r)return;Tab.isAjaxInited(n,1),$[t._model.tabajaxmethod(n)](r,t._model.tabajaxdata(n),function(r,i,s){t._model.tabajaxcallback(n)&&t._model.tabajaxcallback(n)(r,n,t._model.tabcontainers(e),t,i,s),!t._model.tabajaxcallback(n)&&t._model.tabcontainers(e).html(r)})},activeIframe:function(e){var t=this,n=t._model.tablabels(e);if(!Tab.isIframe(n))return;if(Tab.isIframeInited(n))return;var r=t._model.tabIframeUrl(n);if(!r)return;Tab.isIframeInited(n,1),t._model.tabcontainers(e).attr("src",r)}}),$(document).delegate(".js_autoTab, .js_compTab","mouseover",function(e){if(!Tab.autoInit)return;var t=$(this),n,r=e.target||e.srcElement;if(Tab.getInstance(t))return;r&&(r=$(r)),n=new Tab(t,r)}),$(document).ready(function(){$("div.js_autoTab[tabTriggerDefault], div.js_compTab[tabTriggerDefault]").each(function(){var e=$(this),t=JC.BaseMVC.getInstance(e,JC.Tab);t||Tab.triggerDefault(new Tab(e))})}),JC.Tab})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);