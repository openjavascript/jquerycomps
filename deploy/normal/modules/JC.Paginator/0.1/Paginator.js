(function(e,t){e(["JC.BaseMVC"],function(){function e(t){t&&(t=$(t));if(e.getInstance(t))return e.getInstance(t);e.getInstance(t,this),this._model=new e.Model(t),this._view=new e.View(this._model),this._init()}return JC.Paginator=e,JC.f.addAutoInit&&JC.f.addAutoInit(e),e.getInstance=function(t,n){typeof t=="string"&&!/</.test(t)&&(t=$(t));if(!t||!t.length||typeof t=="string")return;return typeof n!="undefined"&&t.data(e.Model._instanceName,n),t.data(e.Model._instanceName)},e.init=function(t){var n=[];return t=$(t||document),t.length&&(t.hasClass("js_compPaginator")?n.push(new e(t)):t.find(".js_compPaginator").each(function(){n.push(new e(this))})),n},BaseMVC.build(e),JC.f.extendObject(e.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var e=this,t=e._model.selector();if(!e._model.totalRecords())return;e._view.paginatedView(),e._view.updateContentView(),t.delegate(".js_page","click",function(t){t.preventDefault();var n=$(this),r=parseInt(n.text(),10);e.trigger("GOTOPAGE",[r,n])}).delegate(".js_prevpage","click",function(t){t.preventDefault(),e.trigger("PREVPAGE")}).delegate(".js_nextpage","click",function(t){t.preventDefault(),e.trigger("NEXTPAGE")}).delegate(".js_perpage","change",function(t){e._model.currentPage=1,e.trigger("UPDATEVIEW",[$(this).val()])}).delegate(".js_goto","change",function(t){var n=$(this),r=n.val();if(isNaN(r))return!1;r>Math.ceil(e._model.totalRecords/e._model.perPage())&&(r=1),e.trigger("GOTOPAGE",[r,n])}),e.on("RENDER",function(t){e._view.updatePaginatorView(),e._view.updateContentView()}),e.on("PREVPAGE",function(){e._model.prevPage()}),e.on("NEXTPAGE",function(){e._model.nextPage()}),e.on("GOTOPAGE",function(t,n){e._model.currentPage=n,e._view.updateContentView(),e._view.updatePaginatorView()}),e.on("UPDATEVIEW",function(t,n){setTimeout(function(){e._view.paginatedView(n),e._model.selector().attr("perPage",n),e._view.updateContentView()},20)}),e.on("FLIPPED",function(t,n){e._model.flipped()&&e._model.flipped().call(e,e.selector(),n)})},_inited:function(){}}),e.Model._instanceName="Paginator",JC.f.extendObject(e.Model.prototype,{paginatortype:function(){return this.attrProp("paginatortype")||"ajax"},paginatorUi:function(){var e=this,t=e.attrProp("paginatorui")||".page";return e.selector().find(t)},paginatorContent:function(){var e=this,t=e.attrProp("paginatorcontent")||"tbody";return e.selector().find(t)},paginatorUiTpl:function(){return'共{0}页，{1}条记录<a href="#" class="js_prevpage disabled">上一页</a>{2}<a href="#" class="js_nextpage">下一页</a>每页显示<select name="pz" class="sel sel-s js_perpage">'+this.perPageOption()+"</select>"+'到第<input type="text" class="js_goto" style="width:60px;" />页'},currentPage:1,perPage:function(){return this.intProp("perPage")||10},perPageOption:function(){var e=this.attrProp("perpageitems")||"10|20|50",t,n,r="",i="";e=e.split("|"),n=e.length;for(t=0;t<n;t++)i=t===this.perPage()?"selected":"",r+='<option value="'+e[t]+'"'+i+">"+e[t]+"</option>";return r},midRange:function(){return this.intProp("midRange")||5},totalRecords:function(){return this.intProp("totalrecords")},prevPage:function(){var e=this;if(e.currentPage===1)return;e.currentPage--,e.trigger("RENDER")},nextPage:function(){var e=this,t=Math.ceil(e.totalRecords()/e.perPage());if(e.currentPage===t)return;e.currentPage++,e.trigger("RENDER")},flipped:function(){var e=this,t=e.selector(),n="flipped";return e.callbackProp(t,n)}}),JC.f.extendObject(e.View.prototype,{init:function(){},paginatedView:function(e){var t=this,n=t._model.paginatorUi(),r=t._model.paginatorUiTpl(),e=e||t._model.perPage(),i=Math.ceil(t._model.totalRecords()/e),s="",o,u=t._model.currentPage;for(o=1;o<i;o++)s+=o>t._model.midRange()?'<a href="javascript:;" class="js_page dn" >'+o+"</a>":'<a href="javascript:;" class="js_page" >'+o+"</a>",i>t._model.midRange()&&(o===1&&(s+='<span class="dn js_firstBreak">...</span>'),o===i-1&&(s+='<span class="js_lastBreak">...</span>'));s+='<a href="javascript:;" class="js_page">'+i+"</a>",r=JC.f.printf(r,i,t._model.totalRecords(),s),n.html(r).find(".js_perpage").val(e),n.find(".js_page").eq(u-1).addClass("cur")},updateContentView:function(){var e=this,t=e._model.currentPage,n=e._model.perPage(),r=(t-1)*n,i=r+n;e._model.paginatorContent().find("tr").hide().slice(r,i).show(),e.trigger("FLIPPED")},updatePaginatorView:function(){var e=this,t=e._model.currentPage,n=e._model.paginatorUi(),r=n.find(".js_firstBreak"),i=n.find(".js_lastBreak"),s=Math.ceil(e._model.totalRecords()/e._model.perPage()),o=e._model.midRange(),u=Math.ceil(o/2),a=s-o,f,l;f=t-u>0?Math.min(t-u,a):0,f=Math.max(f-1,0),l=f+o,n.find(".js_page").not(":first").not(":last").addClass("dn").slice(f,l).removeClass("dn"),n.find(".js_page").eq(t-1).addClass("cur").siblings().removeClass("cur"),r[t-u>1?"show":"hide"](),i[t+u>=s?"hide":"show"](),t===1?n.find(".js_prevpage").prop("disabled",!0).addClass("disabled"):n.find(".js_prevpage").prop("disabled",!1).removeClass("disabled"),t===s?n.find(".js_nextpage").prop("disabled",!0).addClass("disabled"):n.find(".js_nextpage").prop("disabled",!1).removeClass("disabled")}}),$(document).ready(function(){var t=0;e.autoInit&&(t=e.init())}),JC.Paginator})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);