(function(e,t){e(["JC.BaseMVC"],function(){function e(t){t&&(t=$(t));if(e.getInstance(t))return e.getInstance(t);e.getInstance(t,this),this._model=new e.Model(t),this._view=new e.View(this._model),this._init()}return JC.PopTips=e,e.getInstance=function(t,n){typeof t=="string"&&!/</.test(t)&&(t=$(t));if(!t||!t.length||typeof t=="string")return;return typeof n!="undefined"&&t.data(e.Model._instanceName,n),t.data(e.Model._instanceName)},e.init=function(t){var n=[];return t=$(t||document),t.length&&(t.hasClass("js_compPopTips")?n.push(new e(t)):t.find("span.js_compPopTips,a.js_compPopTips,b.js_compPopTips,em.js_compPopTips").each(function(){n.push(new e(this))})),n},e.update=function(){var t=$(JC.f.printf("#{0}>div",e.Model._boxId));if(!t.length)return;t.each(function(){var e=$(this),t=e.data("CPopTipsIns");if(!t)return;t._model.layout().is(":visible")&&t.update()})},BaseMVC.build(e),JC.f.extendObject(e.prototype,{_beforeInit:function(){},_initHanlderEvent:function(){var e=this;e.on("CPopTipsUpdate",function(t){e._model.beforeShowCallback()&&e._model.beforeShowCallback().call(e,e.selector())});var t=null,n=null,r=null,i=null;e._model.triggerType()=="hover"&&(e._model.selector().on("mouseenter",function(){clearTimeout(r),clearTimeout(i),clearTimeout(t),clearTimeout(n),t=setTimeout(function(){e._view.update(),e._view.show()},50)}).on("mouseleave",function(){clearTimeout(r),clearTimeout(i),clearTimeout(t),clearTimeout(n),n=setTimeout(function(){e._view.hide()},200)}),e._model.layout().on("mouseenter",function(){clearTimeout(r),clearTimeout(i),clearTimeout(t),clearTimeout(n),r=setTimeout(function(){e._view.update(),e._view.show()},50)}).on("mouseleave",function(){clearTimeout(r),clearTimeout(i),clearTimeout(t),clearTimeout(n),i=setTimeout(function(){e._view.hide()},200)})),e.on("update_layout",function(t,n){var r;try{r=$.parseJSON(n),r&&"errorno"in r&&!r.errorno&&r.data&&(n=r.data)}catch(i){}e._model.layout().find(".js_cpt_ajax_ph").html(n)}),e._model.triggerType()=="click"&&e._model.selector().on("click",function(t){e._model.layout().is(":visible")?e._view.hide():(e._view.update(),e._view.show())})},_inited:function(){var e=$(this);e.trigger("CPopTipsUpdate")},update:function(){return this._view.update(),this}}),e.Model._instanceName="PopTips",e.Model._boxId="CPTBox",JC.f.extendObject(e.Model.prototype,{init:function(){var e=this},baseTpl:'<div class="CPT CPT_{0}" style="position:absolute;display:none;"><div class="CPT_shadow"><div class="CPT_container" style="min-width:{4}; min-height: {5}"><div class="CPT_arrow CPT_arrow_{1}"><em></em><span></span></div><div class="CPT_content"  data-role="content" {3}>{2}</div></div></div></div>',theme:function(){var e=this.stringProp("theme");return!e&&(e="yellow"),e},contents:function(){var e=this.attrProp("content")||this.attrProp("title");return!e&&(e=this.selector().text()),e},htmlContents:function(){var e,t=JC.f.parentSelector(this.selector(),this.attrProp("htmlContent"));return e=JC.f.scriptContent(t),e},ajaxContent:function(){var e=this;this.is("[ajaxContent]")&&$.get(this.attrProp("ajaxContent")).done(function(t){e.trigger("update_layout",[t])})},arrowPosition:function(){var e=this.stringProp("arrowPosition");return!e&&(e="left"),e},arrowPositionOffset:function(){var e=this.stringProp("arrowPositionOffset"),t=this.arrowPosition();(t==="left"||t==="right")&&e!="top"&&(e="");if(t==="top"||t==="bottom")if(e!="left"||e!="right")e="";return e},offsetXY:function(){var e=this.attrProp("offsetXY").split(","),t=parseInt(e[0],10)||0,n=parseInt(e[1],10)||0;return{x:t,y:n}},triggerType:function(){var e=this.stringProp("triggerType");return!e&&(e="hover"),e},layout:function(){var e=this,t=e.baseTpl;return this._layout||(e.htmlContents()?this._layout=$(JC.f.printf(t,e.theme(),e.arrowPosition(),e.htmlContents(),'style="width:'+e.layoutWidth()+";height:"+e.layoutHeight()+';"',e.layoutMinWidth(),e.layoutMinHeight())).appendTo(this.layoutBox()):this.is("[ajaxContent]")?(this._layout=$(JC.f.printf(t,e.theme(),e.arrowPosition(),'<div class="js_cpt_ajax_ph">加载中...</div>','style="width:'+e.layoutWidth()+";height:"+e.layoutHeight()+';"',e.layoutMinWidth(),e.layoutMinHeight())).appendTo(this.layoutBox()),e.ajaxContent()):this._layout=$(JC.f.printf(t,e.theme(),e.arrowPosition(),e.contents(),'style="width:'+e.layoutWidth()+";height:"+e.layoutHeight()+';"',e.layoutMinWidth(),e.layoutMinHeight())).appendTo(this.layoutBox())),this._layout},layoutWidth:function(){var e=this.intProp("popTipsWidth");return e&&(e+="px"),!e&&(e="auto"),e},layoutMinWidth:function(){var e=this.intProp("popTipsMinWidth");return e&&(e+="px"),!e&&(e="auto"),e},layoutHeight:function(){var e=this.intProp("popTipsHeight");return e&&(e+="px"),!e&&(e="auto"),e},layoutMinHeight:function(){var e=this.intProp("popTipsMinHeight");return e&&(e+="px"),!e&&(e="auto"),e},layoutBox:function(){var t=$("#"+e.Model._boxId);if(!t||!t.length)t=$(JC.f.printf('<div id="{0}"></div>',e.Model._boxId)).appendTo(document.body);return t},calcPosOffset:function(e,t,n,r){var i={},s=this,o=s.selector(),t={top:o.offset().top+s.offsetXY().y,left:o.offset().left+s.offsetXY().x,width:o.prop("offsetWidth"),height:o.prop("offsetHeight")},n=s.layout().outerWidth(),r=s.layout().outerHeight();switch(e){case"top":i={top:t.top+t.height+5,left:t.left+t.width/2-n/2};break;case"right":i={top:t.top+t.height/2-r/2,left:t.left-n-5};break;case"bottom":i={top:t.top-r-5,left:t.left+t.width/2-n/2};break;case"left":i={top:t.top+t.height/2-r/2,left:t.left+t.width+5}}return i.width=n,i.height=r,i},offSet:function(e){this.layout().css({top:e.top,left:e.left})},changePosition:function(e,t){var n=this,r;return r=n.calcPosOffset(e),n.changeArrow(t),(t==="top"||t==="bottom")&&n.offSet(r),r},changeArrow:function(e){var t=this;t.layout().find("div.CPT_arrow")[0].className="CPT_arrow CPT_arrow_"+e},setPosition:function(e,t){var n=this,r,i,s=$(window),o=s.outerHeight(),u=s.outerWidth(),a=s.scrollTop(),f=s.scrollLeft(),l=u+f,c=o+a,h=e.width+e.left,p=e.top+e.height,d=n.arrowPositionOffset(),v;n.offSet(e),d&&(d="_"+d),t==="bottom"&&(e.top<0?(r="top",i="top"+d,n.changePosition(r,i)):n.changeArrow("bottom"+d)),t==="top"&&(c<p?(r="bottom",i="bottom"+d,v=n.changePosition(r,i)):n.changeArrow("top"+d)),t==="right"&&(e.left<0?(r="left",i="left"+d,v=n.changePosition(r,i),h=v.width+v.left,l<h?(r="bottom",i="bottom",v=n.changePosition(r,i),v.top<0&&(r="top",i="top",v=n.changePosition(r,i))):n.offSet(v)):n.changeArrow("right"+d)),t==="left"&&(l<h?(r="right",i="right"+d,v=n.changePosition(r,i),v.left<0?(r="bottom",i="bottom",v=n.changePosition(r,i),v.top<0&&(r="top",i="top",v=n.changePosition(r,i))):n.offSet(v)):n.changeArrow("left"+d))},beforeShowCallback:function(){var e=this,t=e.selector(),n="beforeShowCallback";return e.callbackProp(t,n)},afterHideCallback:function(){var e=this,t=e.selector(),n="afterShowCallback";return e.callbackProp(t,n)}}),JC.f.extendObject(e.View.prototype,{init:function(){var e=this},update:function(){var e=this,t=e._model.selector(),n={top:t.offset().top,left:t.offset().left,width:t.prop("offsetWidth"),height:t.prop("offsetHeight")},r=e._model.arrowPosition(),i;i=e._model.calcPosOffset(r,n),e._model.setPosition(i,r),e._model.layout().data("CPopTipsIns",e)},show:function(){var e=this;e._model.layout().show()},hide:function(){var e=this;e._model.layout().hide(),e._model.afterHideCallback()&&e._model.afterHideCallback().call(e,e.selector())}}),$(document).ready(function(){var t=0;e.autoInit&&(t=e.init())}),$(window).on("resize",function(){JC.f.safeTimeout(function(){e.update()},null,"PopTipsResize",20)}),JC.PopTips})})(typeof define=="function"&&define.amd?define:function(e,t,n){typeof e=="function"&&(n=e),typeof t=="function"&&(n=t),n&&n()},window);