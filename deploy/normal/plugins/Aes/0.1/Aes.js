/*  AES implementation in JavaScript (c) Chris Veness 2005-2012                                   */

/*  AES Counter-mode implementation in JavaScript (c) Chris Veness 2005-2012                      */

/*  Base64 class: Base 64 encoding / decoding (c) Chris Veness 2002-2012                          */

/*              single-byte character encoding (c) Chris Veness 2002-2012                         */

(function(){var e=window.Aes={};e.cipher=function(t,n){var r=4,i=n.length/r-1,s=[[],[],[],[]];for(var o=0;o<4*r;o++)s[o%4][Math.floor(o/4)]=t[o];s=e.addRoundKey(s,n,0,r);for(var u=1;u<i;u++)s=e.subBytes(s,r),s=e.shiftRows(s,r),s=e.mixColumns(s,r),s=e.addRoundKey(s,n,u,r);s=e.subBytes(s,r),s=e.shiftRows(s,r),s=e.addRoundKey(s,n,i,r);var a=new Array(4*r);for(var o=0;o<4*r;o++)a[o]=s[o%4][Math.floor(o/4)];return a},e.keyExpansion=function(t){var n=4,r=t.length/4,i=r+6,s=new Array(n*(i+1)),o=new Array(4);for(var u=0;u<r;u++){var a=[t[4*u],t[4*u+1],t[4*u+2],t[4*u+3]];s[u]=a}for(var u=r;u<n*(i+1);u++){s[u]=new Array(4);for(var f=0;f<4;f++)o[f]=s[u-1][f];if(u%r==0){o=e.subWord(e.rotWord(o));for(var f=0;f<4;f++)o[f]^=e.rCon[u/r][f]}else r>6&&u%r==4&&(o=e.subWord(o));for(var f=0;f<4;f++)s[u][f]=s[u-r][f]^o[f]}return s},e.subBytes=function(t,n){for(var r=0;r<4;r++)for(var i=0;i<n;i++)t[r][i]=e.sBox[t[r][i]];return t},e.shiftRows=function(e,t){var n=new Array(4);for(var r=1;r<4;r++){for(var i=0;i<4;i++)n[i]=e[r][(i+r)%t];for(var i=0;i<4;i++)e[r][i]=n[i]}return e},e.mixColumns=function(e,t){for(var n=0;n<4;n++){var r=new Array(4),i=new Array(4);for(var s=0;s<4;s++)r[s]=e[s][n],i[s]=e[s][n]&128?e[s][n]<<1^283:e[s][n]<<1;e[0][n]=i[0]^r[1]^i[1]^r[2]^r[3],e[1][n]=r[0]^i[1]^r[2]^i[2]^r[3],e[2][n]=r[0]^r[1]^i[2]^r[3]^i[3],e[3][n]=r[0]^i[0]^r[1]^r[2]^i[3]}return e},e.addRoundKey=function(e,t,n,r){for(var i=0;i<4;i++)for(var s=0;s<r;s++)e[i][s]^=t[n*4+s][i];return e},e.subWord=function(t){for(var n=0;n<4;n++)t[n]=e.sBox[t[n]];return t},e.rotWord=function(e){var t=e[0];for(var n=0;n<3;n++)e[n]=e[n+1];return e[3]=t,e},e.sBox=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],e.rCon=[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]],e.Ctr={},e.Ctr.encrypt=function(r,i,s){var o=16;if(s!=128&&s!=192&&s!=256)return"";r=n.encode(r),i=n.encode(i);var u=s/8,a=new Array(u);for(var f=0;f<u;f++)a[f]=isNaN(i.charCodeAt(f))?0:i.charCodeAt(f);var l=e.cipher(a,e.keyExpansion(a));l=l.concat(l.slice(0,u-16));var c=new Array(o),h=(new Date).getTime(),p=h%1e3,d=Math.floor(h/1e3),v=Math.floor(Math.random()*65535);for(var f=0;f<2;f++)c[f]=p>>>f*8&255;for(var f=0;f<2;f++)c[f+2]=v>>>f*8&255;for(var f=0;f<4;f++)c[f+4]=d>>>f*8&255;var m="";for(var f=0;f<8;f++)m+=String.fromCharCode(c[f]);var g=e.keyExpansion(l),y=Math.ceil(r.length/o),b=new Array(y);for(var w=0;w<y;w++){for(var E=0;E<4;E++)c[15-E]=w>>>E*8&255;for(var E=0;E<4;E++)c[15-E-4]=w/4294967296>>>E*8;var S=e.cipher(c,g),x=w<y-1?o:(r.length-1)%o+1,T=new Array(x);for(var f=0;f<x;f++)T[f]=S[f]^r.charCodeAt(w*o+f),T[f]=String.fromCharCode(T[f]);b[w]=T.join("")}var N=m+b.join("");return N=t.encode(N),N},e.Ctr.decrypt=function(r,i,s){var o=16;if(s!=128&&s!=192&&s!=256)return"";r=t.decode(r),i=n.encode(i);var u=s/8,a=new Array(u);for(var f=0;f<u;f++)a[f]=isNaN(i.charCodeAt(f))?0:i.charCodeAt(f);var l=e.cipher(a,e.keyExpansion(a));l=l.concat(l.slice(0,u-16));var c=new Array(8);ctrTxt=r.slice(0,8);for(var f=0;f<8;f++)c[f]=ctrTxt.charCodeAt(f);var h=e.keyExpansion(l),p=Math.ceil((r.length-8)/o),d=new Array(p);for(var v=0;v<p;v++)d[v]=r.slice(8+v*o,8+v*o+o);r=d;var m=new Array(r.length);for(var v=0;v<p;v++){for(var g=0;g<4;g++)c[15-g]=v>>>g*8&255;for(var g=0;g<4;g++)c[15-g-4]=(v+1)/4294967296-1>>>g*8&255;var y=e.cipher(c,h),b=new Array(r[v].length);for(var f=0;f<r[v].length;f++)b[f]=y[f]^r[v].charCodeAt(f),b[f]=String.fromCharCode(b[f]);m[v]=b.join("")}var w=m.join("");return w=n.decode(w),w};var t={};t.code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t.encode=function(e,n){n=typeof n=="undefined"?!1:n;var r,i,s,o,u,a,f,l,c=[],h="",p,d,v,m=t.code;d=n?e.encodeUTF8():e,p=d.length%3;if(p>0)while(p++<3)h+="=",d+="\0";for(p=0;p<d.length;p+=3)r=d.charCodeAt(p),i=d.charCodeAt(p+1),s=d.charCodeAt(p+2),o=r<<16|i<<8|s,u=o>>18&63,a=o>>12&63,f=o>>6&63,l=o&63,c[p/3]=m.charAt(u)+m.charAt(a)+m.charAt(f)+m.charAt(l);return v=c.join(""),v=v.slice(0,v.length-h.length)+h,v},t.decode=function(e,n){n=typeof n=="undefined"?!1:n;var r,i,s,o,u,a,f,l,c=[],h,p,d=t.code;p=n?e.decodeUTF8():e;for(var v=0;v<p.length;v+=4)o=d.indexOf(p.charAt(v)),u=d.indexOf(p.charAt(v+1)),a=d.indexOf(p.charAt(v+2)),f=d.indexOf(p.charAt(v+3)),l=o<<18|u<<12|a<<6|f,r=l>>>16&255,i=l>>>8&255,s=l&255,c[v/4]=String.fromCharCode(r,i,s),f==64&&(c[v/4]=String.fromCharCode(r,i)),a==64&&(c[v/4]=String.fromCharCode(r));return h=c.join(""),n?h.decodeUTF8():h};var n={};n.encode=function(e){var t=e.replace(/[\u0080-\u07ff]/g,function(e){var t=e.charCodeAt(0);return String.fromCharCode(192|t>>6,128|t&63)});return t=t.replace(/[\u0800-\uffff]/g,function(e){var t=e.charCodeAt(0);return String.fromCharCode(224|t>>12,128|t>>6&63,128|t&63)}),t},n.decode=function(e){var t=e.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(e){var t=(e.charCodeAt(0)&15)<<12|(e.charCodeAt(1)&63)<<6|e.charCodeAt(2)&63;return String.fromCharCode(t)});return t=t.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(e){var t=(e.charCodeAt(0)&31)<<6|e.charCodeAt(1)&63;return String.fromCharCode(t)}),t}})();